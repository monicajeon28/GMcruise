# 인덱스 추가 가이드

## 문제 상황
`prisma migrate dev` 실행 시 shadow database 오류가 발생했습니다.

## 해결 방법

### 방법 1: prisma db push 사용 (권장 - 개발 환경)

개발 환경에서 스키마 변경사항을 직접 적용:

```bash
npx prisma db push
```

이 명령은:
- 마이그레이션 파일을 생성하지 않음
- 스키마 변경사항을 데이터베이스에 직접 적용
- 개발 환경에 적합

### 방법 2: SQL 직접 실행 (프로덕션 환경 권장)

프로덕션 환경에서는 SQL을 직접 실행하는 것이 더 안전합니다:

1. `add_indexes.sql` 파일의 SQL을 데이터베이스에 직접 실행
2. 또는 다음 명령으로 실행:

```bash
# PostgreSQL 연결 후
psql $DATABASE_URL -f add_indexes.sql
```

또는 Neon 콘솔에서 SQL Editor를 사용하여 실행

### 방법 3: Prisma Studio 사용

```bash
npx prisma studio
```

Prisma Studio에서 직접 SQL을 실행할 수 있습니다.

## 인덱스 확인

인덱스가 제대로 생성되었는지 확인:

```sql
SELECT 
    indexname, 
    indexdef 
FROM pg_indexes 
WHERE tablename = 'User' 
AND (
    indexname LIKE '%customerSource%' 
    OR indexname LIKE '%mallUserId%' 
    OR indexname LIKE '%testModeStartedAt%'
    OR indexname LIKE '%customerStatus_createdAt%'
);
```

## 주의사항

1. **프로덕션 환경**: SQL 직접 실행 권장
2. **대용량 테이블**: 인덱스 생성 시 시간이 걸릴 수 있음
3. **백업**: 인덱스 추가 전 데이터베이스 백업 권장 (안전을 위해)

## 예상 소요 시간

- 소규모 테이블 (< 10만 행): 1-5초
- 중규모 테이블 (10만-100만 행): 5-30초
- 대규모 테이블 (> 100만 행): 30초-5분

## 인덱스 추가 후

인덱스가 추가되면:
1. Prisma Client 재생성: `npx prisma generate`
2. 애플리케이션 재시작
3. 성능 개선 확인


