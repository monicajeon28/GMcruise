# 계약서 PDF 생성 및 전송 테스트 가이드

## 개요
계약서 서명 완료 후 PDF 생성 및 이메일 전송 기능을 테스트하는 방법입니다.

## 테스트 시나리오

### 1. 대리점장 대시보드에서 계약서 완료 승인 테스트

**전제 조건:**
- 대리점장 계정으로 로그인 (`boss1` / `1101`)
- 제출된 계약서가 있어야 함 (상태: `submitted`)

**테스트 단계:**
1. 대리점장 대시보드 접속: `/partner/boss1/dashboard`
2. "계약서 관리" 섹션 확인
3. 제출된 계약서 목록 확인
4. "완료 승인 (PDF 전송)" 버튼 클릭
5. 성공 메시지 확인
6. 계약서 상태가 `completed`로 변경되는지 확인

**확인 사항:**
- ✅ 계약서 목록이 표시되는가?
- ✅ "완료 승인" 버튼이 작동하는가?
- ✅ 성공 메시지가 표시되는가?
- ✅ 계약서 상태가 "완료됨"으로 변경되는가?

**이메일 확인:**
- 계약서에 등록된 이메일 주소로 PDF가 전송되었는지 확인
- 이메일 제목: `[계약서 완료] 어필리에이트 계약서`
- 첨부파일: `계약서_{이름}_{날짜}.pdf`

### 2. 관리자 패널에서 계약서 완료 승인 테스트

**전제 조건:**
- 관리자 계정으로 로그인
- 제출된 계약서가 있어야 함 (상태: `submitted`)

**테스트 단계:**
1. 관리자 패널 접속: `/admin/affiliate/contracts`
2. 계약서 목록에서 제출된 계약서 확인
3. "완료 승인" 버튼 클릭 (파란색 버튼)
4. 확인 대화상자에서 "확인" 클릭
5. 성공 메시지 확인

**확인 사항:**
- ✅ "완료 승인" 버튼이 표시되는가?
- ✅ 버튼 클릭 시 PDF가 생성되고 이메일이 전송되는가?
- ✅ 성공 메시지가 표시되는가?

### 3. 관리자 패널에서 아이디 생성 승인 테스트

**전제 조건:**
- 관리자 계정으로 로그인
- 제출된 또는 완료된 계약서가 있어야 함

**테스트 단계:**
1. 관리자 패널 접속: `/admin/affiliate/contracts`
2. 계약서 목록에서 계약서 확인
3. "아이디 생성" 버튼 클릭 (초록색 버튼)
4. 확인 대화상자에서 "확인" 클릭
5. 성공 메시지 확인

**확인 사항:**
- ✅ "아이디 생성" 버튼이 표시되는가?
- ✅ 버튼 클릭 시 아이디와 비밀번호가 생성되는가?
- ✅ 생성된 아이디 형식이 올바른가? (`boss1`, `user1` 등)
- ✅ 비밀번호가 `1101`로 설정되는가?

### 4. 판매원/대리점장 자신의 계약서 보관 테스트

**전제 조건:**
- 판매원 또는 대리점장 계정으로 로그인
- 승인된 계약서가 있어야 함

**테스트 단계:**
1. 파트너 대시보드 접속: `/partner/{partnerId}/dashboard`
2. "나의 계약서" 메뉴 클릭
3. 계약서 상세 정보 확인

**확인 사항:**
- ✅ "나의 계약서" 메뉴가 표시되는가?
- ✅ 계약서 정보가 올바르게 표시되는가?
- ✅ 서명 이미지가 표시되는가?

## PDF 생성 확인 방법

### 1. 서버 로그 확인
터미널에서 다음 로그를 확인:
```
[Contract PDF] 이메일 전송 성공: {이메일주소} (계약서 ID: {contractId})
```

### 2. 이메일 수신 확인
- 계약서에 등록된 이메일 주소 확인
- 스팸함도 확인
- 이메일 제목: `[계약서 완료] 어필리에이트 계약서`
- 첨부파일 확인

### 3. PDF 파일 확인
생성된 PDF 파일은 다음 경로에 저장됩니다:
```
public/contracts/pdfs/contract-{contractId}-{timestamp}.pdf
```

### 4. PDF 내용 확인
PDF에는 다음 내용이 포함되어야 합니다:
- 계약자 정보 (이름, 연락처, 이메일, 주소 등)
- 계좌 정보 (은행명, 계좌번호, 예금주)
- 계약서 서명 이미지
- 제출일 및 서명일
- 계약 유형 (판매원, 대리점장 등)

## 문제 해결

### PDF가 생성되지 않는 경우
1. Puppeteer 설치 확인: `npm list puppeteer`
2. 서버 로그에서 에러 메시지 확인
3. 이메일 설정 확인 (환경 변수)

### 이메일이 전송되지 않는 경우
1. 이메일 환경 변수 확인:
   - `EMAIL_SMTP_HOST`
   - `EMAIL_SMTP_PORT`
   - `EMAIL_SMTP_USER`
   - `EMAIL_SMTP_PASSWORD`
2. 이메일 서버 연결 확인
3. 스팸함 확인

### 계약서 목록이 표시되지 않는 경우
1. 대리점장 계정으로 로그인했는지 확인
2. 계약서가 제출되었는지 확인
3. 브라우저 콘솔에서 에러 확인

## 테스트 체크리스트

- [ ] 대리점장 대시보드에서 계약서 완료 승인 작동
- [ ] 관리자 패널에서 계약서 완료 승인 작동
- [ ] 관리자 패널에서 아이디 생성 승인 작동
- [ ] 판매원 대시보드에서 자신의 계약서 보관 작동
- [ ] 대리점장 대시보드에서 자신의 계약서 보관 작동
- [ ] PDF 파일이 올바르게 생성되는지 확인
- [ ] 이메일이 올바르게 전송되는지 확인
- [ ] PDF 내용이 올바른지 확인






