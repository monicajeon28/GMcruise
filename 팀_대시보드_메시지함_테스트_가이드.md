# 팀 대시보드 메시지함 기능 테스트 가이드

## 📍 접근 경로

- **URL**: `/admin/team-dashboard-messages`
- **메뉴 위치**: 관리자 패널 → 마케팅 섹션 → "팀 대시보드 메시지함" (📨)

---

## 🔐 접근 방법

1. 관리자 로그인: `/admin/login`
2. 로그인 후 메뉴에서 "팀 대시보드 메시지함" 클릭
3. 또는 직접 URL 입력: `/admin/team-dashboard-messages`

---

## ✅ 테스트 항목별 가이드

### 1. 메시지 타입 구분 테스트

#### 관리자 페이지에서 확인
1. 팀 대시보드 메시지함 페이지 접속
2. 메시지 목록에서 각 메시지 확인
3. **확인 사항**:
   - ✅ 메시지 제목 옆에 "팀 대시보드" 배지가 표시되는지 확인
   - ✅ 배지가 틸(teal) 색상인지 확인
   - ✅ 사용자 아이콘(👥)이 표시되는지 확인

#### 사용자 앱에서 확인
1. 일반 사용자 계정으로 로그인
2. 메인 페이지 또는 채팅 페이지 접속
3. 팀 대시보드 메시지가 있는 경우 자동으로 팝업 표시
4. **확인 사항**:
   - ✅ 메시지 팝업이 틸(teal) 색상 배경인지 확인
   - ✅ 헤더에 "팀 대시보드" 배지가 표시되는지 확인
   - ✅ 사용자 아이콘(👥)이 표시되는지 확인
   - ✅ 일반 메시지와 색상이 다른지 확인

#### 테스트 데이터 준비
```sql
-- 팀 대시보드 메시지 생성 (관리자 마케팅 고객 페이지에서 발송)
-- 또는 직접 DB에 생성
INSERT INTO "AdminMessage" (
  "adminId", 
  "userId", 
  title, 
  content, 
  "messageType", 
  "isActive",
  "createdAt", 
  "updatedAt"
)
VALUES (
  [관리자 ID],
  [사용자 ID],
  '테스트 팀 대시보드 메시지',
  '이것은 테스트 메시지입니다.',
  'team-dashboard',
  true,
  NOW(),
  NOW()
);
```

---

### 2. 읽음 상태 상세 정보 테스트

#### 테스트 절차
1. 팀 대시보드 메시지함에서 메시지 클릭
2. 메시지 상세 모달 열림
3. **"읽음 상태" 탭** 클릭
4. **확인 사항**:
   - ✅ 통계 카드 3개 표시 (총 발송, 읽음, 읽음률)
   - ✅ 읽은 사용자 목록 표시 (녹색 배경)
   - ✅ 읽은 시간 표시
   - ✅ 읽지 않은 사용자 목록 표시 (빨간색 배경)
   - ✅ 재발송 버튼 표시 (읽지 않은 사용자)

#### API 직접 테스트
```bash
# 읽음 상태 조회 API 테스트
curl -X GET "http://localhost:3000/api/admin/messages/[메시지ID]/readers" \
  -H "Cookie: cg.sid.v2=[세션쿠키]" \
  -H "Content-Type: application/json"

# 응답 예시
{
  "ok": true,
  "totalSent": 10,
  "totalRead": 7,
  "readRate": "70.0",
  "readers": [
    {
      "userId": 1,
      "name": "홍길동",
      "phone": "01012345678",
      "readAt": "2024-01-15T10:30:00Z",
      "messageId": 123
    }
  ],
  "nonReaders": [
    {
      "userId": 2,
      "name": "김철수",
      "phone": "01087654321",
      "messageId": 124
    }
  ]
}
```

#### 테스트 시나리오
1. **메시지 발송 후 읽지 않은 상태 확인**
   - 메시지 발송
   - 읽음 상태 탭에서 모든 사용자가 "읽지 않은 사용자"에 표시되는지 확인

2. **사용자가 메시지 읽은 후 확인**
   - 사용자 앱에서 메시지 확인
   - 관리자 페이지에서 읽음 상태 탭 새로고침
   - 해당 사용자가 "읽은 사용자"로 이동했는지 확인

3. **그룹 메시지 읽음 상태 확인**
   - 여러 명에게 발송된 메시지 선택
   - 읽음 상태 탭에서 모든 수신자 목록 확인
   - 읽음/미읽음 분류 정확성 확인

---

### 3. 고급 필터링 테스트

#### 필터 UI 확인
1. 팀 대시보드 메시지함 페이지 접속
2. 필터 섹션 확인
3. **확인 사항**:
   - ✅ 시작일/종료일 입력 필드
   - ✅ 발신자 드롭다운
   - ✅ 읽음 상태 드롭다운 (전체/읽음/미읽음)
   - ✅ 검색 입력 필드
   - ✅ 필터 초기화 버튼

#### 날짜 범위 필터 테스트
1. **시작일 설정**
   - 시작일 선택 (예: 2024-01-01)
   - 해당 날짜 이후의 메시지만 표시되는지 확인

2. **종료일 설정**
   - 종료일 선택 (예: 2024-01-31)
   - 해당 날짜 이전의 메시지만 표시되는지 확인

3. **날짜 범위 설정**
   - 시작일과 종료일 모두 설정
   - 해당 기간의 메시지만 표시되는지 확인

#### 발신자 필터 테스트
1. 발신자 드롭다운 클릭
2. 관리자 목록 확인
3. 특정 관리자 선택
4. **확인 사항**:
   - ✅ 선택한 관리자가 발송한 메시지만 표시되는지 확인
   - ✅ "전체" 선택 시 모든 메시지 표시되는지 확인

#### 읽음 상태 필터 테스트
1. 읽음 상태 드롭다운 클릭
2. **"읽음" 선택**
   - 읽은 사용자가 있는 메시지만 표시되는지 확인
3. **"미읽음" 선택**
   - 아무도 읽지 않은 메시지만 표시되는지 확인
4. **"전체" 선택**
   - 모든 메시지 표시되는지 확인

#### 검색 기능 테스트
1. 검색 입력 필드에 키워드 입력
2. **검색 대상**:
   - 제목
   - 내용
   - 발신자 이름
3. **확인 사항**:
   - ✅ 입력한 키워드가 포함된 메시지만 표시되는지 확인
   - ✅ 대소문자 구분 없이 검색되는지 확인
   - ✅ 실시간 검색되는지 확인

#### 필터 초기화 테스트
1. 여러 필터 설정
2. "필터 초기화" 버튼 클릭
3. **확인 사항**:
   - ✅ 모든 필터가 초기화되는지 확인
   - ✅ 모든 메시지가 다시 표시되는지 확인

---

### 4. 그룹 메시지 전체 답장 테스트

#### 테스트 데이터 준비
1. 마케팅 고객 페이지 접속: `/admin/marketing/customers`
2. 여러 고객 선택 (최소 3명 이상)
3. 발송 방식: "팀 대시보드 메시지" 선택
4. 메시지 발송

#### 답장 모드 테스트

**모든 수신자에게 답장**
1. 메시지 상세 모달 열기
2. "메시지 상세" 탭에서 답장 작성 섹션 확인
3. 답장 대상: **"모든 수신자에게 답장"** 선택
4. **확인 사항**:
   - ✅ 수신자 수가 표시되는지 확인 (예: "모든 수신자에게 답장 (5명)")
   - ✅ 답장 내용 입력
   - ✅ "답장 보내기" 버튼에 수신자 수 표시되는지 확인
5. 답장 발송
6. **확인 사항**:
   - ✅ 성공 메시지 표시
   - ✅ 모든 수신자에게 메시지가 발송되었는지 확인

**선택한 수신자에게 답장**
1. 답장 대상: **"선택한 수신자에게 답장"** 선택
2. **확인 사항**:
   - ✅ 수신자 목록이 체크박스로 표시되는지 확인
   - ✅ 여러 명 선택 가능한지 확인
3. 원하는 수신자 선택 (2-3명)
4. **확인 사항**:
   - ✅ 선택한 수신자 수가 버튼에 표시되는지 확인
   - ✅ 선택하지 않으면 버튼이 비활성화되는지 확인
5. 답장 발송
6. **확인 사항**:
   - ✅ 선택한 수신자에게만 메시지가 발송되었는지 확인

**원래 발신자에게만 답장**
1. 답장 대상: **"원래 발신자에게만 답장"** 선택
2. **확인 사항**:
   - ✅ 수신자 수가 1명으로 표시되는지 확인
3. 답장 발송
4. **확인 사항**:
   - ✅ 원래 발신자에게만 메시지가 발송되었는지 확인

#### 수신자 선택 UI 테스트
1. "선택한 수신자에게 답장" 모드 선택
2. **확인 사항**:
   - ✅ 수신자 목록이 스크롤 가능한 박스로 표시되는지 확인
   - ✅ 각 수신자 이름/전화번호가 표시되는지 확인
   - ✅ 체크박스 클릭 시 선택/해제되는지 확인
   - ✅ 전체 선택 기능이 있는지 확인 (없어도 됨)

---

### 5. 통계 대시보드 테스트

#### 통계 패널 열기
1. 팀 대시보드 메시지함 페이지 접속
2. 우측 상단 **"통계 보기"** 버튼 클릭
3. **확인 사항**:
   - ✅ 통계 패널이 표시되는지 확인
   - ✅ 날짜 범위 선택 필드 표시되는지 확인

#### 요약 통계 확인
1. 통계 패널 상단의 요약 카드 확인
2. **확인 사항**:
   - ✅ 총 발송 수 표시
   - ✅ 총 읽음 수 표시
   - ✅ 평균 읽음률 표시
   - ✅ 메시지 그룹 수 표시

#### 일별 추이 차트 확인
1. 일별 발송/읽음 추이 섹션 확인
2. **확인 사항**:
   - ✅ 막대 차트가 표시되는지 확인
   - ✅ 발송(파란색)과 읽음(녹색) 막대가 구분되는지 확인
   - ✅ 날짜 라벨이 표시되는지 확인
   - ✅ 데이터가 없을 때 빈 상태가 표시되는지 확인

#### 발신자별 통계 확인
1. 발신자별 통계 섹션 확인
2. **확인 사항**:
   - ✅ 각 발신자별로 발송/읽음/읽음률이 표시되는지 확인
   - ✅ 발신자 이름이 표시되는지 확인

#### 인기 메시지 TOP 10 확인
1. 인기 메시지 TOP 10 섹션 확인
2. **확인 사항**:
   - ✅ 최대 10개의 메시지가 표시되는지 확인
   - ✅ 발송 수 기준으로 정렬되는지 확인
   - ✅ 각 메시지의 제목, 발신자, 발송/읽음/읽음률이 표시되는지 확인

#### 날짜 범위 선택 테스트
1. 시작일 선택 (예: 2024-01-01)
2. 종료일 선택 (예: 2024-01-31)
3. **"조회"** 버튼 클릭
4. **확인 사항**:
   - ✅ 선택한 기간의 통계만 표시되는지 확인
   - ✅ 일별 추이 차트가 해당 기간만 표시되는지 확인
   - ✅ 발신자별 통계가 해당 기간만 반영되는지 확인

---

### 6. 메시지 삭제 기능 테스트

#### 개별 메시지 삭제 테스트
1. 메시지 목록에서 메시지 확인
2. 메시지 오른쪽의 **삭제 버튼(🗑️)** 클릭
3. 확인 다이얼로그 표시
4. **"확인"** 클릭
5. **확인 사항**:
   - ✅ 삭제 성공 메시지 표시
   - ✅ 메시지 목록에서 해당 메시지가 사라지는지 확인
   - ✅ 사용자 앱에서 해당 메시지가 더 이상 표시되지 않는지 확인

#### 그룹 메시지 전체 삭제 테스트
1. 여러 명에게 발송된 메시지 확인 (같은 제목/내용/시간대)
2. 메시지 목록에서 그룹 메시지 확인
3. 삭제 버튼 클릭
4. **확인 사항**:
   - ✅ 확인 다이얼로그에 "이 그룹의 모든 메시지를 삭제하시겠습니까?" 메시지 표시
5. **"확인"** 클릭
6. **확인 사항**:
   - ✅ 삭제 성공 메시지에 삭제된 메시지 수 표시 (예: "그룹 메시지 5개가 삭제되었습니다.")
   - ✅ 그룹의 모든 메시지가 목록에서 사라지는지 확인
   - ✅ 모든 수신자의 앱에서 메시지가 사라지는지 확인

#### API 직접 테스트
```bash
# 개별 메시지 삭제
curl -X DELETE "http://localhost:3000/api/admin/messages?id=[메시지ID]" \
  -H "Cookie: cg.sid.v2=[세션쿠키]" \
  -H "Content-Type: application/json"

# 그룹 메시지 전체 삭제
curl -X DELETE "http://localhost:3000/api/admin/messages?id=[메시지ID]&deleteGroup=true" \
  -H "Cookie: cg.sid.v2=[세션쿠키]" \
  -H "Content-Type: application/json"

# 응답 예시
{
  "ok": true,
  "deletedCount": 5,
  "message": "그룹 메시지 5개가 삭제되었습니다."
}
```

#### 삭제 후 자동 연동 확인
1. 메시지 삭제
2. 사용자 앱에서 확인
3. **확인 사항**:
   - ✅ 삭제된 메시지가 사용자 앱에 더 이상 표시되지 않는지 확인
   - ✅ 새로고침 후에도 표시되지 않는지 확인
   - ✅ `/api/user/messages` API에서 삭제된 메시지가 반환되지 않는지 확인

---

## 🧪 종합 테스트 시나리오

### 시나리오 1: 전체 워크플로우 테스트
1. **메시지 발송**
   - 마케팅 고객 페이지에서 여러 고객 선택
   - 팀 대시보드 메시지 발송

2. **메시지 확인**
   - 팀 대시보드 메시지함에서 발송된 메시지 확인
   - 메시지 타입 배지 확인

3. **읽음 상태 확인**
   - 메시지 상세 → 읽음 상태 탭
   - 모든 사용자가 미읽음 상태인지 확인

4. **사용자 앱에서 메시지 확인**
   - 사용자 계정으로 로그인
   - 메시지 팝업 표시 확인
   - 틸 색상 및 배지 확인

5. **읽음 처리**
   - 사용자가 메시지 확인
   - 관리자 페이지에서 읽음 상태 확인

6. **답장 발송**
   - 모든 수신자에게 답장 발송
   - 답장 메시지 확인

7. **통계 확인**
   - 통계 대시보드에서 발송/읽음률 확인

8. **메시지 삭제**
   - 그룹 메시지 전체 삭제
   - 사용자 앱에서 삭제 확인

### 시나리오 2: 필터링 및 검색 테스트
1. 여러 날짜에 메시지 발송
2. 날짜 범위 필터로 특정 기간만 조회
3. 발신자 필터로 특정 관리자 메시지만 조회
4. 읽음 상태 필터로 미읽음 메시지만 조회
5. 검색으로 특정 키워드 메시지 찾기
6. 필터 초기화로 전체 메시지 표시

### 시나리오 3: 대량 메시지 테스트
1. 100명 이상에게 메시지 발송
2. 읽음 상태 탭에서 모든 수신자 목록 확인
3. 스크롤 기능 확인
4. 성능 확인 (로딩 시간)

---

## 🐛 문제 해결

### 메시지가 표시되지 않는 경우
1. 브라우저 콘솔에서 에러 확인
2. 네트워크 탭에서 API 요청 상태 확인
3. `messageType`이 `'team-dashboard'`인지 확인

### 읽음 상태가 표시되지 않는 경우
1. `/api/admin/messages/[id]/readers` API 직접 호출 테스트
2. 메시지 ID가 올바른지 확인
3. 그룹 메시지인 경우 모든 메시지 ID 확인

### 필터가 작동하지 않는 경우
1. 필터 파라미터가 URL에 포함되는지 확인
2. API 응답에서 필터링된 데이터가 반환되는지 확인
3. 브라우저 콘솔에서 필터 상태 확인

### 통계가 표시되지 않는 경우
1. `/api/admin/messages/statistics` API 직접 호출 테스트
2. 날짜 범위가 올바른지 확인
3. 데이터베이스에 실제 데이터가 있는지 확인

### 삭제가 작동하지 않는 경우
1. 삭제 API 직접 호출 테스트
2. 메시지 ID가 올바른지 확인
3. 관리자 권한이 있는지 확인
4. 데이터베이스에서 실제로 삭제되었는지 확인

---

## 📝 체크리스트

### 기능 테스트
- [ ] 메시지 타입 배지 표시 (관리자 페이지)
- [ ] 메시지 타입 색상/아이콘 표시 (사용자 앱)
- [ ] 읽음 상태 탭 표시
- [ ] 읽은/읽지 않은 사용자 목록 표시
- [ ] 날짜 범위 필터 작동
- [ ] 발신자 필터 작동
- [ ] 읽음 상태 필터 작동
- [ ] 검색 기능 작동
- [ ] 필터 초기화 작동
- [ ] 모든 수신자에게 답장
- [ ] 선택한 수신자에게 답장
- [ ] 원래 발신자에게만 답장
- [ ] 통계 대시보드 표시
- [ ] 일별 추이 차트 표시
- [ ] 발신자별 통계 표시
- [ ] 인기 메시지 TOP 10 표시
- [ ] 개별 메시지 삭제
- [ ] 그룹 메시지 전체 삭제
- [ ] 삭제 후 사용자 앱에서 자동 숨김

### UI/UX 테스트
- [ ] 로딩 상태 표시
- [ ] 에러 메시지 표시
- [ ] 빈 상태 표시
- [ ] 반응형 디자인 (모바일/태블릿/데스크톱)
- [ ] 스크롤 기능
- [ ] 모달 닫기 기능

### 성능 테스트
- [ ] 페이지 로드 시간 (3초 이내)
- [ ] 대량 메시지 처리 (100개 이상)
- [ ] 필터링 성능
- [ ] 통계 계산 성능

---

## 🚀 빠른 테스트 가이드

### 1단계: 메시지 발송
```
1. /admin/marketing/customers 접속
2. 고객 선택 (최소 3명)
3. 그룹 메시지 발송 → 팀 대시보드 메시지 선택
4. 메시지 발송
```

### 2단계: 메시지함 확인
```
1. /admin/team-dashboard-messages 접속
2. 발송된 메시지 확인
3. 메시지 타입 배지 확인
```

### 3단계: 기능 테스트
```
1. 메시지 클릭 → 상세 모달 열기
2. 읽음 상태 탭 확인
3. 필터링 테스트
4. 답장 테스트
5. 통계 대시보드 확인
6. 삭제 테스트
```

### 4단계: 사용자 앱 확인
```
1. 사용자 계정으로 로그인
2. 메시지 팝업 확인
3. 색상/아이콘 확인
4. 메시지 읽기
5. 관리자 페이지에서 읽음 상태 확인
```

---

이제 정확한 테스트 가이드입니다! 각 기능을 단계별로 테스트해보세요.

