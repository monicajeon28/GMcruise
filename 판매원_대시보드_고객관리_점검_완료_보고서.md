# íŒë§¤ì› ëŒ€ì‹œë³´ë“œ ê³ ê°ê´€ë¦¬ ì ê²€ ì™„ë£Œ ë³´ê³ ì„œ

## âœ… ì™„ë£Œ ì‚¬í•­

### 1. ê³ ê° ê·¸ë£¹ê´€ë¦¬ ë¹ ë¥¸ë²„íŠ¼ ì¶”ê°€

**ìœ„ì¹˜**: `app/partner/[partnerId]/customers/PartnerCustomersClient.tsx` (2137-2143ë²ˆ ì¤„)

**ë³€ê²½ ë‚´ìš©**:
- íŒë§¤ì›ê³¼ ëŒ€ë¦¬ì ì¥ ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥í•œ "ê³ ê° ê·¸ë£¹ê´€ë¦¬" ë¹ ë¥¸ë²„íŠ¼ ì¶”ê°€
- ëŒ€ë¦¬ì ì¥ ê³ ê° ê·¸ë£¹ê´€ë¦¬ í˜ì´ì§€(`/partner/[partnerId]/customer-groups`)ë¡œ ì´ë™
- FiLayers ì•„ì´ì½˜ ì‚¬ìš©

**ì½”ë“œ**:
```typescript
{/* ê³ ê° ê·¸ë£¹ê´€ë¦¬ ë¹ ë¥¸ë²„íŠ¼ (íŒë§¤ì›, ëŒ€ë¦¬ì ì¥ ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥) */}
<Link
  href={`/partner/${partnerId}/customer-groups`}
  className="inline-flex items-center gap-2 rounded-2xl bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-indigo-700"
>
  <FiLayers /> ê³ ê° ê·¸ë£¹ê´€ë¦¬
</Link>
```

---

### 2. ê³ ê° ë¶„ë¥˜ë³„ í‘œì‹œ ê°œì„ 

**ìœ„ì¹˜**: `app/partner/[partnerId]/customers/PartnerCustomersClient.tsx` (2504-2536ë²ˆ ì¤„)

**ë³€ê²½ ë‚´ìš©**:
ê³ ê° ë¶„ë¥˜ë¥¼ ëª…í™•í•˜ê²Œ í‘œì‹œí•˜ë„ë¡ ê°œì„ :

1. **êµ¬ë§¤ê³ ê°**: ìì‹ ì˜ ê°œê°œì¸ ëª°ì—ì„œ êµ¬ë§¤í•œ ê³ ê°
   - íŒë³„ ì¡°ê±´: `hasPurchase && (source.startsWith('mall-') || ownerType === 'SALES_AGENT')`

2. **ìƒë‹´ì‹ ì²­ê³ ê°**: ìƒë‹´ì„ ì‹ ì²­í•œ ê³ ê°
   - íŒë³„ ì¡°ê±´: `source.startsWith('mall-') || source === 'product-inquiry' || source === 'phone-consultation'`

3. **ë‚´ê°€ì…ë ¥í•œ ê³ ê°**: íŒë§¤ì›ì´ ì§ì ‘ ì…ë ¥í•œ ê³ ê°
   - íŒë³„ ì¡°ê±´: `ownership === 'AGENT' && (source === 'affiliate-manual' || source === 'partner-manual')`

4. **DB ë°›ì€ ê³ ê°**: ëŒ€ë¦¬ì ì¥ì´ DBë¥¼ ë³´ë‚´ì¤˜ì„œ ë°›ì€ ê³ ê°
   - íŒë³„ ì¡°ê±´: `ownership === 'MANAGER' && agent.id`

**ì½”ë“œ**:
```typescript
{(() => {
  // 1. ìì‹ ì˜ ê°œê°œì¸ ëª°ì—ì„œ êµ¬ë§¤ê³ ê°
  const hasPurchase = customer.sales.some((sale) => 
    sale.status === 'CONFIRMED' || sale.status === 'PENDING' || sale.status === 'PAID'
  );
  const isMallPurchase = hasPurchase && (
    customer.source?.startsWith('mall-') || 
    customer.affiliateOwnership?.ownerType === 'SALES_AGENT'
  );
  
  // 2. ìƒë‹´ì‹ ì²­ê³ ê°
  const isInquiry = customer.source?.startsWith('mall-') || 
    customer.source === 'product-inquiry' || 
    customer.source === 'phone-consultation';
  
  // 3. ë‚´ê°€ì…ë ¥í•œ ê³ ê°
  const isManualInput = customer.ownership === 'AGENT' && (
    customer.source === 'affiliate-manual' || 
    customer.source === 'partner-manual'
  );
  
  // 4. ëŒ€ë¦¬ì ì¥ì´ DB ë³´ë‚´ì¤˜ì„œ ë°›ì€ ê³ ê°
  const isDbReceived = customer.ownership === 'MANAGER' && customer.agent?.id;
  
  return (
    <span className="font-semibold">
      {isMallPurchase
        ? 'êµ¬ë§¤ê³ ê°'
        : isInquiry
        ? 'ìƒë‹´ì‹ ì²­ê³ ê°'
        : isManualInput
        ? 'ë‚´ê°€ì…ë ¥í•œ ê³ ê°'
        : isDbReceived
        ? 'DB ë°›ì€ ê³ ê°'
        : customer.ownership === 'AGENT'
        ? 'ë‚´ ê³ ê°'
        : customer.ownership === 'MANAGER'
        ? 'ëŒ€ë¦¬ì  ê³ ê°'
        : 'í˜‘ì—… ê³ ê°'}
    </span>
  );
})()}
```

---

### 3. ê³ ê°ìƒíƒœ ì²´í¬ ê²€ì¦

**í˜„ì¬ êµ¬í˜„ ìƒíƒœ**:

1. **CustomerStatusBadges ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©** (2244-2249ë²ˆ ì¤„, 2345-2350ë²ˆ ì¤„):
   - `testModeStartedAt`: 3ì¼ ì²´í—˜ ì‹œì‘ ì‹œê°„
   - `customerStatus`: ê³ ê° ìƒíƒœ ('active', 'test', 'test-locked', 'package', 'dormant', 'locked')
   - `customerSource`: ê³ ê° ì¶œì²˜ ('cruise-guide', 'test-guide', 'mall-signup', 'product-inquiry', 'phone-consultation', 'affiliate-manual', 'partner-manual')
   - `mallUserId`: í¬ë£¨ì¦ˆëª° ì‚¬ìš©ì ID

2. **ê³ ê° ìƒíƒœ í‘œì‹œ**:
   - í¬ë£¨ì¦ˆê°€ì´ë“œ ì§€ë‹ˆ (ê²°ì œ): `customerStatus === 'active' && customerSource === 'cruise-guide'`
   - í¬ë£¨ì¦ˆê°€ì´ë“œ ì§€ë‹ˆ 3ì¼ ì²´í—˜: `customerStatus === 'test' && customerSource === 'test-guide'`
   - í¬ë£¨ì¦ˆëª° ê°€ì…: `mallUserId` ì¡´ì¬

3. **APIì—ì„œ ê³ ê° ìƒíƒœ ì •ë³´ ì œê³µ** (`app/api/partner/customers/route.ts`):
   - User ì •ë³´ ì¡°íšŒí•˜ì—¬ `customerStatus`, `customerSource`, `testModeStartedAt` í¬í•¨
   - ê³ ê° ì „í™”ë²ˆí˜¸ë¡œ User ì •ë³´ ë§¤í•‘

**ê²€ì¦ ê²°ê³¼**: âœ… ê³ ê°ìƒíƒœ ì²´í¬ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

## ğŸ“‹ ê³ ê° ë¶„ë¥˜ ë¡œì§ ìƒì„¸

### ê³ ê° ë¶„ë¥˜ ìš°ì„ ìˆœìœ„

1. **êµ¬ë§¤ê³ ê°** (ìµœìš°ì„ )
   - íŒë§¤ì›ì˜ ëª°ì—ì„œ êµ¬ë§¤í•œ ê³ ê°
   - íŒë³„: `hasPurchase && (source.startsWith('mall-') || ownerType === 'SALES_AGENT')`

2. **ìƒë‹´ì‹ ì²­ê³ ê°**
   - ëª°ì—ì„œ ìƒë‹´ ì‹ ì²­í•œ ê³ ê°
   - íŒë³„: `source.startsWith('mall-') || source === 'product-inquiry' || source === 'phone-consultation'`

3. **ë‚´ê°€ì…ë ¥í•œ ê³ ê°**
   - íŒë§¤ì›ì´ ì§ì ‘ ì…ë ¥í•œ ê³ ê°
   - íŒë³„: `ownership === 'AGENT' && (source === 'affiliate-manual' || source === 'partner-manual')`

4. **DB ë°›ì€ ê³ ê°**
   - ëŒ€ë¦¬ì ì¥ì´ DBë¥¼ ë³´ë‚´ì¤˜ì„œ ë°›ì€ ê³ ê°
   - íŒë³„: `ownership === 'MANAGER' && agent.id`

5. **ê¸°ë³¸ ë¶„ë¥˜**
   - ë‚´ ê³ ê°: `ownership === 'AGENT'`
   - ëŒ€ë¦¬ì  ê³ ê°: `ownership === 'MANAGER'`
   - í˜‘ì—… ê³ ê°: ê¸°íƒ€

---

## âœ… ìµœì¢… ê²€ì¦

### ì™„ë£Œëœ ì‘ì—…

1. âœ… ê³ ê° ê·¸ë£¹ê´€ë¦¬ ë¹ ë¥¸ë²„íŠ¼ ì¶”ê°€ (íŒë§¤ì›, ëŒ€ë¦¬ì ì¥ ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥)
2. âœ… ê³ ê° ë¶„ë¥˜ë³„ ëª…í™•í•œ í‘œì‹œ (êµ¬ë§¤ê³ ê°, ìƒë‹´ì‹ ì²­ê³ ê°, ë‚´ê°€ì…ë ¥í•œ ê³ ê°, DB ë°›ì€ ê³ ê°)
3. âœ… ê³ ê°ìƒíƒœ ì²´í¬ ê²€ì¦ (CustomerStatusBadges ì •ìƒ ì‘ë™)

### ê²€ì¦ ì™„ë£Œ í•­ëª©

- [x] ìì‹ ì˜ ê°œê°œì¸ ëª°ì—ì„œ êµ¬ë§¤ê³ ê° í‘œì‹œ
- [x] ìƒë‹´ì‹ ì²­ê³ ê° í‘œì‹œ
- [x] ë‚´ê°€ì…ë ¥í•œ ê³ ê° í‘œì‹œ
- [x] ëŒ€ë¦¬ì ì¥ì´ DB ë³´ë‚´ì¤˜ì„œ ë°›ì€ ê³ ê° í‘œì‹œ
- [x] ê³ ê°ìƒíƒœ ì²´í¬ ì •ìƒ ì‘ë™
- [x] ê³ ê° ê·¸ë£¹ê´€ë¦¬ ë¹ ë¥¸ë²„íŠ¼ ì¶”ê°€

---

## ğŸ¯ ìµœì¢… ê²°ë¡ 

**ëª¨ë“  ìš”êµ¬ì‚¬í•­ì´ ì™„ë£Œë˜ì—ˆìœ¼ë©°, ì˜¤ë¥˜ ì—†ì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤!**

1. íŒë§¤ì› ëŒ€ì‹œë³´ë“œ ê³ ê°ê´€ë¦¬ì—ì„œ ê³ ê° ë¶„ë¥˜ë³„ë¡œ ëª…í™•í•˜ê²Œ í‘œì‹œë¨
2. ê³ ê° ê·¸ë£¹ê´€ë¦¬ ë¹ ë¥¸ë²„íŠ¼ì´ ì¶”ê°€ë˜ì–´ ëŒ€ë¦¬ì ì¥ ê³ ê° ê·¸ë£¹ê´€ë¦¬ ê¸°ëŠ¥ì— ì‰½ê²Œ ì ‘ê·¼ ê°€ëŠ¥
3. ê³ ê°ìƒíƒœ ì²´í¬ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ì—¬ í¬ë£¨ì¦ˆê°€ì´ë“œ ì§€ë‹ˆ (ê²°ì œ), 3ì¼ ì²´í—˜, í¬ë£¨ì¦ˆëª° ê°€ì… ë“±ì´ ëª…í™•íˆ êµ¬ë¶„ë¨


