# 환경변수 통합 설정 가이드

페이앱, 웰컴페이먼츠, Gemini API를 한꺼번에 설정하는 가이드입니다.

---

## 📋 목차
1. [전체 환경변수 목록](#1-전체-환경변수-목록)
2. [로컬 개발 환경 설정](#2-로컬-개발-환경-설정)
3. [프로덕션 환경 설정 (Vercel)](#3-프로덕션-환경-설정-vercel)
4. [각 환경변수 설명](#4-각-환경변수-설명)
5. [설정 확인 방법](#5-설정-확인-방법)

---

## 1. 전체 환경변수 목록

### 1-1. 페이앱 결제
```bash
PAYAPP_USERID=hyeseon28
PAYAPP_LINKKEY=CPe1Qyvoll6bPRHfd5pTZO1DPJnCCRVaOgT+oqg6zaM=
PAYAPP_LINKVAL=CPe1Qyvoll6bPRHfd5pTZJKhziNbvfVO9tbzpmrIe6s=
```

### 1-2. 웰컴페이먼츠 결제
```bash
# 인증 결제 (본인인증)
PG_SIGNKEY=your_signkey_here
PG_MID_AUTH=your_mid_auth_here
PG_FIELD_ENCRYPT_IV=your_field_encrypt_iv_here
PG_FIELD_ENCRYPT_KEY=your_field_encrypt_key_here

# 비인증 결제 (카드번호 입력)
PG_SIGNKEY_NON_AUTH=your_signkey_non_auth_here
PG_MID_NON_AUTH=your_mid_non_auth_here
PG_FIELD_ENCRYPT_IV_NON_AUTH=your_field_encrypt_iv_non_auth_here
PG_FIELD_ENCRYPT_KEY_NON_AUTH=your_field_encrypt_key_non_auth_here

# 웰컴페이먼츠 결제 페이지 URL
NEXT_PUBLIC_WELCOME_PAY_URL=https://pay.welcomepayments.co.kr/payment
WELCOME_PAY_URL=https://pay.welcomepayments.co.kr/payment
```

### 1-3. Gemini AI
```bash
GEMINI_API_KEY=your_gemini_api_key_here
# 또는 (대체 옵션)
GOOGLE_GENERATIVE_AI_API_KEY=your_gemini_api_key_here
```

### 1-4. 기본 설정
```bash
NEXT_PUBLIC_BASE_URL=https://www.cruisedot.co.kr
DATABASE_URL=your_database_url_here
```

---

## 2. 로컬 개발 환경 설정

### 2-1. .env.local 파일 생성

프로젝트 루트 디렉토리에서:

```bash
# 프로젝트 루트로 이동
cd /home/userhyeseon28/projects/cruise-guide

# .env.local 파일 생성/편집
nano .env.local
# 또는
vim .env.local
# 또는 VS Code 사용
code .env.local
```

### 2-2. 전체 환경변수 복사/붙여넣기

`.env.local` 파일에 다음 내용을 모두 복사해서 붙여넣으세요:

```bash
# ============================================
# 페이앱 결제 설정
# ============================================
PAYAPP_USERID=hyeseon28
PAYAPP_LINKKEY=CPe1Qyvoll6bPRHfd5pTZO1DPJnCCRVaOgT+oqg6zaM=
PAYAPP_LINKVAL=CPe1Qyvoll6bPRHfd5pTZJKhziNbvfVO9tbzpmrIe6s=

# ============================================
# 웰컴페이먼츠 결제 설정
# ============================================
# 인증 결제 (본인인증)
PG_SIGNKEY=your_signkey_here
PG_MID_AUTH=your_mid_auth_here
PG_FIELD_ENCRYPT_IV=your_field_encrypt_iv_here
PG_FIELD_ENCRYPT_KEY=your_field_encrypt_key_here

# 비인증 결제 (카드번호 입력)
PG_SIGNKEY_NON_AUTH=your_signkey_non_auth_here
PG_MID_NON_AUTH=your_mid_non_auth_here
PG_FIELD_ENCRYPT_IV_NON_AUTH=your_field_encrypt_iv_non_auth_here
PG_FIELD_ENCRYPT_KEY_NON_AUTH=your_field_encrypt_key_non_auth_here

# 웰컴페이먼츠 결제 페이지 URL
NEXT_PUBLIC_WELCOME_PAY_URL=https://pay.welcomepayments.co.kr/payment
WELCOME_PAY_URL=https://pay.welcomepayments.co.kr/payment

# ============================================
# Gemini AI 설정
# ============================================
GEMINI_API_KEY=your_gemini_api_key_here
# GEMINI_MODEL=gemini-flash-latest  # 선택사항 (기본값: gemini-flash-latest)

# ============================================
# 기본 설정
# ============================================
NEXT_PUBLIC_BASE_URL=https://www.cruisedot.co.kr
```

### 2-3. 실제 값으로 교체

**⚠️ 중요:** `your_xxx_here` 부분을 실제 값으로 교체해야 합니다:

1. **페이앱 값**: 이미 설정되어 있으므로 그대로 사용
2. **웰컴페이먼츠 값**: 웰컴페이먼츠 관리자 페이지에서 확인
3. **Gemini API 키**: Google AI Studio에서 발급받은 키로 교체

### 2-4. 서버 재시작

```bash
# 개발 서버 중지 (Ctrl+C)
# 서버 재시작
npm run dev
# 또는
yarn dev
```

---

## 3. 프로덕션 환경 설정 (Vercel)

### 3-1. Vercel 대시보드 접속

1. https://vercel.com 접속
2. 로그인
3. 프로젝트 선택

### 3-2. 환경변수 추가

1. **Settings** 클릭
2. **Environment Variables** 클릭
3. 다음 환경변수를 하나씩 추가:

#### 페이앱 결제
- `PAYAPP_USERID` = `hyeseon28`
- `PAYAPP_LINKKEY` = `CPe1Qyvoll6bPRHfd5pTZO1DPJnCCRVaOgT+oqg6zaM=`
- `PAYAPP_LINKVAL` = `CPe1Qyvoll6bPRHfd5pTZJKhziNbvfVO9tbzpmrIe6s=`

#### 웰컴페이먼츠 결제
- `PG_SIGNKEY` = (실제 값)
- `PG_MID_AUTH` = (실제 값)
- `PG_FIELD_ENCRYPT_IV` = (실제 값)
- `PG_FIELD_ENCRYPT_KEY` = (실제 값)
- `PG_SIGNKEY_NON_AUTH` = (실제 값)
- `PG_MID_NON_AUTH` = (실제 값)
- `PG_FIELD_ENCRYPT_IV_NON_AUTH` = (실제 값)
- `PG_FIELD_ENCRYPT_KEY_NON_AUTH` = (실제 값)
- `NEXT_PUBLIC_WELCOME_PAY_URL` = `https://pay.welcomepayments.co.kr/payment`
- `WELCOME_PAY_URL` = `https://pay.welcomepayments.co.kr/payment`

#### Gemini AI
- `GEMINI_API_KEY` = (실제 API 키)
- `GEMINI_MODEL` = `gemini-flash-latest` (선택사항, 기본값 사용 시 생략 가능)

#### 기본 설정
- `NEXT_PUBLIC_BASE_URL` = `https://www.cruisedot.co.kr`

### 3-3. 환경별 설정 (선택사항)

각 환경변수 추가 시 **Environment** 선택:
- **Production**: 프로덕션 환경
- **Preview**: 프리뷰 환경
- **Development**: 개발 환경

모든 환경에 적용하려면 세 가지 모두 선택하세요.

### 3-4. 재배포

환경변수 추가 후:
1. **Deployments** 탭 클릭
2. 최신 배포의 **"..."** 메뉴 클릭
3. **Redeploy** 선택
4. 재배포 완료 대기

---

## 4. 각 환경변수 설명

### 4-1. 페이앱 결제

| 환경변수 | 설명 | 필수 | 예시 |
|---------|------|------|------|
| `PAYAPP_USERID` | 페이앱 판매자 아이디 | ✅ | `hyeseon28` |
| `PAYAPP_LINKKEY` | 페이앱 연동 KEY | ✅ | `CPe1Qyvoll6bPRHfd5pTZO1DPJnCCRVaOgT+oqg6zaM=` |
| `PAYAPP_LINKVAL` | 페이앱 연동 VALUE (feedback 검증용) | ✅ | `CPe1Qyvoll6bPRHfd5pTZJKhziNbvfVO9tbzpmrIe6s=` |

**확인 방법:**
- PayApp 판매자 사이트: https://www.payapp.kr
- **설정** → **연동정보** 탭

### 4-2. 웰컴페이먼츠 결제

#### 인증 결제 (본인인증)
| 환경변수 | 설명 | 필수 | 예시 |
|---------|------|------|------|
| `PG_SIGNKEY` | 서명 키 | ✅ | (웰컴페이먼츠에서 발급) |
| `PG_MID_AUTH` | 상점 ID (인증) | ✅ | (웰컴페이먼츠에서 발급) |
| `PG_FIELD_ENCRYPT_IV` | 암호화 IV | ✅ | (웰컴페이먼츠에서 발급) |
| `PG_FIELD_ENCRYPT_KEY` | 암호화 키 | ✅ | (웰컴페이먼츠에서 발급) |

#### 비인증 결제 (카드번호 입력)
| 환경변수 | 설명 | 필수 | 예시 |
|---------|------|------|------|
| `PG_SIGNKEY_NON_AUTH` | 서명 키 (비인증) | ✅ | (웰컴페이먼츠에서 발급) |
| `PG_MID_NON_AUTH` | 상점 ID (비인증) | ✅ | (웰컴페이먼츠에서 발급) |
| `PG_FIELD_ENCRYPT_IV_NON_AUTH` | 암호화 IV (비인증) | ✅ | (웰컴페이먼츠에서 발급) |
| `PG_FIELD_ENCRYPT_KEY_NON_AUTH` | 암호화 키 (비인증) | ✅ | (웰컴페이먼츠에서 발급) |

#### 결제 페이지 URL
| 환경변수 | 설명 | 필수 | 예시 |
|---------|------|------|------|
| `NEXT_PUBLIC_WELCOME_PAY_URL` | 웰컴페이먼츠 결제 페이지 URL | ✅ | `https://pay.welcomepayments.co.kr/payment` |
| `WELCOME_PAY_URL` | 웰컴페이먼츠 결제 페이지 URL (대체) | ⚠️ | `https://pay.welcomepayments.co.kr/payment` |

**확인 방법:**
- 웰컴페이먼츠 관리자 페이지에서 연동 정보 확인

### 4-3. Gemini AI

| 환경변수 | 설명 | 필수 | 예시 |
|---------|------|------|------|
| `GEMINI_API_KEY` | Google Gemini API 키 | ✅ | `AIzaSy...` |
| `GOOGLE_GENERATIVE_AI_API_KEY` | Google Generative AI API 키 (대체) | ⚠️ | `AIzaSy...` |
| `GEMINI_MODEL` | Gemini 모델 이름 (선택) | ❌ | `gemini-flash-latest` |

**⚠️ 중요:** 
- `GEMINI_API_KEY`가 우선 사용됩니다
- 둘 중 하나만 설정해도 됩니다
- `GEMINI_MODEL`을 설정하지 않으면 기본값 `gemini-flash-latest` 사용

**발급 방법:**
1. Google AI Studio 접속: https://aistudio.google.com
2. **Get API Key** 클릭
3. 새 프로젝트 생성 또는 기존 프로젝트 선택
4. API 키 복사
5. `.env.local`에 `GEMINI_API_KEY`로 저장

**사용 가능한 모델:**
- `gemini-flash-latest` (기본값, 추천) - 빠르고 경제적
- `gemini-pro-latest` - 더 강력하지만 느림
- `gemini-1.5-flash` → 자동으로 `gemini-flash-latest`로 변환
- `gemini-1.5-pro` → 자동으로 `gemini-pro-latest`로 변환

### 4-4. 기본 설정

| 환경변수 | 설명 | 필수 | 예시 |
|---------|------|------|------|
| `NEXT_PUBLIC_BASE_URL` | 웹사이트 기본 URL | ✅ | `https://www.cruisedot.co.kr` |
| `DATABASE_URL` | 데이터베이스 연결 URL | ✅ | `postgresql://...` |

**⚠️ 중요:**
- `NEXT_PUBLIC_BASE_URL`은 마지막 슬래시(`/`) 없이 설정
- PayApp feedback URL 생성에 사용됨

---

## 5. 설정 확인 방법

### 5-1. 로컬 개발 환경 확인

**방법 1: 서버 로그 확인**
```bash
# 서버 시작 시 환경변수 확인
npm run dev
```

서버 시작 시 에러가 없으면 환경변수가 올바르게 로드된 것입니다.

**방법 2: API 엔드포인트로 확인 (개발용)**

임시로 API를 만들어 확인할 수 있습니다:

```typescript
// app/api/debug/env/route.ts (개발용, 배포 전 삭제)
export async function GET() {
  return Response.json({
    hasPayApp: {
      userid: !!process.env.PAYAPP_USERID,
      linkkey: !!process.env.PAYAPP_LINKKEY,
      linkval: !!process.env.PAYAPP_LINKVAL,
    },
    hasWelcomePay: {
      signkey: !!process.env.PG_SIGNKEY,
      midAuth: !!process.env.PG_MID_AUTH,
      welcomePayUrl: !!process.env.NEXT_PUBLIC_WELCOME_PAY_URL,
    },
    hasGemini: {
      geminiKey: !!process.env.GEMINI_API_KEY,
      googleKey: !!process.env.GOOGLE_GENERATIVE_AI_API_KEY,
    },
    baseUrl: process.env.NEXT_PUBLIC_BASE_URL,
  });
}
```

**⚠️ 보안 주의:** 이 API는 개발 환경에서만 사용하고, 배포 전에 반드시 삭제하세요!

### 5-2. 프로덕션 환경 확인

**방법 1: Vercel 대시보드 확인**
1. Vercel → Settings → Environment Variables
2. 모든 환경변수가 추가되어 있는지 확인

**방법 2: 기능 테스트**
- 페이앱 결제 테스트
- 웰컴페이먼츠 결제 테스트
- Gemini AI 채팅 테스트

### 5-3. 환경변수 누락 시 에러

| 에러 메시지 | 누락된 환경변수 |
|------------|----------------|
| `PayApp 설정이 완료되지 않았습니다` | `PAYAPP_USERID`, `PAYAPP_LINKKEY` |
| `PG 결제 설정이 완료되지 않았습니다` | `PG_SIGNKEY`, `PG_MID_AUTH` 등 |
| `Missing GEMINI_API_KEY` | `GEMINI_API_KEY` |
| `결제 프로바이더 URL이 설정되지 않았습니다` | `NEXT_PUBLIC_WELCOME_PAY_URL` |

---

## 6. 빠른 설정 체크리스트

### 로컬 개발 환경
- [ ] `.env.local` 파일 생성
- [ ] 페이앱 환경변수 3개 추가
- [ ] 웰컴페이먼츠 환경변수 10개 추가
- [ ] Gemini API 키 추가
- [ ] `NEXT_PUBLIC_BASE_URL` 설정
- [ ] 서버 재시작
- [ ] 기능 테스트

### 프로덕션 환경 (Vercel)
- [ ] Vercel 대시보드 접속
- [ ] Settings → Environment Variables
- [ ] 페이앱 환경변수 3개 추가
- [ ] 웰컴페이먼츠 환경변수 10개 추가
- [ ] Gemini API 키 추가
- [ ] `NEXT_PUBLIC_BASE_URL` 설정
- [ ] Redeploy 실행
- [ ] 기능 테스트

---

## 7. 문제 해결

### 7-1. 환경변수가 적용되지 않는 경우

**로컬 개발:**
1. `.env.local` 파일이 프로젝트 루트에 있는지 확인
2. 서버 재시작 확인
3. 파일 이름 확인 (`.env.local` 정확히)

**프로덕션:**
1. Vercel에서 환경변수 이름 확인 (대소문자 정확히)
2. Redeploy 실행
3. 환경변수가 올바른 Environment에 설정되었는지 확인

### 7-2. 특정 기능이 작동하지 않는 경우

**페이앱 결제:**
- `PAYAPP_USERID`, `PAYAPP_LINKKEY`, `PAYAPP_LINKVAL` 확인
- PayApp 판매자 사이트에서 연동 정보 재확인

**웰컴페이먼츠 결제:**
- 모든 `PG_*` 환경변수 확인
- 웰컴페이먼츠 관리자 페이지에서 연동 정보 재확인

**Gemini AI:**
- `GEMINI_API_KEY` 확인
- Google AI Studio에서 API 키 유효성 확인
- API 키 할당량 확인

---

## 8. 보안 주의사항

### ⚠️ 절대 공개하지 마세요
- `PAYAPP_LINKKEY`, `PAYAPP_LINKVAL`
- `PG_SIGNKEY`, `PG_FIELD_ENCRYPT_KEY` 등 모든 PG 관련 키
- `GEMINI_API_KEY`
- `DATABASE_URL`

### ✅ 안전한 관리 방법
- `.env.local` 파일은 `.gitignore`에 포함되어 있어야 함
- GitHub에 환경변수를 커밋하지 마세요
- Vercel 환경변수는 암호화되어 저장됨
- 팀원과 공유할 때는 안전한 방법 사용 (예: 1Password, LastPass)

---

**설정 완료 후 모든 기능을 테스트해보세요!** 🚀

