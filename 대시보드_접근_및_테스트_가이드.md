# 대시보드 접근 및 테스트 가이드

## 📊 대시보드 목록

### 1. 관리자 패널 대시보드
### 2. 대리점장 (팀 성과) 대시보드
### 3. 판매원 대시보드

---

## 1. 관리자 패널 대시보드

### 📍 접근 경로
- **URL**: `/admin/dashboard`
- **메뉴 위치**: 관리자 패널 → 기본 메뉴 → "대시보드" (📊)

### 🔐 접근 방법
1. 관리자 로그인 페이지 접속: `/admin/login`
2. 로그인 정보 입력:
   - 이름: 관리자 이름
   - 전화번호: 관리자 전화번호
   - 비밀번호: 관리자 비밀번호
   - 모드: `admin` (자동 설정)
3. 로그인 성공 시 자동으로 `/admin` 또는 `/admin/dashboard`로 이동

### 📋 대시보드 기능
- **사용자 통계**: 총 사용자, 활성 사용자, 휴면 사용자, 지니/몰 사용자
- **여행 통계**: 총 여행, 예정 여행, 진행 중 여행, 완료 여행
- **현재 여행**: 진행 중인 여행 목록
- **만족도**: 평균 점수, 최근 피드백
- **알림 통계**: 총 알림 수, 타입별 통계
- **PWA 설치 통계**: 지니/몰 설치 수
- **상품 통계**: 총 상품 수
- **트렌드 차트**: 사용자/여행 추이
- **인기 크루즈/국가**: 조회수 기준
- **모니터링 데이터**: 계약 통계, DB 복구 이슈, 수수료 오류

### 🧪 테스트 방법

#### 테스트 계정 준비
```sql
-- 관리자 계정 확인
SELECT id, name, phone, role FROM "User" WHERE role = 'admin' LIMIT 5;
```

#### 테스트 시나리오
1. **기본 접근 테스트**
   - 관리자 계정으로 로그인
   - `/admin/dashboard` 접근 확인
   - 모든 통계 카드가 표시되는지 확인

2. **데이터 로드 테스트**
   - 페이지 로드 시 데이터가 정상적으로 표시되는지 확인
   - 5분마다 자동 갱신되는지 확인 (브라우저 개발자 도구 Network 탭)

3. **차트 테스트**
   - 트렌드 차트가 정상적으로 렌더링되는지 확인
   - 데이터가 없을 때 빈 상태가 표시되는지 확인

4. **모니터링 테스트**
   - 계약 통계가 정확히 표시되는지 확인
   - DB 복구 이슈가 있을 때 경고 표시 확인
   - 수수료 오류가 있을 때 목록 표시 확인

---

## 2. 대리점장 (팀 성과) 대시보드

### 📍 접근 경로
- **URL**: `/admin/affiliate/team-dashboard`
- **메뉴 위치**: 관리자 패널 → 어필리에이트 섹션 → "팀 성과 대시보드" (📈)

### 🔐 접근 방법
1. 관리자 로그인 필요 (동일한 로그인 사용)
2. 관리자 패널 메뉴에서 "팀 성과 대시보드" 클릭
3. 또는 직접 URL 입력: `/admin/affiliate/team-dashboard`

### 📋 대시보드 기능
- **대리점장별 통계**:
  - 담당 판매원 수
  - 리드 통계 (총 리드, 상태별 리드)
  - 판매 통계 (판매 건수, 판매 금액, 순수익)
  - 수수료 통계 (지점 수수료, 오버라이드 수수료, 판매 수수료)
  - 원장 통계 (정산 완료/대기, 원천징수, 총 수수료)
  - 월별 트렌드
- **판매원별 상세 정보**:
  - 각 판매원의 성과 지표
  - 판매원-대리점장 관계 상태
  - 판매원별 리드/판매 통계
- **필터링**:
  - 대리점장별 필터
  - 날짜 범위 필터
- **검색 기능**: 판매원 검색

### 🧪 테스트 방법

#### 테스트 데이터 준비
```sql
-- 대리점장(manager) 계정 확인
SELECT id, name, phone, role, "affiliateCode" 
FROM "User" 
WHERE role = 'manager' 
LIMIT 5;

-- 판매원(agent) 계정 확인
SELECT id, name, phone, role, "affiliateCode" 
FROM "User" 
WHERE role = 'agent' 
LIMIT 5;

-- 대리점장-판매원 관계 확인
SELECT * FROM "AffiliateRelation" 
WHERE "relationType" = 'manager-agent' 
LIMIT 5;
```

#### 테스트 시나리오
1. **기본 접근 테스트**
   - 관리자로 로그인
   - `/admin/affiliate/team-dashboard` 접근
   - 대리점장 목록이 표시되는지 확인

2. **데이터 표시 테스트**
   - 대리점장별 통계 카드 확인
   - 판매원 목록 펼치기/접기 기능 테스트
   - 판매원별 상세 정보 확인

3. **필터링 테스트**
   - 대리점장 선택 필터 테스트
   - 날짜 범위 필터 테스트
   - 검색 기능 테스트

4. **트렌드 차트 테스트**
   - 월별 트렌드 차트가 정상 표시되는지 확인
   - 데이터가 없을 때 빈 상태 확인

5. **실시간 갱신 테스트**
   - 새 판매 데이터 추가 후 새로고침
   - 통계가 업데이트되는지 확인

---

## 3. 판매원 대시보드

### 📍 접근 경로
- **URL**: `/admin/affiliate/agent-dashboard`
- **메뉴 위치**: 관리자 패널 → 어필리에이트 섹션 → "판매원 대시보드" (🧑‍💼)

### 🔐 접근 방법
1. 관리자 로그인 필요 (동일한 로그인 사용)
2. 관리자 패널 메뉴에서 "판매원 대시보드" 클릭
3. 또는 직접 URL 입력: `/admin/affiliate/agent-dashboard`

### 📋 대시보드 기능
- **판매원별 통계**:
  - 담당 대리점장 정보 (관계 상태, 연결일)
  - 리드 통계 (총 리드, 상태별 리드)
  - 판매 통계 (판매 건수, 판매 금액, 순수익)
  - 수수료 통계 (판매 수수료, 오버라이드 수수료, 지점 기여도)
  - 원장 통계 (정산 완료/대기, 원천징수)
- **대리점장 필터**: 특정 대리점장의 판매원만 조회
- **검색 기능**: 판매원 검색
- **정렬 기능**: 다양한 기준으로 정렬

### 🧪 테스트 방법

#### 테스트 데이터 준비
```sql
-- 판매원 계정 확인
SELECT id, name, phone, role, "affiliateCode", "displayName", "nickname"
FROM "User" 
WHERE role = 'agent' 
LIMIT 10;

-- 판매원-대리점장 관계 확인
SELECT 
  ar.*,
  agent.name as agent_name,
  manager.name as manager_name
FROM "AffiliateRelation" ar
LEFT JOIN "User" agent ON ar."agentId" = agent.id
LEFT JOIN "User" manager ON ar."managerId" = manager.id
WHERE ar."relationType" = 'manager-agent'
LIMIT 10;

-- 판매 데이터 확인
SELECT * FROM "AffiliateSale" LIMIT 10;
```

#### 테스트 시나리오
1. **기본 접근 테스트**
   - 관리자로 로그인
   - `/admin/affiliate/agent-dashboard` 접근
   - 판매원 목록이 표시되는지 확인

2. **데이터 표시 테스트**
   - 각 판매원의 통계 카드 확인
   - 대리점장 정보 표시 확인
   - 리드/판매/수수료 통계 정확성 확인

3. **필터링 테스트**
   - 대리점장 선택 필터 테스트
   - 검색 기능 테스트 (이름, 코드 등)

4. **정렬 테스트**
   - 다양한 정렬 기준 테스트
   - 정렬 방향(오름차순/내림차순) 테스트

5. **관계 상태 테스트**
   - 대리점장과 연결된 판매원 표시 확인
   - 연결되지 않은 판매원 표시 확인
   - 관계 상태(active/pending 등) 확인

---

## 🔧 공통 테스트 체크리스트

### 인증 및 권한
- [ ] 관리자 계정으로만 접근 가능한지 확인
- [ ] 비로그인 상태에서 접근 시 로그인 페이지로 리다이렉트되는지 확인
- [ ] 세션 만료 시 재로그인 요구되는지 확인

### 데이터 로드
- [ ] 페이지 로드 시 데이터가 정상적으로 표시되는지 확인
- [ ] 로딩 상태 표시 확인
- [ ] 에러 발생 시 에러 메시지 표시 확인
- [ ] 빈 데이터 상태 처리 확인

### 성능
- [ ] 페이지 로드 시간 확인 (3초 이내 권장)
- [ ] 대량 데이터 처리 시 성능 확인
- [ ] 자동 갱신 시 서버 부하 확인

### 반응형 디자인
- [ ] 모바일 화면에서 정상 표시되는지 확인
- [ ] 태블릿 화면에서 정상 표시되는지 확인
- [ ] 데스크톱 화면에서 정상 표시되는지 확인

### 브라우저 호환성
- [ ] Chrome에서 정상 작동 확인
- [ ] Safari에서 정상 작동 확인
- [ ] Firefox에서 정상 작동 확인
- [ ] Edge에서 정상 작동 확인

---

## 🚀 빠른 테스트 가이드

### 1단계: 관리자 로그인
```bash
# 브라우저에서 접속
http://localhost:3000/admin/login
# 또는 프로덕션 URL
https://your-domain.com/admin/login

# 로그인 정보 입력
이름: [관리자 이름]
전화번호: [관리자 전화번호]
비밀번호: [관리자 비밀번호]
```

### 2단계: 각 대시보드 접근

#### 관리자 패널 대시보드
```
URL: /admin/dashboard
또는 메뉴에서 "대시보드" 클릭
```

#### 대리점장 대시보드
```
URL: /admin/affiliate/team-dashboard
또는 메뉴에서 "팀 성과 대시보드" 클릭
```

#### 판매원 대시보드
```
URL: /admin/affiliate/agent-dashboard
또는 메뉴에서 "판매원 대시보드" 클릭
```

### 3단계: 기능 테스트
1. 각 대시보드의 통계 카드 확인
2. 필터링 기능 테스트
3. 검색 기능 테스트
4. 정렬 기능 테스트 (해당되는 경우)
5. 차트/그래프 렌더링 확인

---

## 📝 테스트 계정 생성 방법

### 관리자 계정 생성
```sql
-- 관리자 계정 생성 (비밀번호는 해시화 필요)
INSERT INTO "User" (name, phone, password, role, "createdAt", "updatedAt")
VALUES (
  '테스트 관리자',
  '01012345678',
  '$2b$10$...', -- bcrypt 해시된 비밀번호
  'admin',
  NOW(),
  NOW()
);
```

### 대리점장 계정 생성
```sql
-- 대리점장 계정 생성
INSERT INTO "User" (name, phone, password, role, "affiliateCode", "createdAt", "updatedAt")
VALUES (
  '테스트 대리점장',
  '01087654321',
  '$2b$10$...', -- bcrypt 해시된 비밀번호
  'manager',
  'MGR001',
  NOW(),
  NOW()
);
```

### 판매원 계정 생성
```sql
-- 판매원 계정 생성
INSERT INTO "User" (name, phone, password, role, "affiliateCode", "createdAt", "updatedAt")
VALUES (
  '테스트 판매원',
  '01011112222',
  '$2b$10$...', -- bcrypt 해시된 비밀번호
  'agent',
  'AGT001',
  NOW(),
  NOW()
);
```

### 관계 설정
```sql
-- 대리점장-판매원 관계 설정
INSERT INTO "AffiliateRelation" (
  "managerId", 
  "agentId", 
  "relationType", 
  "status", 
  "connectedAt",
  "createdAt", 
  "updatedAt"
)
VALUES (
  [대리점장 ID],
  [판매원 ID],
  'manager-agent',
  'active',
  NOW(),
  NOW(),
  NOW()
);
```

---

## ⚠️ 주의사항

1. **권한 확인**: 모든 대시보드는 관리자 권한이 필요합니다.
2. **데이터 의존성**: 대시보드는 실제 데이터가 있어야 정상적으로 표시됩니다.
3. **세션 관리**: 로그인 세션이 만료되면 자동으로 로그인 페이지로 이동합니다.
4. **캐싱**: 일부 데이터는 5분간 캐시되므로 즉시 반영되지 않을 수 있습니다.

---

## 🐛 문제 해결

### 대시보드가 로드되지 않는 경우
1. 브라우저 콘솔에서 에러 확인
2. 네트워크 탭에서 API 요청 상태 확인
3. 서버 로그 확인
4. 데이터베이스 연결 상태 확인

### 데이터가 표시되지 않는 경우
1. 데이터베이스에 실제 데이터가 있는지 확인
2. API 엔드포인트가 정상 작동하는지 확인
3. 필터 조건이 너무 제한적인지 확인

### 권한 오류가 발생하는 경우
1. 로그인 상태 확인
2. 사용자 role이 'admin'인지 확인
3. 세션 쿠키 확인

---

## 📞 추가 지원

문제가 발생하거나 추가 도움이 필요한 경우:
1. 브라우저 개발자 도구에서 에러 로그 확인
2. 서버 로그 확인
3. 데이터베이스 쿼리 로그 확인

