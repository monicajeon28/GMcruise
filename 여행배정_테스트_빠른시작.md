# 🚀 여행배정 기능 테스트 - 빠른 시작 가이드

## ✅ 준비 완료!

테스트 데이터가 이미 생성되어 있습니다. 바로 테스트를 시작할 수 있습니다.

---

## 📋 테스트 계정 정보

### 관리자 계정
```
이름: 테스트 관리자
전화번호: 010-0000-0001
비밀번호: admin123
```

### 크루즈 가이드 사용자 (여행 배정 대상)
```
이름: 홍길동
전화번호: 010-1234-5678
비밀번호: 3800
```

### 구매 고객 (자동 로드 테스트용)
```
이름: 김구매
전화번호: 010-9876-5432
상태: purchase_confirmed
```

### 테스트 상품
```
상품명: MSC 벨리시마 일본 4박 5일
상품코드: TEST-001
```

---

## 🧪 테스트 단계

### 1단계: 관리자 로그인

1. 브라우저에서 `/admin/login` 접근
2. 다음 정보 입력:
   - 이름: `테스트 관리자`
   - 전화번호: `010-0000-0001`
   - 비밀번호: `admin123`
3. "관리자 로그인" 버튼 클릭
4. ✅ 대시보드로 이동되면 성공

---

### 2단계: 여행배정 페이지 접근

1. 사이드바에서 "✈️ 여행 배정" 메뉴 클릭
2. 또는 직접 `/admin/assign-trip` 접근
3. ✅ 여행배정 폼이 표시되면 성공

---

### 3단계: 기본 여행 배정 테스트

#### 3-1. 크루즈 가이드 사용자 검색 (필수)

1. "크루즈 가이드 사용자 검색" 입력창 클릭
2. 드롭다운이 자동으로 열림
3. 검색어 입력: `홍길동` 또는 `010-1234-5678`
4. 검색 결과에서 사용자 선택
5. ✅ 선택된 사용자 정보가 초록색 박스에 표시되면 성공

#### 3-2. 상품 검색 (필수)

1. "크루즈몰 상품 검색" 입력창 클릭
2. 드롭다운이 자동으로 열림
3. 검색어 입력: `MSC` 또는 `벨리시마` 또는 `TEST-001`
4. 검색 결과에서 상품 선택
5. ✅ 다음이 자동으로 채워지면 성공:
   - 크루즈명
   - 여행 시작일
   - 여행 종료일
   - 목적지
   - 여행 정보 박스 (박/일, D-day)

#### 3-3. 여행 정보 확인

1. 파란색 "여행 정보" 박스 확인:
   - 여행 기간: 4박 5일
   - 출발까지: D-XX (날짜에 따라 다름)
   - 여행 시작일/종료일
2. 필요시 날짜 수정 가능
3. 동행 유형 선택 (선택사항): 가족/커플/친구/혼자

#### 3-4. 여행 배정 제출

1. "여행 배정하기" 버튼 클릭
2. ✅ 성공 메시지 확인:
   - "여행이 배정되었습니다! 크루즈 가이드 지니가 활성화되었습니다."
3. ✅ 폼이 초기화되면 성공

---

### 4단계: 구매 고객 기반 자동 배정 테스트

#### 4-1. 구매 고객 검색

1. "구매 고객 검색" 입력창 클릭
2. 검색어 입력: `김구매` 또는 `010-9876-5432`
3. 검색 결과에서 고객 선택
4. ✅ 자동으로 다음이 로드되면 성공:
   - 여행 상품 정보
   - 크루즈 가이드 사용자 자동 검색 및 매칭 시도

#### 4-2. 여행 배정 완료

1. 자동 로드된 정보 확인
2. "여행 배정하기" 버튼 클릭
3. ✅ 성공 메시지 확인

---

## ✅ 성공 확인 체크리스트

여행 배정 후 다음을 확인하세요:

- [ ] 성공 메시지 표시됨
- [ ] 폼이 초기화됨
- [ ] 사용자 비밀번호가 3800으로 변경됨 (DB 확인)
- [ ] Trip 레코드 생성됨 (DB 확인)
- [ ] Itinerary 레코드 생성됨 (DB 확인)
- [ ] 사용자 onboarded = true (DB 확인)
- [ ] 사용자 totalTripCount 증가 (DB 확인)

---

## 🔍 데이터베이스 확인 (선택사항)

### 사용자 정보 확인
```sql
SELECT id, name, phone, onboarded, totalTripCount, password 
FROM "User" 
WHERE phone = '010-1234-5678';
```

### 여행 정보 확인
```sql
SELECT * FROM "Trip" 
WHERE "userId" = [사용자 ID] 
ORDER BY "id" DESC LIMIT 1;
```

### 일정 정보 확인
```sql
SELECT * FROM "Itinerary" 
WHERE "tripId" = [Trip ID] 
ORDER BY day;
```

---

## 🎯 배정된 사용자 로그인 테스트

여행 배정 후 해당 사용자로 로그인하여 확인:

1. `/login` 페이지 접근
2. 다음 정보 입력:
   - 이름: `홍길동`
   - 전화번호: `010-1234-5678`
   - 비밀번호: `3800`
3. ✅ 로그인 성공 후 `/chat`으로 이동
4. ✅ 지니가 활성화되어 대화 가능

---

## ❌ 문제 해결

### 문제: 관리자 로그인 실패
- 관리자 계정의 role이 'admin'인지 확인
- 브라우저 쿠키/세션 초기화 후 재시도

### 문제: 사용자 검색 결과 없음
- 사용자의 role이 'user'인지 확인
- 브라우저 콘솔에서 API 응답 확인

### 문제: 상품 검색 결과 없음
- 상품이 존재하는지 확인
- API 응답 확인: `/api/admin/products/search?q=`

### 문제: 여행 배정 실패
- 브라우저 개발자 도구 → Network 탭 확인
- API 응답 확인: `/api/admin/users/[userId]/trips/[tripId]/onboarding`
- 서버 로그 확인 (터미널)
- 필수 필드 모두 입력되었는지 확인

---

## 📚 상세 가이드

더 자세한 테스트 가이드는 `여행배정_기능_테스트_가이드.md` 파일을 참고하세요.

---

## 🎉 테스트 완료!

모든 단계를 완료했다면 여행배정 기능이 정상 작동하는 것입니다! 🚀

