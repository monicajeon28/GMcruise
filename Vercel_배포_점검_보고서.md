# Vercel λ°°ν¬ μ κ²€ λ³΄κ³ μ„

**μ‘μ„± μΌμ‹**: 2025λ…„ 1μ›” 28μΌ  
**λ©μ **: Vercel λ°°ν¬ κ°€λ¥ μ—¬λ¶€ λ° ν•„μ μ„¤μ • ν™•μΈ

---

## β… λ°°ν¬ κ°€λ¥ μ—¬λ¶€: **λ°°ν¬ κ°€λ¥**

---

## π“‹ ν•„μ ν™κ²½ λ³€μ ν™•μΈ

### π”΄ ν•„μ (λ°λ“μ‹ μ„¤μ • ν•„μ”)

| ν™κ²½ λ³€μ | μ©λ„ | ν„μ¬ μƒνƒ |
|---------|------|----------|
| `DATABASE_URL` | PostgreSQL μ—°κ²° | β… ν•„μ |
| `GEMINI_API_KEY` | AI μ±„ν… κΈ°λ¥ | β… ν•„μ |

### π΅ μ„ νƒμ  (κΈ°λ¥λ³„λ΅ ν•„μ”)

| ν™κ²½ λ³€μ | μ©λ„ | μν–¥ |
|---------|------|------|
| `SESSION_SECRET` | μ„Έμ… μ•”νΈν™” | μ„Έμ… λ³΄μ• |
| `NEXT_PUBLIC_BASE_URL` | κ³µκ° URL | λ§ν¬ μƒμ„± |
| `ALIGO_API_KEY` | SMS μ „μ†΅ | SMS κΈ°λ¥ |
| `ALIGO_USER_ID` | μ•λ¦¬κ³  μΈμ¦ | SMS κΈ°λ¥ |
| `ALIGO_SENDER_PHONE` | λ°μ‹ λ²νΈ | SMS κΈ°λ¥ |
| `YOUTUBE_API_KEY` | YouTube μμƒ | YouTube κΈ°λ¥ |
| `KAKAO_REST_API_KEY` | μΉ΄μΉ΄μ¤ λ΅κ·ΈμΈ | μΉ΄μΉ΄μ¤ κΈ°λ¥ |
| `PG_*` | κ²°μ  μ‹μ¤ν… | κ²°μ  κΈ°λ¥ |

---

## β… λΉλ“ μ„¤μ • ν™•μΈ

### 1. λΉλ“ μ¤ν¬λ¦½νΈ β…

**νμΌ**: `package.json`

```json
"build": "prisma generate && npm run images:build && npm run pwa:icons && next build"
```

**ν™•μΈ μ‚¬ν•­**:
- β… Prisma ν΄λΌμ΄μ–ΈνΈ μƒμ„± (`prisma generate`)
- β… μ΄λ―Έμ§€ λ§¤λ‹νμ¤νΈ μƒμ„± (`images:build`)
- β… PWA μ•„μ΄μ½ μƒμ„± (`pwa:icons`)
- β… Next.js λΉλ“ (`next build`)

**Postinstall μ¤ν¬λ¦½νΈ**:
```json
"postinstall": "prisma generate"
```

**μƒνƒ**: β… μ •μƒ - Vercelμ—μ„ μλ™μΌλ΅ μ‹¤ν–‰λ¨

---

### 2. Vercel μ„¤μ • νμΌ β…

**νμΌ**: `vercel.json`

```json
{
  "buildCommand": "npm run build",
  "installCommand": "npm install",
  "build": {
    "env": {
      "PRISMA_GENERATE_SKIP_AUTOINSTALL": "false"
    }
  },
  "crons": [
    {
      "path": "/api/cron/database-backup",
      "schedule": "0 3 * * *"
    },
    {
      "path": "/api/cron/expire-trips",
      "schedule": "0 5 * * *"
    },
    {
      "path": "/api/cron/payslip-sender",
      "schedule": "0 3 1 * *"
    },
    {
      "path": "/api/cron/community-bot",
      "schedule": "0 17 * * *"
    }
  ]
}
```

**ν™•μΈ μ‚¬ν•­**:
- β… λΉλ“ λ…λ Ήμ–΄ μ„¤μ •λ¨
- β… Prisma μλ™ μ„¤μΉ ν™μ„±ν™”
- β… Cron μ‘μ—… μ„¤μ •λ¨ (4κ°)

**μƒνƒ**: β… μ •μƒ

---

### 3. Next.js μ„¤μ • β…

**νμΌ**: `next.config.mjs`

**ν™•μΈ μ‚¬ν•­**:
- β… TypeScript λΉλ“ μ—λ¬ λ¬΄μ‹ μ„¤μ •λ¨ (`ignoreBuildErrors: true`)
- β… ESLint λΉλ“ μ—λ¬ λ¬΄μ‹ μ„¤μ •λ¨ (`ignoreDuringBuilds: true`)
- β… Prisma λ°”μ΄λ„λ¦¬ νƒ€κ² μ„¤μ •λ¨ (`rhel-openssl-3.0.x`)
- β… μ¶λ ¥ νμΌ μ¶”μ  μµμ ν™” μ„¤μ •λ¨

**μƒνƒ**: β… μ •μƒ

---

### 4. Prisma μ„¤μ • β…

**νμΌ**: `prisma/schema.prisma`

**ν™•μΈ μ‚¬ν•­**:
- β… PostgreSQL μ‚¬μ©
- β… λ°”μ΄λ„λ¦¬ νƒ€κ² μ„¤μ •λ¨ (`native`, `rhel-openssl-3.0.x`)
- β… Vercel ν™κ²½ μ§€μ›

**μƒνƒ**: β… μ •μƒ

---

## β οΈ μ£Όμμ‚¬ν•­ λ° ν™•μΈ ν•„μ” μ‚¬ν•­

### 1. λ°νƒ€μ„ μ„¤μ • ν™•μΈ β…

**ν™•μΈ κ²°κ³Ό**:
- β… λ€λ¶€λ¶„μ APIκ°€ `nodejs` λ°νƒ€μ„ μ‚¬μ©
- β… Prisma μ‚¬μ© APIλ” λ¨λ‘ `nodejs` μ„¤μ •λ¨
- β… Edge Runtime μ‚¬μ©ν•λ” API μ—†μ

**μƒνƒ**: β… μ •μƒ

---

### 2. μμ΅΄μ„± ν™•μΈ β…

**ν™•μΈ κ²°κ³Ό**:
- β… λ¨λ“  ν•„μ μμ΅΄μ„± μ„¤μΉλ¨
- β… Prisma ν΄λΌμ΄μ–ΈνΈ ν¬ν•¨λ¨
- β… Next.js 14.2.3 μ‚¬μ© (Vercel νΈν™)

**μ£Όμμ‚¬ν•­**:
- β οΈ `puppeteer` ν¬ν•¨λ¨ (λ€μ©λ‰ ν¨ν‚¤μ§€)
- β οΈ `googleapis` ν¬ν•¨λ¨ (λ€μ©λ‰ ν¨ν‚¤μ§€)
- β… `next.config.mjs`μ—μ„ μ μ™Έ μ„¤μ •λ¨

**μƒνƒ**: β… μ •μƒ (μµμ ν™” μ„¤μ •λ¨)

---

### 3. λΉλ“ μµμ ν™” ν™•μΈ β…

**ν™•μΈ κ²°κ³Ό**:
- β… `outputFileTracingExcludes` μ„¤μ •λ¨
- β… λ€μ©λ‰ ν¨ν‚¤μ§€ μ μ™Έ μ„¤μ •λ¨
- β… λ¶ν•„μ”ν• νμΌ μ μ™Έ μ„¤μ •λ¨

**μƒνƒ**: β… μ •μƒ

---

### 4. ν™κ²½ λ³€μ μ„¤μ • ν•„μ” β…

**Vercel λ€μ‹λ³΄λ“μ—μ„ μ„¤μ •ν•΄μ•Ό ν•  ν™κ²½ λ³€μ**:

#### ν•„μ (λ°λ“μ‹ μ„¤μ •)
```
DATABASE_URL=postgresql://...?connection_limit=20&pool_timeout=10
GEMINI_API_KEY=AIza...
```

#### κ¶μ¥ (κΈ°λ¥ μ‚¬μ© μ‹)
```
SESSION_SECRET=λλ¤_λ¬Έμμ—΄
NEXT_PUBLIC_BASE_URL=https://your-domain.com
CRON_SECRET=λλ¤_λ¬Έμμ—΄  # Cron μ‘μ—… λ³΄μ•μ„ μ„ν•΄ ν•„μ
```

#### μ„ νƒμ  (κΈ°λ¥λ³„)
- SMS κΈ°λ¥: `ALIGO_*`
- μΉ΄μΉ΄μ¤ κΈ°λ¥: `KAKAO_*`
- κ²°μ  κΈ°λ¥: `PG_*`, `PAYAPP_*`
- YouTube κΈ°λ¥: `YOUTUBE_API_KEY`

---

## π” λ°°ν¬ μ „ μ²΄ν¬λ¦¬μ¤νΈ

### ν•„μ ν™•μΈ μ‚¬ν•­

- [ ] **ν™κ²½ λ³€μ μ„¤μ •**
  - [ ] `DATABASE_URL` μ„¤μ • (μ—°κ²° ν’€ νλΌλ―Έν„° ν¬ν•¨ κ¶μ¥)
  - [ ] `GEMINI_API_KEY` μ„¤μ •
  - [ ] `SESSION_SECRET` μ„¤μ • (μ—†μΌλ©΄ μλ™ μƒμ„±λμ§€λ§ κ¶μ¥)

- [ ] **λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²°**
  - [ ] Neon PostgreSQL μ—°κ²° ν™•μΈ
  - [ ] μ—°κ²° ν’€ μ„¤μ • ν™•μΈ (`connection_limit=20`)

- [ ] **λΉλ“ ν…μ¤νΈ**
  - [ ] λ΅μ»¬μ—μ„ `npm run build` μ„±κ³µ ν™•μΈ
  - [ ] λΉλ“ μ—λ¬ μ—†μ ν™•μΈ

- [ ] **Cron μ‘μ—… ν™•μΈ**
  - [ ] `/api/cron/database-backup` μ—”λ“ν¬μΈνΈ μ΅΄μ¬ ν™•μΈ β…
  - [ ] `/api/cron/expire-trips` μ—”λ“ν¬μΈνΈ μ΅΄μ¬ ν™•μΈ β…
  - [ ] `/api/cron/payslip-sender` μ—”λ“ν¬μΈνΈ μ΅΄μ¬ ν™•μΈ β…
  - [ ] `/api/cron/community-bot` μ—”λ“ν¬μΈνΈ μ΅΄μ¬ ν™•μΈ β…
  - [ ] `CRON_SECRET` ν™κ²½ λ³€μ μ„¤μ • ν™•μΈ

---

## π€ λ°°ν¬ λ‹¨κ³„

### 1λ‹¨κ³„: ν™κ²½ λ³€μ μ„¤μ •

Vercel λ€μ‹λ³΄λ“ β†’ Settings β†’ Environment Variables

**ν•„μ ν™κ²½ λ³€μ μ¶”κ°€**:
```
DATABASE_URL=postgresql://user:pass@host:5432/db?connection_limit=20&pool_timeout=10
GEMINI_API_KEY=AIza...
CRON_SECRET=λλ¤_λ¬Έμμ—΄_32μ_μ΄μƒ  # Cron μ‘μ—… λ³΄μ•
```

### 2λ‹¨κ³„: Git μ—°κ²° ν™•μΈ

- [ ] GitHub μ €μ¥μ† μ—°κ²° ν™•μΈ
- [ ] λ°°ν¬ λΈλμΉ ν™•μΈ (λ³΄ν†µ `main` λλ” `master`)

### 3λ‹¨κ³„: λ°°ν¬ μ‹¤ν–‰

- [ ] Vercel λ€μ‹λ³΄λ“μ—μ„ "Deploy" ν΄λ¦­
- [ ] λΉλ“ λ΅κ·Έ ν™•μΈ
- [ ] λ°°ν¬ μ™„λ£ ν™•μΈ

### 4λ‹¨κ³„: λ°°ν¬ ν›„ ν™•μΈ

- [ ] ν™νμ΄μ§€ μ ‘μ† ν™•μΈ
- [ ] λ΅κ·ΈμΈ κΈ°λ¥ ν…μ¤νΈ
- [ ] API μ—”λ“ν¬μΈνΈ ν…μ¤νΈ
- [ ] Cron μ‘μ—… λ™μ‘ ν™•μΈ

---

## β οΈ μ μ¬μ  λ¬Έμ μ  λ° ν•΄κ²° λ°©μ•

### 1. λΉλ“ μ‹κ°„ μ΄κ³Ό κ°€λ¥μ„±

**λ¬Έμ **: λ€μ©λ‰ μμ΅΄μ„±μΌλ΅ μΈν• λΉλ“ μ‹κ°„ μ΄κ³Ό

**ν™•μΈ μ‚¬ν•­**:
- β… `outputFileTracingExcludes` μ„¤μ •μΌλ΅ μµμ ν™”λ¨
- β… λ¶ν•„μ”ν• ν¨ν‚¤μ§€ μ μ™Έλ¨

**ν•΄κ²° λ°©μ•**:
- λΉλ“ μ‹κ°„μ΄ 10λ¶„ μ΄κ³Ό μ‹ Vercel Pro ν”λ ν•„μ”
- λλ” μ¶”κ°€ μµμ ν™” ν•„μ”

---

### 2. ν•¨μ ν¬κΈ° μ΄κ³Ό κ°€λ¥μ„±

**λ¬Έμ **: Vercel Function ν¬κΈ° μ ν• (50MB)

**ν™•μΈ μ‚¬ν•­**:
- β… `outputFileTracingExcludes` μ„¤μ •μΌλ΅ μµμ ν™”λ¨
- β… λ€μ©λ‰ ν¨ν‚¤μ§€ μ μ™Έλ¨

**ν•΄κ²° λ°©μ•**:
- λΉλ“ ν›„ ν•¨μ ν¬κΈ° ν™•μΈ
- ν•„μ” μ‹ μ¶”κ°€ μµμ ν™”

---

### 3. ν™κ²½ λ³€μ λ„λ½

**λ¬Έμ **: ν•„μ ν™κ²½ λ³€μ λ„λ½ μ‹ λΉλ“ μ‹¤ν¨

**ν•΄κ²° λ°©μ•**:
- λ°°ν¬ μ „ `npm run env:check` μ‹¤ν–‰
- Vercel λ€μ‹λ³΄λ“μ—μ„ ν™κ²½ λ³€μ ν™•μΈ

---

### 4. Prisma ν΄λΌμ΄μ–ΈνΈ μƒμ„± μ‹¤ν¨

**λ¬Έμ **: Prisma ν΄λΌμ΄μ–ΈνΈ μƒμ„± μ‹¤ν¨

**ν™•μΈ μ‚¬ν•­**:
- β… `postinstall` μ¤ν¬λ¦½νΈ μ„¤μ •λ¨
- β… `vercel.json`μ— Prisma μ„¤μ • μμ

**ν•΄κ²° λ°©μ•**:
- λΉλ“ λ΅κ·Έμ—μ„ Prisma μƒμ„± ν™•μΈ
- μ‹¤ν¨ μ‹ `PRISMA_GENERATE_SKIP_AUTOINSTALL` ν™•μΈ

---

### 5. Cron μ‘μ—… μ‹¤ν–‰ μ‹¤ν¨

**λ¬Έμ **: Cron μ‘μ—…μ΄ μ‹¤ν–‰λμ§€ μ•μ

**ν™•μΈ μ‚¬ν•­**:
- β… `vercel.json`μ— Cron μ„¤μ •λ¨
- β… λ¨λ“  Cron μ—”λ“ν¬μΈνΈ μ΅΄μ¬ ν™•μΈ μ™„λ£
- β οΈ `CRON_SECRET` ν™κ²½ λ³€μ ν•„μ” (λ³΄μ•)

**Cron μ—”λ“ν¬μΈνΈ μƒμ„Έ**:
- `/api/cron/database-backup` (GET) - λ§¤μΌ μ¤μ „ 3μ‹ (UTC)
- `/api/cron/expire-trips` (POST) - λ§¤μΌ μ¤μ „ 5μ‹ (UTC)
- `/api/cron/payslip-sender` (GET) - λ§¤μ›” 1μΌ μ¤μ „ 3μ‹ (UTC)
- `/api/cron/community-bot` (POST) - λ§¤μΌ μ¤ν›„ 5μ‹ (UTC)

**ν•΄κ²° λ°©μ•**:
- `CRON_SECRET` ν™κ²½ λ³€μ μ„¤μ • (Vercel λ€μ‹λ³΄λ“)
- κ° Cron μ—”λ“ν¬μΈνΈ μλ™ ν…μ¤νΈ (Authorization ν—¤λ” ν•„μ”)
- Vercel Cron λ΅κ·Έ ν™•μΈ

---

## π“ λ°°ν¬ μ¤€λΉ„ μƒνƒ

| ν•­λ© | μƒνƒ | λΉ„κ³  |
|------|------|------|
| λΉλ“ μ¤ν¬λ¦½νΈ | β… μ¤€λΉ„λ¨ | `package.json` ν™•μΈ |
| Vercel μ„¤μ • | β… μ¤€λΉ„λ¨ | `vercel.json` ν™•μΈ |
| Next.js μ„¤μ • | β… μ¤€λΉ„λ¨ | `next.config.mjs` ν™•μΈ |
| Prisma μ„¤μ • | β… μ¤€λΉ„λ¨ | `schema.prisma` ν™•μΈ |
| λ°νƒ€μ„ μ„¤μ • | β… μ¤€λΉ„λ¨ | λ¨λ“  API `nodejs` μ‚¬μ© |
| ν™κ²½ λ³€μ | β οΈ μ„¤μ • ν•„μ” | Vercel λ€μ‹λ³΄λ“μ—μ„ μ„¤μ • |
| λΉλ“ μµμ ν™” | β… μ¤€λΉ„λ¨ | μµμ ν™” μ„¤μ •λ¨ |
| Cron μ‘μ—… | β… μ¤€λΉ„λ¨ | 4κ° μ‘μ—… μ„¤μ •λ¨, μ—”λ“ν¬μΈνΈ ν™•μΈ μ™„λ£ |

---

## β… μµμΆ… κ²°λ΅ 

**λ°°ν¬ κ°€λ¥ μ—¬λ¶€**: β… **λ°°ν¬ κ°€λ¥**

**μ¤€λΉ„ μƒνƒ**: 
- β… μ½”λ“ μ¤€λΉ„ μ™„λ£
- β οΈ ν™κ²½ λ³€μ μ„¤μ • ν•„μ” (Vercel λ€μ‹λ³΄λ“)

**λ‹¤μ λ‹¨κ³„**:
1. Vercel λ€μ‹λ³΄λ“μ—μ„ ν™κ²½ λ³€μ μ„¤μ •
2. Git μ €μ¥μ† μ—°κ²° ν™•μΈ
3. λ°°ν¬ μ‹¤ν–‰
4. λ°°ν¬ ν›„ ν…μ¤νΈ

---

## π“ λ°°ν¬ μ „ μµμΆ… μ²΄ν¬λ¦¬μ¤νΈ

### ν•„μ μ‘μ—…

- [ ] Vercel λ€μ‹λ³΄λ“μ—μ„ `DATABASE_URL` μ„¤μ •
- [ ] Vercel λ€μ‹λ³΄λ“μ—μ„ `GEMINI_API_KEY` μ„¤μ •
- [ ] Vercel λ€μ‹λ³΄λ“μ—μ„ `SESSION_SECRET` μ„¤μ • (κ¶μ¥)
- [ ] Vercel λ€μ‹λ³΄λ“μ—μ„ `CRON_SECRET` μ„¤μ • (Cron μ‘μ—… λ³΄μ•)
- [ ] λ΅μ»¬μ—μ„ `npm run build` μ„±κ³µ ν™•μΈ
- [ ] Git μ €μ¥μ† μµμ‹  μƒνƒ ν™•μΈ

### κ¶μ¥ μ‘μ—…

- [ ] `NEXT_PUBLIC_BASE_URL` μ„¤μ •
- [ ] ν•„μ”ν• μ„ νƒμ  ν™κ²½ λ³€μ μ„¤μ •
- [ ] Cron μ—”λ“ν¬μΈνΈ μλ™ ν…μ¤νΈ
- [ ] λ°°ν¬ ν›„ κΈ°λ¥ ν…μ¤νΈ

---

**μ κ²€ μ™„λ£**: β…  
**λ°°ν¬ μ¤€λΉ„**: β…  
**λ‹¤μ λ‹¨κ³„**: Vercel λ€μ‹λ³΄λ“μ—μ„ ν™κ²½ λ³€μ μ„¤μ • ν›„ λ°°ν¬


