# 🛡️ 배포 전 안전장치 체크리스트

**작성일**: 2025-11-23  
**대상**: 코딩 초보자를 위한 단계별 안전장치 가이드

---

## ✅ 배포 전 필수 확인 (순서대로 진행)

### 1단계: 코드 준비 ✅

- [ ] 모든 변경사항 커밋 완료
- [ ] `.env` 파일은 커밋하지 않았는지 확인
- [ ] 불필요한 파일 삭제 완료
- [ ] Git 상태 확인: `git status`

---

### 2단계: 로컬 테스트 ✅

- [ ] 로컬에서 빌드 성공: `npm run build`
- [ ] 로컬에서 개발 서버 실행: `npm run dev`
- [ ] 주요 기능 테스트:
  - [ ] 로그인/로그아웃
  - [ ] 관리자 패널 접근
  - [ ] 핵심 기능 작동 확인

---

### 3단계: 환경 변수 확인 ✅

**Vercel 대시보드에서 확인**:
- [ ] `DATABASE_URL` 설정됨
- [ ] `NEXTAUTH_SECRET` 설정됨
- [ ] `NEXTAUTH_URL` 설정됨 (프로덕션 도메인)
- [ ] `GOOGLE_SERVICE_ACCOUNT_EMAIL` 설정됨
- [ ] `GOOGLE_DRIVE_SERVICE_ACCOUNT_PRIVATE_KEY` 설정됨
- [ ] `GOOGLE_DRIVE_SHARED_DRIVE_ID` 설정됨
- [ ] `CRON_SECRET` 설정됨
- [ ] `NEXT_PUBLIC_BASE_URL` 설정됨

**확인 방법**:
1. Vercel 대시보드 → 프로젝트 선택
2. Settings → Environment Variables
3. 각 변수가 설정되어 있는지 확인

---

### 4단계: 데이터베이스 백업 ✅

- [ ] 데이터베이스 백업 완료
- [ ] 백업 파일 위치 확인
- [ ] 백업 파일 다운로드 (선택사항)

**백업 확인 방법**:
- 구글 드라이브에서 확인: `백업/YYYY-MM/YYYY-MM-DD/`
- 또는 수동 백업 실행: `/api/admin/test/backup`

---

### 5단계: 시스템 상태 확인 ✅

**배포 전 확인**:
- [ ] Health check API 작동 확인: `/api/health`
- [ ] 시스템 상태 확인: `/api/admin/system/status`
- [ ] 관리자 패널에서 시스템 상태 페이지 확인: `/admin/system/status`

**확인 항목**:
- ✅ 데이터베이스 연결 정상
- ✅ 구글 드라이브 설정 완료
- ✅ 필수 환경 변수 모두 설정됨
- ✅ Cron job 보안 설정 완료

---

### 6단계: 문서 확인 ✅

- [ ] `DEPLOYMENT_GUIDE.md` 읽음
- [ ] `SAFETY_GUIDE.md` 읽음
- [ ] `DEPLOY_CHECKLIST.md` 확인
- [ ] 롤백 방법 숙지

---

### 7단계: 배포 실행 ✅

**방법 1: Git 연동 (권장)**
```bash
# 1. 코드 푸시
git add .
git commit -m "배포 준비 완료"
git push

# 2. Vercel이 자동으로 배포 시작
# 3. Vercel 대시보드에서 배포 상태 확인
```

**방법 2: Vercel CLI**
```bash
# 1. Vercel CLI 설치 (없는 경우)
npm i -g vercel

# 2. 로그인
vercel login

# 3. 프로덕션 배포
vercel --prod
```

---

### 8단계: 배포 후 즉시 확인 ✅

**배포 직후 (5분 이내)**:
- [ ] Vercel 대시보드에서 배포 성공 확인
- [ ] 사이트 접속 확인: `https://your-domain.com`
- [ ] Health check 확인: `https://your-domain.com/api/health`
- [ ] 로그인 테스트
- [ ] 관리자 패널 접근 테스트

**에러 발생 시**:
1. Vercel 대시보드 → Logs 탭에서 에러 확인
2. 이전 배포로 롤백 (Deployments → 이전 배포 선택 → Promote to Production)
3. 문제 해결 후 재배포

---

### 9단계: 핵심 기능 테스트 ✅

**배포 후 30분 이내**:
- [ ] 로그인/로그아웃
- [ ] 관리자 패널 접근
- [ ] 계약서 완료 → 구글 드라이브 백업 확인
- [ ] 수당 보고서 엑셀 다운로드
- [ ] APIS 엑셀 다운로드
- [ ] 지급명세서 생성
- [ ] 여권 만료 알람 표시

**문제 발생 시**:
- 즉시 이전 배포로 롤백
- 문제 원인 파악
- 해결 후 재배포

---

### 10단계: 모니터링 설정 ✅

**배포 후 24시간**:
- [ ] Vercel 대시보드에서 에러 로그 확인
- [ ] Health check 정기 확인 (30분마다)
- [ ] 시스템 상태 페이지 확인
- [ ] 사용자 피드백 수집

---

## 🚨 문제 발생 시 대응

### 문제 1: 배포 실패

**증상**: Vercel 대시보드에서 빌드 실패

**해결 방법**:
1. 빌드 로그 확인 (Vercel 대시보드 → Deployments → 실패한 배포 → Logs)
2. 로컬에서 빌드 재시도: `npm run build`
3. 에러 메시지 확인 및 수정
4. 수정 후 재배포

---

### 문제 2: 사이트 접속 불가

**증상**: 사이트가 열리지 않음

**해결 방법**:
1. Health check 확인: `/api/health`
2. Vercel 대시보드에서 배포 상태 확인
3. 에러 로그 확인
4. 이전 배포로 롤백

---

### 문제 3: 데이터베이스 연결 실패

**증상**: 로그인 불가, 데이터 로드 실패

**해결 방법**:
1. `DATABASE_URL` 환경 변수 확인
2. 데이터베이스 서버 상태 확인
3. Vercel 대시보드에서 환경 변수 재설정
4. 필요시 데이터베이스 제공업체 지원팀에 문의

---

### 문제 4: 구글 드라이브 백업 실패

**증상**: 자동 백업이 작동하지 않음

**해결 방법**:
1. 시스템 상태 페이지에서 구글 드라이브 설정 확인
2. 환경 변수 확인 (3개 모두 설정되어 있는지)
3. 구글 클라우드 콘솔에서 서비스 계정 권한 확인
4. 수동 백업 실행: `/api/admin/test/backup`

---

## 📞 도움 요청 시 필요한 정보

**문제 발생 시 다음 정보를 모아주세요**:

1. **에러 메시지**
   - Vercel 대시보드 → Logs에서 복사
   - 또는 브라우저 콘솔 에러

2. **Health check 결과**
   - `/api/health` 호출 결과

3. **시스템 상태**
   - `/api/admin/system/status` 호출 결과

4. **배포 정보**
   - 배포 시간
   - 배포 전 마지막 커밋 메시지
   - 변경한 내용

5. **스크린샷**
   - Vercel 대시보드 스크린샷
   - 에러 화면 스크린샷

---

## 🎯 초보자를 위한 팁

### ✅ DO (해야 할 것)

1. **작은 단위로 배포**
   - 한 번에 많은 변경사항을 배포하지 말 것
   - 기능별로 나누어 배포

2. **배포 전 테스트**
   - 로컬에서 충분히 테스트
   - 가능하면 스테이징 환경에서 테스트

3. **문서 확인**
   - 배포 전 관련 문서 읽기
   - 롤백 방법 숙지

4. **백업 습관**
   - 중요한 변경 전에는 반드시 백업
   - 배포 전에도 백업

### ❌ DON'T (하지 말아야 할 것)

1. **환경 변수를 코드에 하드코딩**
   - 절대 하지 말 것
   - Vercel 대시보드에서만 설정

2. **`.env` 파일을 Git에 커밋**
   - `.gitignore`에 포함되어 있는지 확인
   - 실수로 커밋했다면 즉시 삭제

3. **배포 전 테스트 없이 배포**
   - 반드시 로컬에서 테스트
   - 빌드 성공 확인

4. **롤백 계획 없이 배포**
   - 항상 롤백 방법 숙지
   - 이전 배포 위치 확인

---

## ✅ 최종 체크리스트

배포 전에 이 체크리스트를 모두 확인하세요:

- [ ] 코드 커밋 및 푸시 완료
- [ ] 로컬 빌드 성공
- [ ] 모든 환경 변수 설정 완료
- [ ] 데이터베이스 백업 완료
- [ ] 시스템 상태 확인 완료
- [ ] 문서 확인 완료
- [ ] 롤백 방법 숙지
- [ ] 배포 실행
- [ ] 배포 후 즉시 확인
- [ ] 핵심 기능 테스트
- [ ] 모니터링 설정

---

**모든 체크리스트를 완료하면 안전하게 배포할 수 있습니다!** 🚀

**문제가 발생하면 당황하지 말고, 이 가이드를 참고하여 단계별로 해결하세요.** 💪

