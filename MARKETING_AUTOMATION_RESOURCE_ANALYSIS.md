# 마케팅 자동화 시스템 서버 리소스 사용량 분석

> 작성일: 2025-01-28  
> 목적: 리드젠 스타일 마케팅 자동화 시스템의 서버 리소스 사용량 분석 및 최적화 가이드

---

## 📊 시스템 규모 요약

### 목표 용량
- **관리계정**: 최대 25개
- **고객 수**: 최대 99,000명
- **랜딩 페이지**: 최대 3,000개
- **퍼널**: 최대 300개

---

## 💾 데이터베이스 리소스 사용량

### 1. 저장 공간 예상치

#### 관리계정 (MarketingAccount)
- **레코드 수**: 25개
- **평균 레코드 크기**: ~500 bytes
- **총 용량**: ~12.5 KB
- **인덱스**: ~5 KB
- **총계**: ~18 KB

#### 고객 (MarketingCustomer)
- **레코드 수**: 99,000개
- **평균 레코드 크기**: ~1 KB (JSON 필드 포함)
- **총 용량**: ~99 MB
- **인덱스**: ~20 MB (다중 인덱스)
- **총계**: ~119 MB

#### 랜딩 페이지 (LandingPage)
- **레코드 수**: 3,000개
- **평균 레코드 크기**: ~50 KB (HTML 콘텐츠 포함)
- **총 용량**: ~150 MB
- **인덱스**: ~5 MB
- **총계**: ~155 MB

#### 퍼널 (MarketingFunnel)
- **레코드 수**: 300개
- **평균 레코드 크기**: ~10 KB (JSON stages 포함)
- **총 용량**: ~3 MB
- **인덱스**: ~1 MB
- **총계**: ~4 MB

#### 리드 (MarketingLead)
- **레코드 수**: 예상 500,000개 (고객당 평균 5개 리드)
- **평균 레코드 크기**: ~800 bytes
- **총 용량**: ~400 MB
- **인덱스**: ~50 MB
- **총계**: ~450 MB

#### 리드 상호작용 (LeadInteraction)
- **레코드 수**: 예상 2,000,000개 (리드당 평균 4개 상호작용)
- **평균 레코드 크기**: ~500 bytes
- **총 용량**: ~1 GB
- **인덱스**: ~100 MB
- **총계**: ~1.1 GB

#### 리드 스코어링 (LeadScore)
- **레코드 수**: 예상 500,000개
- **평균 레코드 크기**: ~600 bytes
- **총 용량**: ~300 MB
- **인덱스**: ~40 MB
- **총계**: ~340 MB

#### 퍼널 전환 (FunnelConversion)
- **레코드 수**: 예상 100,000개
- **평균 레코드 크기**: ~400 bytes
- **총 용량**: ~40 MB
- **인덱스**: ~10 MB
- **총계**: ~50 MB

#### 바이럴 루프 (ViralLoop)
- **레코드 수**: 예상 50,000개
- **평균 레코드 크기**: ~500 bytes
- **총 용량**: ~25 MB
- **인덱스**: ~5 MB
- **총계**: ~30 MB

### 📦 총 데이터베이스 용량 예상치

| 항목 | 용량 |
|------|------|
| 관리계정 | ~18 KB |
| 고객 | ~119 MB |
| 랜딩 페이지 | ~155 MB |
| 퍼널 | ~4 MB |
| 리드 | ~450 MB |
| 리드 상호작용 | ~1.1 GB |
| 리드 스코어링 | ~340 MB |
| 퍼널 전환 | ~50 MB |
| 바이럴 루프 | ~30 MB |
| **총계** | **~2.2 GB** |

> **참고**: 실제 사용량은 데이터 증가와 함께 계속 증가합니다. 약 3-5년 운영 시 **5-10 GB**까지 증가할 수 있습니다.

---

## 🖥️ 서버 리소스 사용량

### 1. 메모리 (RAM) 사용량

#### 기본 애플리케이션
- Next.js 서버: ~200-300 MB
- Prisma Client: ~50-100 MB
- Node.js 런타임: ~100-200 MB
- **기본 총계**: ~350-600 MB

#### 데이터베이스 연결 풀
- PostgreSQL 연결 풀 (최대 20개): ~40-80 MB
- **총계**: ~40-80 MB

#### 캐싱 (Redis 권장)
- 세션 캐시: ~50-100 MB
- 쿼리 결과 캐시: ~100-200 MB
- **총계**: ~150-300 MB

#### **총 메모리 사용량**: ~540-980 MB (약 1 GB)

> **권장 사양**: 최소 **2 GB RAM**, 권장 **4 GB RAM**

### 2. CPU 사용량

#### 일반적인 사용
- **평균 CPU 사용률**: 10-30%
- **피크 시간대**: 30-50%
- **배치 작업 (리드 스코어링 등)**: 50-80%

#### 최적화된 환경
- **평균 CPU 사용률**: 5-15%
- **피크 시간대**: 20-40%

> **권장 사양**: 최소 **2 vCPU**, 권장 **4 vCPU**

### 3. 디스크 I/O

#### 데이터베이스 읽기/쓰기
- **평균 읽기**: 100-500 IOPS
- **평균 쓰기**: 50-200 IOPS
- **피크 읽기**: 500-1000 IOPS
- **피크 쓰기**: 200-500 IOPS

> **권장**: SSD 사용 필수, 최소 1000 IOPS

---

## ⚡ 성능 최적화 가이드

### 1. 데이터베이스 최적화

#### 인덱스 최적화
```sql
-- 자주 조회되는 필드에 인덱스 추가
CREATE INDEX idx_marketing_customer_account_status 
ON MarketingCustomer(accountId, status);

CREATE INDEX idx_marketing_lead_account_created 
ON MarketingLead(accountId, createdAt);

CREATE INDEX idx_funnel_conversion_funnel_converted 
ON FunnelConversion(funnelId, convertedAt);
```

#### 파티셔닝 (대용량 데이터)
- **LeadInteraction**: 날짜별 파티셔닝 권장 (월별)
- **FunnelConversion**: 날짜별 파티셔닝 권장 (월별)

#### 아카이빙
- 1년 이상 된 리드 상호작용 데이터는 별도 아카이브 테이블로 이동
- 6개월 이상 된 전환 데이터는 통계 테이블로 집계 후 원본 삭제

### 2. 캐싱 전략

#### Redis 캐싱
```typescript
// 자주 조회되는 통계 데이터 캐싱
- 대시보드 통계: 5분 TTL
- 고객 목록 (페이지네이션): 1분 TTL
- 퍼널 설정: 10분 TTL
```

#### 애플리케이션 레벨 캐싱
- Prisma 쿼리 결과 캐싱
- 정적 페이지 콘텐츠 캐싱

### 3. 배치 작업 최적화

#### 리드 스코어링
- **실행 주기**: 매일 새벽 2시
- **배치 크기**: 1000개씩 처리
- **병렬 처리**: 5개 워커 동시 실행

#### 데이터 정리
- **실행 주기**: 매주 일요일 새벽
- **삭제 대상**: 2년 이상 된 리드 상호작용 데이터

### 4. 쿼리 최적화

#### 페이지네이션 필수
```typescript
// ❌ 나쁜 예
const customers = await prisma.marketingCustomer.findMany();

// ✅ 좋은 예
const customers = await prisma.marketingCustomer.findMany({
  take: 50,
  skip: (page - 1) * 50,
  orderBy: { createdAt: 'desc' },
});
```

#### 필요한 필드만 선택
```typescript
// ✅ 필요한 필드만 선택
const customers = await prisma.marketingCustomer.findMany({
  select: {
    id: true,
    name: true,
    email: true,
    status: true,
  },
});
```

---

## 🚀 서버 사양 권장사항

### 최소 사양 (소규모 운영)
- **CPU**: 2 vCPU
- **RAM**: 2 GB
- **디스크**: 20 GB SSD
- **네트워크**: 100 Mbps
- **예상 비용**: 월 $20-30 (AWS t3.small 등)

### 권장 사양 (중규모 운영)
- **CPU**: 4 vCPU
- **RAM**: 4 GB
- **디스크**: 50 GB SSD
- **네트워크**: 500 Mbps
- **예상 비용**: 월 $50-80 (AWS t3.medium 등)

### 최적 사양 (대규모 운영)
- **CPU**: 8 vCPU
- **RAM**: 8 GB
- **디스크**: 100 GB SSD
- **네트워크**: 1 Gbps
- **예상 비용**: 월 $150-200 (AWS t3.large 등)

### 데이터베이스 서버 (별도 권장)
- **CPU**: 4 vCPU
- **RAM**: 8 GB
- **디스크**: 100 GB SSD (고 IOPS)
- **예상 비용**: 월 $100-150 (AWS db.t3.medium 등)

---

## 📈 확장성 고려사항

### 수평 확장 (Scale Out)
- **애플리케이션 서버**: 로드 밸런서로 여러 인스턴스 운영 가능
- **데이터베이스**: 읽기 전용 복제본 (Read Replica) 활용

### 수직 확장 (Scale Up)
- **CPU/RAM 증가**: 트래픽 증가에 따라 단계적으로 확장
- **디스크 용량**: 월별 모니터링 후 필요시 확장

### 데이터베이스 분리
- **읽기/쓰기 분리**: Master-Slave 구조
- **샤딩**: 계정별로 데이터베이스 분리 (25개 계정 → 5개 DB)

---

## ⚠️ 주의사항

### 1. 데이터베이스 연결 풀
- **최대 연결 수**: 20-50개 권장
- **연결 타임아웃**: 30초
- **Idle 타임아웃**: 10분

### 2. 메모리 누수 방지
- 정기적인 메모리 모니터링
- 장기 실행 배치 작업은 별도 프로세스로 분리

### 3. 백업 전략
- **일일 백업**: 자동 백업 (매일 새벽)
- **보관 기간**: 최소 30일
- **재해 복구**: 다른 리전에 백업 저장

---

## 💰 예상 운영 비용 (월간)

### 클라우드 서비스 (AWS 기준)
- **애플리케이션 서버**: $50-150
- **데이터베이스 서버**: $100-200
- **스토리지**: $20-50
- **네트워크**: $10-30
- **캐싱 (ElastiCache)**: $30-50
- **총계**: **$210-480/월**

### 자체 서버 (온프레미스)
- **서버 하드웨어**: 초기 투자 $2,000-5,000
- **전기/인터넷**: $50-100/월
- **유지보수**: $100-200/월
- **총계 (1년 기준)**: **$1,800-4,200/년** (월 $150-350)

---

## ✅ 결론

### 서버 리소스 사용량 요약
- **데이터베이스 용량**: ~2.2 GB (초기), 5-10 GB (장기)
- **메모리 사용량**: ~1 GB (기본), 2-4 GB (권장)
- **CPU 사용량**: 평균 10-30%, 피크 30-50%
- **디스크 I/O**: 평균 100-500 IOPS

### 권장 사양
- **최소**: 2 vCPU, 2 GB RAM, 20 GB SSD
- **권장**: 4 vCPU, 4 GB RAM, 50 GB SSD
- **최적**: 8 vCPU, 8 GB RAM, 100 GB SSD

### 비용
- **클라우드**: 월 $210-480
- **온프레미스**: 월 $150-350 (초기 투자 제외)

**결론**: 리드젠과 같은 규모의 마케팅 자동화 시스템을 운영하기 위해서는 **중간 규모의 서버 인프라**가 필요하며, **월 $200-500 정도의 운영 비용**이 예상됩니다. 적절한 최적화를 통해 비용을 절감할 수 있습니다.







