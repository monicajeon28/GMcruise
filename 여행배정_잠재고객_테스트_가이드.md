# 여행 배정 - 잠재고객 필터 테스트 가이드

## 테스트 목적
"여행 배정 대상 (동행자)" 검색에서 **잠재고객만** 표시되는지 확인

## 테스트 환경
- URL: `http://localhost:3000/admin/assign-trip`
- 관리자 계정:
  - 이름: 관리자
  - 전화번호: 01024958013
  - 비밀번호: 0313

## 테스트 시나리오

### 1단계: 관리자 로그인
1. 브라우저에서 `http://localhost:3000/admin/login` 접속
2. 다음 정보 입력:
   - 이름: `관리자`
   - 전화번호: `01024958013`
   - 비밀번호: `0313`
3. "관리자 로그인" 버튼 클릭
4. 관리자 대시보드로 이동 확인

### 2단계: 여행 배정 페이지 접속
1. 관리자 대시보드에서 "여행 배정" 메뉴 클릭
2. 또는 직접 `http://localhost:3000/admin/assign-trip` 접속

### 3단계: 잠재고객 검색 테스트

#### 테스트 1: 빈 검색어로 전체 잠재고객 목록 확인
1. "여행 배정 대상 (동행자)" 검색창 클릭
2. 검색어 입력 없이 드롭다운 확인
3. **예상 결과:**
   - "잠재고객 목록 (N명)" 헤더 표시
   - 모든 사용자에 "잠재고객" 라벨 표시 (주황색)
   - 구매확정 고객(`purchase_confirmed`)은 표시되지 않음
   - UserTrip이 있는 고객도 표시됨 (예: 전혜선, 홍길동, 낑깡 등)

#### 테스트 2: 검색어로 필터링 확인
1. "여행 배정 대상 (동행자)" 검색창에 `sdf` 입력
2. **예상 결과:**
   - "sdf" 사용자만 표시
   - "잠재고객" 라벨 표시
   - 구매확정 고객은 표시되지 않음

#### 테스트 3: 구매확정 고객 제외 확인
1. 검색창에 `시뮬` 또는 `동행` 입력
2. **예상 결과:**
   - "시뮬 구매고객" (01011112222) - **표시되지 않음** ✅
   - "동행 잠재고객" (01033334444) - **표시되지 않음** ✅ (구매확정 상태)
   - 다른 잠재고객만 표시됨

#### 테스트 4: UserTrip이 있는 잠재고객 포함 확인
1. 검색창에 `전혜선` 또는 `홍길동` 입력
2. **예상 결과:**
   - "전혜선" (01024958013) - **표시됨** ✅ (UserTrip 있지만 잠재고객)
   - "홍길동" (010-1234-5678) - **표시됨** ✅ (UserTrip 있지만 잠재고객)

## 확인 사항 체크리스트

- [ ] "잠재고객 목록" 헤더가 표시됨
- [ ] 모든 사용자에 "잠재고객" 라벨이 표시됨 (주황색)
- [ ] 구매확정 고객(`purchase_confirmed`)은 표시되지 않음
- [ ] UserTrip이 있는 고객도 표시됨
- [ ] 검색어 입력 시 필터링이 정상 작동함
- [ ] 구매고객 검색은 구매고객만 표시됨

## 예상 결과

### 잠재고객으로 표시되어야 하는 고객 (예시)
- sdf (01011111111) - 랜딩페이지
- ㅇㅇ (0102345678) - 그룹
- 전혜선 (01024958013) - 크루즈가이드 (UserTrip 있음)
- 홍길동 (010-1234-5678) - 제휴 수동 (UserTrip 있음)
- 낑깡 (01011111111) - 3일체험 (UserTrip 있음)
- 박지니 (010-2222-2222) - 크루즈가이드 (UserTrip 있음)
- 용용 (01024567894) - 랜딩페이지

### 표시되지 않아야 하는 고객
- 시뮬 구매고객 (01011112222) - `purchase_confirmed`
- 동행 잠재고객 (01033334444) - `purchase_confirmed`

## 문제 발생 시

1. **브라우저 콘솔 확인**
   - F12 → Console 탭에서 에러 확인
   - Network 탭에서 API 응답 확인

2. **API 직접 테스트**
   ```bash
   # 터미널에서 실행
   curl "http://localhost:3000/api/admin/users?role=user&customerStatus=prospects" \
     -H "Cookie: cg.sid.v2=YOUR_SESSION_ID"
   ```

3. **로그 확인**
   - 터미널에서 Next.js 개발 서버 로그 확인
   - `[Admin Users API] 검색 결과:` 로그 확인

## 수정된 필터 조건

```typescript
// 잠재고객 필터
{
  OR: [
    { customerStatus: null },
    { customerStatus: { not: 'purchase_confirmed' } }
  ]
}
```

- 구매확정 고객(`purchase_confirmed`)만 제외
- UserTrip 조건 없음 (모든 잠재고객 포함)
- 검색어와 AND 조건으로 결합

