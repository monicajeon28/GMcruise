# íŒë§¤ì›/ëŒ€ë¦¬ì ì¥ ì•„ì´ë”” ìƒì„± ë…ë¦½ì„± ê²€ì¦ ë³´ê³ ì„œ

> **ì‘ì„±ì¼**: 2025ë…„ 1ì›” 28ì¼  
> **ê²€ì¦ ë‚´ìš©**: íŒë§¤ì›/ëŒ€ë¦¬ì ì¥ ì•„ì´ë”” ìƒì„± ì‹œ ê°ê° ë…ë¦½ì ì¸ ëŒ€ì‹œë³´ë“œ, ëª°, ë§í¬ê°€ ìƒì„±ë˜ëŠ”ì§€ í™•ì¸

---

## ğŸ“‹ ê²€ì¦ ê°œìš”

ê´€ë¦¬ìê°€ íŒë§¤ì› ë˜ëŠ” ëŒ€ë¦¬ì ì¥ ì•„ì´ë””ë¥¼ ìƒì„±í•  ë•Œ, ê°ê°ì´ ë…ë¦½ì ì¸ ëŒ€ì‹œë³´ë“œì™€ ëª°, ë§í¬ë¥¼ ê°€ì§€ëŠ”ì§€ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

---

## âœ… ê²€ì¦ ê²°ê³¼

### 1. ì•„ì´ë”” ìƒì„± ë°©ì‹

**ì½”ë“œ ìœ„ì¹˜**: `app/api/admin/affiliate/profiles/route.ts`

#### íŒë§¤ì›/ëŒ€ë¦¬ì ì¥ ì•„ì´ë”” ìë™ ìƒì„±
```typescript
async function generatePartnerId(type: 'BRANCH_MANAGER' | 'SALES_AGENT', name: string): Promise<string> {
  const prefix = type === 'BRANCH_MANAGER' ? 'boss' : 'user';
  
  // ê¸°ì¡´ ì‚¬ìš©ëœ ë²ˆí˜¸ í™•ì¸
  const existing = await prisma.user.findMany({
    where: { phone: { startsWith: prefix } },
    select: { phone: true },
  });

  // ì‚¬ìš© ê°€ëŠ¥í•œ ë²ˆí˜¸ ì°¾ê¸° (1ë¶€í„° ì‹œì‘)
  for (let i = 1; i <= 99999; i += 1) {
    if (!used.has(i)) {
      return `${prefix}${i}`; // boss1, user1, boss2, user2...
    }
  }
}
```

**ê²°ê³¼**:
- âœ… ëŒ€ë¦¬ì ì¥: `boss1`, `boss2`, `boss3`... í˜•ì‹ìœ¼ë¡œ ë…ë¦½ì ì¸ ID ìƒì„±
- âœ… íŒë§¤ì›: `user1`, `user2`, `user3`... í˜•ì‹ìœ¼ë¡œ ë…ë¦½ì ì¸ ID ìƒì„±
- âœ… ê° IDëŠ” ê³ ìœ í•˜ë©° ì¤‘ë³µë˜ì§€ ì•ŠìŒ

---

### 2. ì‚¬ìš©ì ê³„ì • ìƒì„±

**ì½”ë“œ ìœ„ì¹˜**: `app/api/admin/affiliate/profiles/route.ts` (ë¼ì¸ 400-416)

```typescript
// ì‹ ê·œ ì‚¬ìš©ì ìƒì„±
const newUser = await prisma.user.create({
  data: {
    name: name,
    phone: partnerId, // phone í•„ë“œì— boss1, user1... ì €ì¥
    email: toNullableString(data.contactEmail) || undefined,
    password: '1101', // ë¹„ë°€ë²ˆí˜¸ 1101ë¡œ ê³ ì •
    role: 'community',
    customerSource: 'affiliate-manual-creation',
    customerStatus: 'pending',
    adminMemo: `Auto-created from manual affiliate profile creation by admin ${sessionUser.id}`,
    mallUserId: partnerId, // mallUserIdì—ë„ ë™ì¼í•˜ê²Œ ì €ì¥ (í˜¸í™˜ì„±)
    mallNickname: name,
  },
});
```

**ê²°ê³¼**:
- âœ… ê° íŒë§¤ì›/ëŒ€ë¦¬ì ì¥ë§ˆë‹¤ **ë…ë¦½ì ì¸ User ë ˆì½”ë“œ** ìƒì„±
- âœ… `mallUserId` í•„ë“œì— ê³ ìœ í•œ ID ì €ì¥ (`boss1`, `user1` ë“±)
- âœ… ë¹„ë°€ë²ˆí˜¸ëŠ” `1101`ë¡œ ê³ ì • (íŒŒíŠ¸ë„ˆ ë¡œê·¸ì¸ìš©)

---

### 3. ë…ë¦½ì ì¸ ëŒ€ì‹œë³´ë“œ

**ì½”ë“œ ìœ„ì¹˜**: `app/[mallUserId]/dashboard/page.tsx`

```typescript
export default async function PersonalDashboardPage({ params }: { params: Promise<{ mallUserId: string }> }) {
  const { mallUserId } = await params;
  
  // mallUserIdë¡œ ì‚¬ìš©ì ì¡°íšŒ
  const targetUser = await prisma.user.findFirst({
    where: { mallUserId },
    select: { id: true, name: true, mallUserId: true, ... },
  });

  // ë³¸ì¸ì˜ mallUserIdì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
  if (profile.user?.mallUserId !== mallUserId) {
    redirect(`/${profile.user?.mallUserId ?? ''}/dashboard`);
  }
}
```

**ê²°ê³¼**:
- âœ… ê° `mallUserId`ë§ˆë‹¤ **ë…ë¦½ì ì¸ ëŒ€ì‹œë³´ë“œ ê²½ë¡œ** ì œê³µ
- âœ… `/boss1/dashboard`, `/user1/dashboard`, `/boss2/dashboard` ë“±ìœ¼ë¡œ ì ‘ê·¼
- âœ… ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ì‹œ ìë™ìœ¼ë¡œ ë³¸ì¸ ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

---

### 4. ë…ë¦½ì ì¸ íŒë§¤ëª°

**ì½”ë“œ ìœ„ì¹˜**: `app/[mallUserId]/shop/page.tsx`

```typescript
export default async function PersonalShopPage({ params }: { params: Promise<{ mallUserId: string }> }) {
  const { mallUserId } = await params;
  
  // mallUserIdë¡œ íŒŒíŠ¸ë„ˆ ì •ë³´ ì¡°íšŒ
  const partner = await prisma.user.findFirst({
    where: { mallUserId },
    select: {
      id: true,
      mallUserId: true,
      mallNickname: true,
      AffiliateProfile: {
        select: {
          id: true,
          affiliateCode: true,
          profileTitle: true,
          landingAnnouncement: true,
          welcomeMessage: true,
          profileImage: true,
          coverImage: true,
          displayName: true,
        },
      },
    },
  });
}
```

**ê²°ê³¼**:
- âœ… ê° `mallUserId`ë§ˆë‹¤ **ë…ë¦½ì ì¸ íŒë§¤ëª° í˜ì´ì§€** ì œê³µ
- âœ… `/boss1/shop`, `/user1/shop`, `/boss2/shop` ë“±ìœ¼ë¡œ ì ‘ê·¼
- âœ… ê° íŒë§¤ëª°ì€ ë…ë¦½ì ì¸ í”„ë¡œí•„ ì •ë³´, ìƒí’ˆ, ë§í¬ë¥¼ ê°€ì§

---

### 5. ë…ë¦½ì ì¸ ë§í¬ ìƒì„±

**ì½”ë“œ ìœ„ì¹˜**: `app/api/admin/affiliate/profiles/route.ts` (ë¼ì¸ 490-497)

```typescript
// landingSlugëŠ” ìë™ ìƒì„±ëœ ê²½ìš° phone í•„ë“œì˜ boss1/user1... ì‚¬ìš©
let landingSlug = toNullableString(data.landingSlug);
if (!landingSlug && userRecord?.phone) {
  const partnerIdPattern = type === 'BRANCH_MANAGER' ? /^boss\d+(-.*)?$/i : /^user\d+(-.*)?$/i;
  if (userRecord.phone.match(partnerIdPattern)) {
    landingSlug = userRecord.phone; // boss1, user1 ë“±
  }
}
```

**ê²°ê³¼**:
- âœ… ê° íŒë§¤ì›/ëŒ€ë¦¬ì ì¥ë§ˆë‹¤ **ë…ë¦½ì ì¸ `landingSlug`** ìƒì„±
- âœ… `landingSlug`ëŠ” `mallUserId`ì™€ ë™ì¼í•˜ê²Œ ì„¤ì •ë¨
- âœ… ê° ë§í¬ëŠ” ë…ë¦½ì ì¸ ì–´í•„ë¦¬ì—ì´íŠ¸ ì½”ë“œì™€ ì—°ê²°ë¨

---

## ğŸ¯ ìµœì¢… ê²°ë¡ 

### âœ… í™•ì¸ëœ ì‚¬í•­

1. **ë…ë¦½ì ì¸ ì•„ì´ë””**: âœ… ê° íŒë§¤ì›/ëŒ€ë¦¬ì ì¥ë§ˆë‹¤ ê³ ìœ í•œ `mallUserId` ìƒì„± (`boss1`, `user1` ë“±)
2. **ë…ë¦½ì ì¸ ì‚¬ìš©ì ê³„ì •**: âœ… ê°ê° ë…ë¦½ì ì¸ User ë ˆì½”ë“œ ìƒì„±
3. **ë…ë¦½ì ì¸ ëŒ€ì‹œë³´ë“œ**: âœ… `/boss1/dashboard`, `/user1/dashboard` ë“± ë…ë¦½ì ì¸ ê²½ë¡œ
4. **ë…ë¦½ì ì¸ íŒë§¤ëª°**: âœ… `/boss1/shop`, `/user1/shop` ë“± ë…ë¦½ì ì¸ íŒë§¤ëª° í˜ì´ì§€
5. **ë…ë¦½ì ì¸ ë§í¬**: âœ… ê°ê° ë…ë¦½ì ì¸ `landingSlug`ì™€ ì–´í•„ë¦¬ì—ì´íŠ¸ ì½”ë“œ

### ğŸ“ ê²°ë¡ 

**íŒë§¤ì›/ëŒ€ë¦¬ì ì¥ ì•„ì´ë”” ìƒì„± ì‹œ ê°ê° ì™„ì „íˆ ë…ë¦½ì ì¸ ì‹œìŠ¤í…œì´ ìƒì„±ë©ë‹ˆë‹¤.**

- âœ… í†µí•©ì´ ì•„ë‹Œ **ì™„ì „íˆ ë…ë¦½ì ì¸ ëŒ€ì‹œë³´ë“œ**
- âœ… ê°ê° **ë…ë¦½ì ì¸ íŒë§¤ëª°** (`/[mallUserId]/shop`)
- âœ… ê°ê° **ë…ë¦½ì ì¸ ë§í¬** (`landingSlug`, `affiliateCode`)
- âœ… ê°ê° **ë…ë¦½ì ì¸ ë¡œê·¸ì¸** (ì•„ì´ë””: `boss1`/`user1`, ë¹„ë°€ë²ˆí˜¸: `1101`)

### ğŸ” ë¡œê·¸ì¸ ì •ë³´

- **ì•„ì´ë””**: `boss1`, `user1`, `boss2`, `user2`... (ìë™ ìƒì„±)
- **ë¹„ë°€ë²ˆí˜¸**: `1101` (ê³ ì •)
- **ë¡œê·¸ì¸ ê²½ë¡œ**: `/partner` (íŒŒíŠ¸ë„ˆ ë¡œê·¸ì¸ í˜ì´ì§€)

---

**ì‘ì„±ì**: AI Assistant  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025ë…„ 1ì›” 28ì¼

