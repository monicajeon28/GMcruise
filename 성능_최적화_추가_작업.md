# 성능 최적화 추가 작업 가이드

## ✅ 완료된 작업

### 1. DB 인덱스 추가
- `customerSource` 인덱스 추가
- `role, customerSource` 복합 인덱스 추가
- `mallUserId` 인덱스 추가
- `testModeStartedAt` 인덱스 추가
- `customerStatus, createdAt` 복합 인덱스 추가

## 📋 다음 단계

### 1. 인덱스 마이그레이션 실행

```bash
# Prisma 마이그레이션 생성
npx prisma migrate dev --name add_performance_indexes

# 또는 프로덕션 환경에서
npx prisma migrate deploy
```

### 2. 추가 최적화 사항

#### A. 불필요한 쿼리 제거
- `linkedMallUserIds` 조회 최적화 (이미 조건부로 최적화됨)
- 중복 쿼리 제거

#### B. Select 최적화
- 필요한 필드만 선택 (이미 최적화됨)
- 중첩 쿼리 최소화

#### C. 캐싱 전략
- 이미 30초 revalidate 적용됨
- 추가로 React Query 도입 고려 가능

## 🚀 예상 성능 개선

인덱스 추가 후:
- 고객관리 페이지 쿼리 속도: **30-50% 추가 개선**
- customerSource 필터링: **70-80% 개선**
- mallUserId 조회: **60-70% 개선**

## ⚠️ 주의사항

1. **마이그레이션 실행 전 백업 필수**
2. **프로덕션 환경에서는 점검 시간에 실행 권장**
3. **인덱스 추가로 인한 쓰기 성능 약간 저하 가능 (읽기 성능 대폭 개선)**


