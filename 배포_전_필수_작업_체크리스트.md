# 배포 전 필수 작업 체크리스트

**작성일**: 2025년 1월 28일  
**우선순위**: 🔴 최우선 → 🟡 중요 → 🟢 선택

---

## 🔴 최우선 작업 (배포 전 필수)

### 1. 데이터베이스 인덱스 추가

**파일**: Prisma 마이그레이션 파일 생성 필요

**필요한 인덱스**:
```sql
-- affiliateLead 테이블
CREATE INDEX idx_affiliate_lead_manager_created ON "AffiliateLead"(managerId, createdAt);
CREATE INDEX idx_affiliate_lead_agent_created ON "AffiliateLead"(agentId, createdAt);

-- affiliateSale 테이블  
CREATE INDEX idx_affiliate_sale_manager_date ON "AffiliateSale"(managerId, saleDate);
CREATE INDEX idx_affiliate_sale_agent_date ON "AffiliateSale"(agentId, saleDate);

-- affiliateLink 테이블
CREATE INDEX idx_affiliate_link_manager ON "AffiliateLink"(managerId);
CREATE INDEX idx_affiliate_link_agent ON "AffiliateLink"(agentId);
```

**작업 방법**:
1. `prisma/migrations/` 폴더에 새 마이그레이션 파일 생성
2. 또는 직접 DB에 SQL 실행

**예상 시간**: 10분

---

### 2. 구매고객 목록 페이지네이션 추가

**파일**: `app/partner/[partnerId]/dashboard/PartnerDashboard.tsx`

**현재 문제**:
- `loadPurchasedReservations` 함수가 전체 데이터를 한 번에 로드
- 1만명 규모에서 메모리 부족 가능

**수정 필요**:
```typescript
// 현재: 전체 로드
const loadPurchasedReservations = useCallback(async () => {
  const response = await fetch('/api/partner/reservations', {
    credentials: 'include',
  });
  // ...
}, []);

// 수정: 페이지네이션 추가
const loadPurchasedReservations = useCallback(async (page: number = 1, limit: number = 50) => {
  const response = await fetch(`/api/partner/reservations?page=${page}&limit=${limit}`, {
    credentials: 'include',
  });
  // ...
}, []);
```

**API 수정 필요**: `app/api/partner/reservations/route.ts`
- 페이지네이션 파라미터 추가
- `skip`, `take` 적용

**예상 시간**: 1-2시간

---

### 3. 환경변수 검증 스크립트 작성

**파일**: `scripts/check-env-before-deploy.ts` (새로 생성)

**기능**:
- 배포 전 필수 환경변수 확인
- 누락된 환경변수 알림

**예상 시간**: 30분

---

### 4. 각 대리점장/판매원에게 알리고 설정 안내 문서 작성

**파일**: `docs/알리고_API_설정_가이드.md` (새로 생성)

**내용**:
- 알리고 계정 생성 방법
- 발신번호 등록 방법
- API 키 발급 방법
- 대시보드에서 설정하는 방법

**예상 시간**: 1시간

---

## 🟡 중요 작업 (배포 후 1주일 내)

### 5. 통계 데이터 캐싱 구현

**파일**: `app/api/partner/dashboard/stats/route.ts`

**작업 내용**:
- Redis 캐싱 도입
- 통계 데이터 5분 TTL 설정
- 캐시 미스 시 DB 조회

**예상 시간**: 2-3시간

---

### 6. 고객 검색 성능 개선

**파일**: `app/api/affiliate/customers/search/route.ts`

**작업 내용**:
- 전화번호 정규화를 DB 레벨에서 처리
- 인덱스 활용 최적화

**예상 시간**: 1-2시간

---

### 7. 대시보드에 퍼널 발송 현황 추가

**파일**: `app/partner/[partnerId]/dashboard/PartnerDashboard.tsx`

**작업 내용**:
- 퍼널 문자 발송 현황 표시
- 퍼널별 전환율 표시

**예상 시간**: 2-3시간

---

## 🟢 선택 작업 (1개월 내)

### 8. 그룹별 통계 대시보드 추가
### 9. 랜딩페이지 통계 연동
### 10. 커미션 계산 표시

---

## 📋 배포 당일 체크리스트

### 배포 전 (배포 1시간 전)

- [ ] DB 인덱스 추가 완료 확인
- [ ] 환경변수 검증 스크립트 실행
- [ ] 모든 필수 환경변수 설정 확인
- [ ] Google Drive 권한 확인
- [ ] Gemini API 키 확인
- [ ] 데이터베이스 연결 테스트
- [ ] 마이그레이션 실행 확인

### 배포 직후 (배포 후 30분 내)

- [ ] 대시보드 접속 테스트
- [ ] SMS 발송 테스트 (테스트 계정으로)
- [ ] 구매고객 목록 로딩 테스트
- [ ] 통계 데이터 로딩 테스트
- [ ] 에러 로그 확인

### 배포 후 1일 내

- [ ] 각 대리점장/판매원에게 알리고 설정 안내
- [ ] 성능 모니터링 시작
- [ ] 비용 모니터링 시작
- [ ] 에러 모니터링 확인

---

## 🚀 즉시 시작할 작업

**지금 바로 해야 할 것**:

1. **DB 인덱스 추가** (10분)
   - 가장 중요하고 빠르게 완료 가능
   - 성능에 직접적인 영향

2. **구매고객 목록 페이지네이션** (1-2시간)
   - 1만명 규모에서 필수
   - 메모리 부족 방지

3. **환경변수 검증 스크립트** (30분)
   - 배포 실수 방지

이 3가지만 완료해도 배포 가능합니다!


