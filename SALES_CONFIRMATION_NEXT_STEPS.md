# 판매 확정 프로세스 다음 단계 안내

> 작성일: 2025-01-28  
> 목적: 판매 확정 프로세스 2-4단계 구현 가이드

---

## 📊 현재 진행 상황

### ✅ 완료된 단계
- **1단계: 데이터베이스 수정** ✅
  - `AffiliateSale` 모델에 필드 추가 완료
  - 상태 값 정의 완료

### 🔄 진행 필요 단계
- **2단계: Google Drive 업로드 함수** (진행 필요)
- **3단계: API 구현** (진행 필요)
- **4단계: UI 구현** (진행 필요)

---

## 🎯 다음 단계 설명

### 2단계: Google Drive 업로드 함수 만들기

**목적**: 녹음 파일을 Google Drive에 저장하는 함수 만들기

**작업 내용:**
1. `lib/google-drive.ts` 파일 확인
2. `uploadAudioFileToDrive` 함수 추가 (이미 있을 수 있음)
3. 파일 크기 제한 설정 (예: 10MB)
4. 파일 형식 제한 (mp3, wav, m4a)

**예상 소요 시간**: 30분

**확인 방법:**
- 함수가 정상 작동하는지 테스트
- Google Drive에 파일이 올라가는지 확인

---

### 3단계: API 구현

**목적**: 판매 확정 요청, 승인, 거부를 처리하는 API 만들기

**작업 내용:**

#### 3-1. 판매 확정 요청 API
- **파일**: `app/api/affiliate/sales/[saleId]/submit-confirmation/route.ts`
- **기능**: 
  - 녹음 파일 업로드 (Google Drive)
  - 상태를 `PENDING_APPROVAL`로 변경
  - 제출 정보 저장

#### 3-2. 관리자 승인 API
- **파일**: `app/api/admin/affiliate/sales/[saleId]/approve/route.ts`
- **기능**:
  - 상태를 `APPROVED`로 변경
  - 수당 자동 계산 (`syncSaleCommissionLedgers`)
  - 알림 전송

#### 3-3. 관리자 거부 API
- **파일**: `app/api/admin/affiliate/sales/[saleId]/reject/route.ts`
- **기능**:
  - 상태를 `REJECTED`로 변경
  - 거부 사유 저장
  - 알림 전송

#### 3-4. 승인 대기 목록 API
- **파일**: `app/api/admin/affiliate/sales/pending-approval/route.ts` (이미 수정됨)
- **기능**: `PENDING_APPROVAL` 상태 판매 목록 조회

**예상 소요 시간**: 2-3시간

**확인 방법:**
- 각 API를 직접 호출해서 테스트
- 데이터베이스에 올바르게 저장되는지 확인

---

### 4단계: UI 구현

**목적**: 사용자가 쉽게 사용할 수 있는 화면 만들기

**작업 내용:**

#### 4-1. 판매원/대리점장 대시보드
- **파일**: `app/partner/[partnerId]/dashboard/PartnerDashboard.tsx`
- **기능**:
  - 내 판매 목록 표시
  - 판매 확정 요청 버튼
  - 녹음 파일 업로드
  - 상태 표시 (PENDING, PENDING_APPROVAL, APPROVED, REJECTED)

#### 4-2. 관리자 승인 페이지
- **파일**: `app/admin/affiliate/sales/pending-approval/page.tsx` (이미 있을 수 있음)
- **기능**:
  - 승인 대기 목록 표시
  - Google Drive 링크로 녹음 파일 확인
  - 승인/거부 버튼
  - 거부 사유 입력

**예상 소요 시간**: 3-4시간

**확인 방법:**
- 실제로 화면에서 버튼 클릭
- 파일 업로드 테스트
- 승인/거부 테스트

---

## 📝 구현 순서 추천

### 방법 1: 단계별 순차 구현 (추천)
1. 2단계 완료 → 테스트
2. 3단계 완료 → 테스트
3. 4단계 완료 → 테스트

**장점**: 각 단계를 확실히 완료하고 넘어감
**단점**: 시간이 조금 더 걸림

### 방법 2: 병렬 구현
1. 2단계와 3-1 동시 진행
2. 3-2, 3-3, 3-4 동시 진행
3. 4단계 진행

**장점**: 빠르게 완료 가능
**단점**: 문제 발생 시 찾기 어려울 수 있음

---

## 🚀 시작하기

### 지금 바로 할 수 있는 것

1. **2단계부터 시작**
   ```
   "2단계 Google Drive 업로드 함수 만들어줘"
   ```

2. **3단계부터 시작** (2단계가 이미 있다면)
   ```
   "3단계 API 구현해줘"
   ```

3. **전체를 한 번에**
   ```
   "판매 확정 프로세스 2-4단계 모두 구현해줘"
   ```

---

## 💡 팁

- 각 단계를 완료한 후 반드시 테스트하세요
- 문제가 생기면 바로 알려주세요
- 작은 단위로 나눠서 진행하는 것이 좋습니다

---

## ❓ 질문

**Q: 어느 단계부터 시작하면 되나요?**
A: 2단계부터 순서대로 진행하는 것을 추천합니다.

**Q: 이미 일부 구현되어 있나요?**
A: 네, 일부 API가 이미 있을 수 있습니다. 확인 후 진행하세요.

**Q: 시간이 얼마나 걸리나요?**
A: 전체적으로 5-7시간 정도 예상됩니다.


> 작성일: 2025-01-28  
> 목적: 판매 확정 프로세스 2-4단계 구현 가이드

---

## 📊 현재 진행 상황

### ✅ 완료된 단계
- **1단계: 데이터베이스 수정** ✅
  - `AffiliateSale` 모델에 필드 추가 완료
  - 상태 값 정의 완료

### 🔄 진행 필요 단계
- **2단계: Google Drive 업로드 함수** (진행 필요)
- **3단계: API 구현** (진행 필요)
- **4단계: UI 구현** (진행 필요)

---

## 🎯 다음 단계 설명

### 2단계: Google Drive 업로드 함수 만들기

**목적**: 녹음 파일을 Google Drive에 저장하는 함수 만들기

**작업 내용:**
1. `lib/google-drive.ts` 파일 확인
2. `uploadAudioFileToDrive` 함수 추가 (이미 있을 수 있음)
3. 파일 크기 제한 설정 (예: 10MB)
4. 파일 형식 제한 (mp3, wav, m4a)

**예상 소요 시간**: 30분

**확인 방법:**
- 함수가 정상 작동하는지 테스트
- Google Drive에 파일이 올라가는지 확인

---

### 3단계: API 구현

**목적**: 판매 확정 요청, 승인, 거부를 처리하는 API 만들기

**작업 내용:**

#### 3-1. 판매 확정 요청 API
- **파일**: `app/api/affiliate/sales/[saleId]/submit-confirmation/route.ts`
- **기능**: 
  - 녹음 파일 업로드 (Google Drive)
  - 상태를 `PENDING_APPROVAL`로 변경
  - 제출 정보 저장

#### 3-2. 관리자 승인 API
- **파일**: `app/api/admin/affiliate/sales/[saleId]/approve/route.ts`
- **기능**:
  - 상태를 `APPROVED`로 변경
  - 수당 자동 계산 (`syncSaleCommissionLedgers`)
  - 알림 전송

#### 3-3. 관리자 거부 API
- **파일**: `app/api/admin/affiliate/sales/[saleId]/reject/route.ts`
- **기능**:
  - 상태를 `REJECTED`로 변경
  - 거부 사유 저장
  - 알림 전송

#### 3-4. 승인 대기 목록 API
- **파일**: `app/api/admin/affiliate/sales/pending-approval/route.ts` (이미 수정됨)
- **기능**: `PENDING_APPROVAL` 상태 판매 목록 조회

**예상 소요 시간**: 2-3시간

**확인 방법:**
- 각 API를 직접 호출해서 테스트
- 데이터베이스에 올바르게 저장되는지 확인

---

### 4단계: UI 구현

**목적**: 사용자가 쉽게 사용할 수 있는 화면 만들기

**작업 내용:**

#### 4-1. 판매원/대리점장 대시보드
- **파일**: `app/partner/[partnerId]/dashboard/PartnerDashboard.tsx`
- **기능**:
  - 내 판매 목록 표시
  - 판매 확정 요청 버튼
  - 녹음 파일 업로드
  - 상태 표시 (PENDING, PENDING_APPROVAL, APPROVED, REJECTED)

#### 4-2. 관리자 승인 페이지
- **파일**: `app/admin/affiliate/sales/pending-approval/page.tsx` (이미 있을 수 있음)
- **기능**:
  - 승인 대기 목록 표시
  - Google Drive 링크로 녹음 파일 확인
  - 승인/거부 버튼
  - 거부 사유 입력

**예상 소요 시간**: 3-4시간

**확인 방법:**
- 실제로 화면에서 버튼 클릭
- 파일 업로드 테스트
- 승인/거부 테스트

---

## 📝 구현 순서 추천

### 방법 1: 단계별 순차 구현 (추천)
1. 2단계 완료 → 테스트
2. 3단계 완료 → 테스트
3. 4단계 완료 → 테스트

**장점**: 각 단계를 확실히 완료하고 넘어감
**단점**: 시간이 조금 더 걸림

### 방법 2: 병렬 구현
1. 2단계와 3-1 동시 진행
2. 3-2, 3-3, 3-4 동시 진행
3. 4단계 진행

**장점**: 빠르게 완료 가능
**단점**: 문제 발생 시 찾기 어려울 수 있음

---

## 🚀 시작하기

### 지금 바로 할 수 있는 것

1. **2단계부터 시작**
   ```
   "2단계 Google Drive 업로드 함수 만들어줘"
   ```

2. **3단계부터 시작** (2단계가 이미 있다면)
   ```
   "3단계 API 구현해줘"
   ```

3. **전체를 한 번에**
   ```
   "판매 확정 프로세스 2-4단계 모두 구현해줘"
   ```

---

## 💡 팁

- 각 단계를 완료한 후 반드시 테스트하세요
- 문제가 생기면 바로 알려주세요
- 작은 단위로 나눠서 진행하는 것이 좋습니다

---

## ❓ 질문

**Q: 어느 단계부터 시작하면 되나요?**
A: 2단계부터 순서대로 진행하는 것을 추천합니다.

**Q: 이미 일부 구현되어 있나요?**
A: 네, 일부 API가 이미 있을 수 있습니다. 확인 후 진행하세요.

**Q: 시간이 얼마나 걸리나요?**
A: 전체적으로 5-7시간 정도 예상됩니다.


> 작성일: 2025-01-28  
> 목적: 판매 확정 프로세스 2-4단계 구현 가이드

---

## 📊 현재 진행 상황

### ✅ 완료된 단계
- **1단계: 데이터베이스 수정** ✅
  - `AffiliateSale` 모델에 필드 추가 완료
  - 상태 값 정의 완료

### 🔄 진행 필요 단계
- **2단계: Google Drive 업로드 함수** (진행 필요)
- **3단계: API 구현** (진행 필요)
- **4단계: UI 구현** (진행 필요)

---

## 🎯 다음 단계 설명

### 2단계: Google Drive 업로드 함수 만들기

**목적**: 녹음 파일을 Google Drive에 저장하는 함수 만들기

**작업 내용:**
1. `lib/google-drive.ts` 파일 확인
2. `uploadAudioFileToDrive` 함수 추가 (이미 있을 수 있음)
3. 파일 크기 제한 설정 (예: 10MB)
4. 파일 형식 제한 (mp3, wav, m4a)

**예상 소요 시간**: 30분

**확인 방법:**
- 함수가 정상 작동하는지 테스트
- Google Drive에 파일이 올라가는지 확인

---

### 3단계: API 구현

**목적**: 판매 확정 요청, 승인, 거부를 처리하는 API 만들기

**작업 내용:**

#### 3-1. 판매 확정 요청 API
- **파일**: `app/api/affiliate/sales/[saleId]/submit-confirmation/route.ts`
- **기능**: 
  - 녹음 파일 업로드 (Google Drive)
  - 상태를 `PENDING_APPROVAL`로 변경
  - 제출 정보 저장

#### 3-2. 관리자 승인 API
- **파일**: `app/api/admin/affiliate/sales/[saleId]/approve/route.ts`
- **기능**:
  - 상태를 `APPROVED`로 변경
  - 수당 자동 계산 (`syncSaleCommissionLedgers`)
  - 알림 전송

#### 3-3. 관리자 거부 API
- **파일**: `app/api/admin/affiliate/sales/[saleId]/reject/route.ts`
- **기능**:
  - 상태를 `REJECTED`로 변경
  - 거부 사유 저장
  - 알림 전송

#### 3-4. 승인 대기 목록 API
- **파일**: `app/api/admin/affiliate/sales/pending-approval/route.ts` (이미 수정됨)
- **기능**: `PENDING_APPROVAL` 상태 판매 목록 조회

**예상 소요 시간**: 2-3시간

**확인 방법:**
- 각 API를 직접 호출해서 테스트
- 데이터베이스에 올바르게 저장되는지 확인

---

### 4단계: UI 구현

**목적**: 사용자가 쉽게 사용할 수 있는 화면 만들기

**작업 내용:**

#### 4-1. 판매원/대리점장 대시보드
- **파일**: `app/partner/[partnerId]/dashboard/PartnerDashboard.tsx`
- **기능**:
  - 내 판매 목록 표시
  - 판매 확정 요청 버튼
  - 녹음 파일 업로드
  - 상태 표시 (PENDING, PENDING_APPROVAL, APPROVED, REJECTED)

#### 4-2. 관리자 승인 페이지
- **파일**: `app/admin/affiliate/sales/pending-approval/page.tsx` (이미 있을 수 있음)
- **기능**:
  - 승인 대기 목록 표시
  - Google Drive 링크로 녹음 파일 확인
  - 승인/거부 버튼
  - 거부 사유 입력

**예상 소요 시간**: 3-4시간

**확인 방법:**
- 실제로 화면에서 버튼 클릭
- 파일 업로드 테스트
- 승인/거부 테스트

---

## 📝 구현 순서 추천

### 방법 1: 단계별 순차 구현 (추천)
1. 2단계 완료 → 테스트
2. 3단계 완료 → 테스트
3. 4단계 완료 → 테스트

**장점**: 각 단계를 확실히 완료하고 넘어감
**단점**: 시간이 조금 더 걸림

### 방법 2: 병렬 구현
1. 2단계와 3-1 동시 진행
2. 3-2, 3-3, 3-4 동시 진행
3. 4단계 진행

**장점**: 빠르게 완료 가능
**단점**: 문제 발생 시 찾기 어려울 수 있음

---

## 🚀 시작하기

### 지금 바로 할 수 있는 것

1. **2단계부터 시작**
   ```
   "2단계 Google Drive 업로드 함수 만들어줘"
   ```

2. **3단계부터 시작** (2단계가 이미 있다면)
   ```
   "3단계 API 구현해줘"
   ```

3. **전체를 한 번에**
   ```
   "판매 확정 프로세스 2-4단계 모두 구현해줘"
   ```

---

## 💡 팁

- 각 단계를 완료한 후 반드시 테스트하세요
- 문제가 생기면 바로 알려주세요
- 작은 단위로 나눠서 진행하는 것이 좋습니다

---

## ❓ 질문

**Q: 어느 단계부터 시작하면 되나요?**
A: 2단계부터 순서대로 진행하는 것을 추천합니다.

**Q: 이미 일부 구현되어 있나요?**
A: 네, 일부 API가 이미 있을 수 있습니다. 확인 후 진행하세요.

**Q: 시간이 얼마나 걸리나요?**
A: 전체적으로 5-7시간 정도 예상됩니다.










