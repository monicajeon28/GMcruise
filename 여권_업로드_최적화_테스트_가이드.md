# 여권 업로드 최적화 기능 테스트 가이드

**작업 일자**: 2025-01-28  
**적용 위치**: `/passport/[token]/page.tsx` (고객 여권 제출 페이지)

---

## 📍 기능이 적용된 위치

### 고객 여권 제출 페이지
- **경로**: `/passport/[token]`
- **접근 방법**: 관리자가 여권 요청을 보내면 고객이 받는 링크
- **기능**: 여권 이미지 업로드 (압축, 진행률 표시, 백그라운드 업로드)

---

## 🧪 테스트 방법

### 방법 1: 관리자 패널 - 고객 상세 페이지에서 여권 요청

#### 1단계: 관리자 로그인
```
1. http://localhost:3000/admin/login 접속
2. 관리자 계정으로 로그인
```

#### 2단계: 고객 상세 페이지로 이동
```
1. 관리자 패널 메뉴에서 "어필리에이트" > "고객" 클릭
2. 고객 목록에서 테스트할 고객 선택
3. 고객 상세 페이지로 이동: /admin/affiliate/customers/[leadId]
```

#### 3단계: 여권 요청 보내기
```
1. 고객 상세 페이지에서 "여권 요청" 버튼 클릭
2. 확인 메시지에서 "확인" 클릭
3. 여권 요청이 전송되면 고객에게 링크가 전송됨 (SMS/이메일)
```

#### 4단계: 고객 여권 제출 페이지 접근
```
1. 고객이 받은 링크 클릭 (예: http://localhost:3000/passport/abc123xyz)
2. 여권 업로드 페이지가 열림
```

#### 5단계: 여권 업로드 최적화 기능 테스트
```
1. "여권 사진 선택하기" 버튼 클릭
2. 이미지 파일 선택 (5MB 이상의 대용량 이미지 권장)
3. 다음 기능들이 자동으로 작동하는지 확인:
   ✅ 이미지 압축 (0-30% 진행률)
   ✅ Google Drive 업로드 (30-100% 진행률)
   ✅ 실시간 진행률 표시 (퍼센트 + 프로그레스 바)
   ✅ 업로드 중 다른 단계로 이동 가능 (백그라운드 업로드)
```

---

### 방법 2: 관리자 패널 - 여권 요청 전용 페이지

#### 1단계: 여권 요청 페이지 접근
```
1. 관리자 패널 메뉴에서 "여권 요청" 클릭
2. 또는 직접 접근: /admin/passport-request
```

#### 2단계: 고객 선택 및 여권 요청
```
1. 고객 검색 또는 목록에서 고객 선택
2. 템플릿 선택 (기본 템플릿 또는 커스텀 템플릿)
3. "여권 요청 전송" 버튼 클릭
4. 고객에게 링크가 전송됨
```

#### 3단계: 고객 여권 제출 페이지 접근
```
1. 고객이 받은 링크 클릭
2. 여권 업로드 최적화 기능 테스트 (방법 1의 5단계와 동일)
```

---

## ✅ 테스트 체크리스트

### 이미지 압축 기능
- [ ] 대용량 이미지 (5MB+) 선택 시 자동 압축 확인
- [ ] 압축 진행률 표시 (0-30%) 확인
- [ ] 압축 후 파일 크기 감소 확인
- [ ] 압축 실패 시 원본 파일 사용 확인

### 진행률 표시 기능
- [ ] 실시간 진행률 퍼센트 표시 확인
- [ ] 프로그레스 바 애니메이션 확인
- [ ] 단계별 메시지 표시 확인:
  - [ ] "이미지 압축 중..." (0-30%)
  - [ ] "Google Drive에 업로드 중..." (30-100%)
  - [ ] "업로드 완료!" (100%)
- [ ] 업로드 중인 파일명 표시 확인

### 백그라운드 업로드 기능
- [ ] 업로드 시작 후 즉시 UI 반환 확인
- [ ] 업로드 중 다른 단계로 이동 가능 확인
- [ ] 업로드 완료 시 파일 목록 자동 업데이트 확인
- [ ] 업로드 중에도 페이지 다른 기능 사용 가능 확인

### 파일 크기 제한
- [ ] 10MB 이하 파일 정상 업로드 확인
- [ ] 10MB 초과 파일 업로드 시 에러 메시지 확인

---

## 🔗 관련 페이지 및 API

### 페이지
- **고객 여권 제출 페이지**: `/passport/[token]` (최적화 기능 적용)
- **관리자 - 고객 상세**: `/admin/affiliate/customers/[leadId]`
- **관리자 - 여권 요청**: `/admin/passport-request`

### API
- **여권 업로드 API**: `/api/passport/[token]/upload` (POST)
- **여권 요청 전송 API**: `/api/admin/passport-request/send` (POST)
- **고객별 여권 요청 API**: `/api/admin/affiliate/leads/[leadId]/request-passport` (POST)

---

## 📝 테스트 시나리오 예시

### 시나리오 1: 대용량 이미지 업로드
```
1. 8MB 크기의 JPG 이미지 선택
2. 자동 압축으로 2MB 이하로 줄어드는지 확인
3. 업로드 시간이 단축되는지 확인
4. 진행률이 정확히 표시되는지 확인
```

### 시나리오 2: 업로드 중 다른 작업
```
1. 이미지 업로드 시작
2. 업로드 진행 중 "다음 단계로" 버튼 클릭
3. 다른 단계로 이동 가능한지 확인
4. 백그라운드에서 업로드가 계속 진행되는지 확인
5. 업로드 완료 후 파일 목록에 추가되는지 확인
```

### 시나리오 3: 여러 이미지 연속 업로드
```
1. 첫 번째 이미지 업로드 시작
2. 업로드 완료 전 두 번째 이미지 선택
3. 두 개의 업로드가 동시에 진행되는지 확인
4. 각각의 진행률이 독립적으로 표시되는지 확인
```

---

## 🐛 문제 발생 시 확인 사항

### 이미지 압축이 작동하지 않는 경우
- 브라우저 콘솔에서 에러 확인
- `browser-image-compression` 라이브러리 설치 확인
- 파일 타입이 이미지인지 확인

### 진행률이 표시되지 않는 경우
- 네트워크 탭에서 업로드 요청 확인
- XMLHttpRequest 이벤트 리스너 확인
- React state 업데이트 확인

### 백그라운드 업로드가 작동하지 않는 경우
- Promise가 await 없이 실행되는지 확인
- 업로드 중에도 UI가 반응하는지 확인
- 파일 목록 업데이트 로직 확인

---

## 💡 테스트 팁

1. **대용량 이미지 준비**: 실제 여권 사진보다 큰 이미지(5MB+)로 테스트하면 압축 효과를 명확히 확인할 수 있습니다.

2. **네트워크 속도 조절**: 브라우저 개발자 도구에서 네트워크 속도를 "Slow 3G"로 설정하면 진행률 표시를 더 명확히 확인할 수 있습니다.

3. **콘솔 확인**: 브라우저 개발자 도구 콘솔에서 에러나 경고 메시지를 확인하세요.

4. **여러 브라우저 테스트**: Chrome, Safari, Firefox 등 다양한 브라우저에서 테스트하세요.

---

## ✅ 테스트 완료 기준

다음 항목들이 모두 정상 작동하면 테스트 완료:
- ✅ 이미지 자동 압축 작동
- ✅ 진행률 정확히 표시 (0-100%)
- ✅ 단계별 메시지 정확히 표시
- ✅ 백그라운드 업로드 작동 (업로드 중 다른 작업 가능)
- ✅ 업로드 완료 시 파일 목록 자동 업데이트
- ✅ 파일 크기 제한 정상 작동 (10MB 초과 시 에러)

---

**작성일**: 2025-01-28  
**상태**: ✅ 완료


