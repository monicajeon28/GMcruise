# 메시지함 최종 테스트 가이드

> **작성일**: 2025년 1월 28일  
> **테스트 범위**: 팀 메시지 시스템 전체 기능

---

## 📋 테스트 전 준비사항

### 1. 테스트 계정 준비
다음 계정들이 필요합니다:
- **관리자 계정** 1개 이상
- **대리점장 계정** 1개 이상
- **판매원 계정** 1개 이상 (대리점장과 연결된 관계)

### 2. AffiliateRelation 확인
판매원과 대리점장이 올바르게 연결되어 있는지 확인:
- 판매원의 `AffiliateRelation`에서 담당 대리점장이 설정되어 있어야 함
- 대리점장의 `AffiliateRelation`에서 소속 판매원이 설정되어 있어야 함

### 3. 접속 URL 확인
- 관리자 패널: `http://localhost:3000/admin/team-dashboard-messages` (또는 프로덕션 URL)
- 판매원 대시보드: `http://localhost:3000/admin/affiliate/agent-dashboard`
- 대리점장 대시보드: `http://localhost:3000/admin/affiliate/team-dashboard`

---

## 🧪 테스트 시나리오

### 시나리오 1: 관리자 → 판매원/대리점장 메시지 전송

#### 1-1. 관리자 패널 접속
1. 관리자 계정으로 로그인
2. 좌측 메뉴에서 **"팀 대시보드 메시지함"** 클릭
3. 페이지가 정상적으로 로드되는지 확인

#### 1-2. 메시지 전송
1. **"메시지 보내기"** 버튼 클릭
2. 고객 검색창에서 판매원 또는 대리점장 검색
3. 수신자 선택 (체크박스)
4. 제목과 내용 입력
5. **"전송"** 버튼 클릭
6. 성공 메시지 확인

#### 1-3. 판매원 대시보드에서 확인
1. 판매원 계정으로 로그인
2. 판매원 대시보드 접속
3. **"Team Messages"** 버튼 확인 (미읽음 개수 배지 표시)
4. 버튼 클릭하여 메시지 모달 열기
5. **"Received"** 탭에서 받은 메시지 확인
6. 메시지 클릭하여 읽음 처리
7. 미읽음 개수 감소 확인

#### 1-4. 대리점장 대시보드에서 확인
1. 대리점장 계정으로 로그인
2. 대리점장 대시보드 접속
3. **"Team Messages"** 버튼 확인
4. 동일한 절차로 메시지 확인

**✅ 예상 결과:**
- 관리자가 보낸 메시지가 판매원/대리점장 대시보드에 표시됨
- 미읽음 개수 배지가 정확히 표시됨
- 읽음 처리 후 미읽음 개수 감소

---

### 시나리오 2: 판매원 → 대리점장 메시지 전송

#### 2-1. 판매원 대시보드 접속
1. 판매원 계정으로 로그인
2. 판매원 대시보드 접속 (`/admin/affiliate/agent-dashboard`)
3. 우측 상단 또는 빠른 메뉴에서 **"Team Messages"** 버튼 클릭
   - 버튼에 미읽음 개수가 빨간 배지로 표시됨 (예: "3")

#### 2-2. 메시지 보내기 모달 열기
1. 메시지 모달이 열리면 상단 오른쪽에 **"보내기"** 버튼이 보임
2. **"보내기"** 버튼 클릭
3. 메시지 보내기 모달이 열림

#### 2-3. 메시지 작성 및 전송
1. **수신자 선택**:
   - 드롭다운에서 수신자 선택
   - ✅ 담당 대리점장만 표시되어야 함
   - ✅ 관리자 목록 표시
   - ❌ 다른 판매원은 표시되지 않아야 함
   - ❌ 본인은 표시되지 않아야 함
2. **제목 입력**: 메시지 제목 입력
3. **내용 입력**: 메시지 내용 입력
4. **"보내기"** 버튼 클릭
5. 성공 메시지 확인
2. 수신자 선택 모달 확인:
   - ✅ 담당 대리점장만 표시되어야 함
   - ✅ 관리자 목록 표시
   - ❌ 다른 판매원은 표시되지 않아야 함
   - ❌ 본인은 표시되지 않아야 함
3. 수신자 선택 (담당 대리점장 또는 관리자)
4. 제목과 내용 입력
5. **"Send"** 버튼 클릭
6. 성공 메시지 확인

#### 2-4. 대리점장 대시보드에서 확인
1. 대리점장 계정으로 로그인
2. 대리점장 대시보드 접속 (`/admin/affiliate/team-dashboard`)
3. **"Team Messages"** 버튼 클릭
4. **"Received"** 탭에서 판매원이 보낸 메시지 확인
5. 메시지 타입 뱃지 확인: **"판매원→대리점장"**
6. 메시지 클릭하여 읽음 처리
7. 미읽음 개수 감소 확인

#### 2-5. 판매원 대시보드에서 보낸 메시지 확인
1. 판매원 대시보드로 돌아가기
2. **"Team Messages"** → **"Sent"** 탭 클릭
3. 방금 보낸 메시지가 목록에 표시되는지 확인
4. 메시지 옆에 **삭제 버튼**이 있는지 확인

#### 2-6. 관리자 패널에서 확인
1. 관리자 패널의 **"팀 대시보드 메시지함"** 접속 (`/admin/team-dashboard-messages`)
2. 메시지 목록에서 판매원이 보낸 메시지 확인
3. 메시지 타입 필터로 **"판매원→대리점장"** 필터링 확인

**✅ 예상 결과:**
- 판매원이 담당 대리점장에게만 메시지 전송 가능
- 대리점장이 메시지를 받음
- 관리자 패널에서도 메시지 확인 가능

---

### 시나리오 3: 대리점장 → 판매원 메시지 전송

#### 3-1. 대리점장 대시보드 접속
1. 대리점장 계정으로 로그인
2. 대리점장 대시보드 접속 (`/admin/affiliate/team-dashboard`)
3. **"Team Messages"** 버튼 클릭

#### 3-2. 메시지 보내기 모달 열기
1. 메시지 모달 상단 오른쪽에 **"보내기"** 버튼 클릭
2. 메시지 보내기 모달이 열림

#### 3-3. 메시지 작성 및 전송
1. **수신자 선택**:
   - 드롭다운에서 수신자 선택
   - ✅ 소속 판매원만 표시되어야 함
   - ✅ 다른 대리점장 목록 표시
   - ✅ 관리자 목록 표시
   - ❌ 본인은 표시되지 않아야 함
2. **제목과 내용 입력**
3. **"보내기"** 버튼 클릭
2. 수신자 선택 모달 확인:
   - ✅ 소속 판매원만 표시되어야 함
   - ✅ 다른 대리점장 목록 표시
   - ✅ 관리자 목록 표시
   - ❌ 본인은 표시되지 않아야 함
3. 수신자 선택 (소속 판매원)
4. 제목과 내용 입력
5. **"Send"** 버튼 클릭

#### 3-3. 판매원 대시보드에서 확인
1. 해당 판매원 계정으로 로그인
2. 판매원 대시보드 접속
3. **"Team Messages"** 버튼 클릭
4. **"Received"** 탭에서 대리점장이 보낸 메시지 확인
5. 메시지 타입 뱃지 확인: **"대리점장→판매원"**

**✅ 예상 결과:**
- 대리점장이 소속 판매원에게 메시지 전송 가능
- 판매원이 메시지를 받음

---

### 시나리오 4: 대리점장 → 대리점장 메시지 전송

#### 4-1. 대리점장 A 대시보드 접속
1. 대리점장 A 계정으로 로그인
2. 대리점장 대시보드 접속
3. **"Team Messages"** 버튼 클릭

#### 4-2. 메시지 보내기
1. 메시지 모달 상단 **"보내기"** 버튼 클릭
2. 수신자 드롭다운에서 **다른 대리점장** 선택
3. 제목과 내용 입력
4. **"Send"** 버튼 클릭

#### 4-3. 대리점장 B 대시보드에서 확인
1. 대리점장 B 계정으로 로그인
2. 대리점장 대시보드 접속
3. **"Team Messages"** 버튼 클릭
4. **"Received"** 탭에서 대리점장 A가 보낸 메시지 확인
5. 메시지 타입 뱃지 확인: **"대리점장→대리점장"**

**✅ 예상 결과:**
- 대리점장끼리 메시지 전송 가능
- 메시지 타입이 올바르게 표시됨

---

### 시나리오 5: 메시지 삭제 기능

#### 5-1. 판매원이 보낸 메시지 삭제
1. 판매원 계정으로 로그인
2. 판매원 대시보드 → **"Team Messages"** → **"Sent"** 탭
3. 본인이 보낸 메시지 확인
4. 메시지 옆 **삭제 버튼** 클릭
5. 확인 대화상자에서 **"확인"** 클릭
6. 메시지가 목록에서 사라지는지 확인

#### 5-2. 다른 사람이 보낸 메시지 삭제 시도
1. 판매원 계정으로 로그인
2. **"Received"** 탭에서 다른 사람이 보낸 메시지 확인
3. 삭제 버튼이 표시되지 않아야 함 (또는 클릭해도 작동하지 않아야 함)

#### 5-3. 관리자 패널에서 확인
1. 관리자 패널 → **"팀 대시보드 메시지함"**
2. 삭제된 메시지가 목록에서 사라졌는지 확인
3. (선택사항) 필터로 삭제된 메시지 확인 불가능한지 확인

**✅ 예상 결과:**
- 본인이 보낸 메시지만 삭제 가능
- 삭제된 메시지는 모든 대시보드에서 사라짐
- 다른 사람이 보낸 메시지는 삭제 불가

---

### 시나리오 6: 관리자 패널 고급 기능

#### 6-1. 필터링 기능
1. 관리자 패널 → **"팀 대시보드 메시지함"**
2. **날짜 범위 필터** 테스트:
   - 시작일/종료일 선택
   - 해당 기간의 메시지만 표시되는지 확인
3. **발신자 필터** 테스트:
   - 발신자 선택
   - 해당 발신자의 메시지만 표시되는지 확인
4. **읽음 상태 필터** 테스트:
   - "읽음" / "미읽음" 선택
   - 필터링이 정상 작동하는지 확인
5. **메시지 타입 필터** 테스트:
   - "팀 대시보드" / "판매원→대리점장" 등 선택
   - 필터링이 정상 작동하는지 확인
6. **검색 기능** 테스트:
   - 검색어 입력
   - 제목/내용/발신자명으로 검색되는지 확인
7. **필터 초기화** 버튼 클릭
   - 모든 필터가 초기화되는지 확인

#### 6-2. 읽음 상태 상세 정보
1. 메시지 목록에서 메시지 클릭
2. 메시지 상세 모달 열림 확인
3. **"Read Status"** 탭 클릭
4. 다음 정보 확인:
   - 읽은 사용자 목록 (읽은 시간 포함)
   - 읽지 않은 사용자 목록
   - 읽음률 통계 카드

#### 6-3. 통계 대시보드
1. **"통계 보기"** 버튼 클릭
2. 통계 대시보드 표시 확인:
   - 총 발송 수
   - 총 읽음 수
   - 평균 읽음률
   - 메시지 그룹 수
3. **날짜 범위 선택** 테스트:
   - 시작일/종료일 변경
   - 통계가 업데이트되는지 확인
4. **일별 추이 차트** 확인:
   - 발송/읽음 막대 차트 표시
5. **발신자별 통계** 확인:
   - 발신자별 발송/읽음 통계 표시
6. **인기 메시지 TOP 10** 확인:
   - 읽음률이 높은 메시지 목록 표시

#### 6-4. 그룹 메시지 답장
1. 메시지 목록에서 그룹 메시지 클릭
2. 메시지 상세 모달에서 **"Reply"** 버튼 클릭
3. 답장 모드 선택:
   - **"모든 수신자에게 답장"**: 모든 수신자 선택됨
   - **"선택한 수신자에게 답장"**: 수신자 체크박스로 선택
   - **"원래 발신자에게만 답장"**: 발신자만 선택됨
4. 답장 내용 입력
5. **"Send Reply"** 버튼 클릭
6. 수신자 수 표시 확인
7. 성공 메시지 확인

**✅ 예상 결과:**
- 모든 필터링 기능 정상 작동
- 읽음 상태 상세 정보 정확히 표시
- 통계 대시보드 정상 작동
- 그룹 메시지 답장 기능 정상 작동

---

### 시나리오 7: 권한 검증 테스트

#### 7-1. 판매원 → 판매원 메시지 전송 시도
1. 판매원 A 계정으로 로그인
2. 판매원 대시보드 → **"Team Messages"** → **"Send Message"**
3. 수신자 목록에서 **다른 판매원**이 표시되지 않는지 확인
4. (만약 표시된다면) 다른 판매원 선택 후 전송 시도
5. **에러 메시지 표시** 확인: "판매원끼리는 메시지를 보낼 수 없습니다."

#### 7-2. 본인에게 메시지 전송 시도
1. 판매원 계정으로 로그인
2. **"Send Message"** → 수신자 목록 확인
3. **본인이 목록에 없는지** 확인
4. (만약 있다면) 본인 선택 후 전송 시도
5. **에러 메시지 표시** 확인: "자기 자신에게는 메시지를 보낼 수 없습니다."

#### 7-3. 권한 없는 수신자 선택 시도
1. 판매원 계정으로 로그인
2. API를 직접 호출하여 권한 없는 수신자에게 메시지 전송 시도
3. **403 Forbidden** 또는 적절한 에러 메시지 확인

**✅ 예상 결과:**
- 판매원끼리 메시지 전송 불가
- 본인에게 메시지 전송 불가
- 권한 없는 수신자에게 메시지 전송 불가

---

## 🔍 체크리스트

### 기본 기능
- [ ] 관리자 → 판매원/대리점장 메시지 전송
- [ ] 판매원 → 대리점장 메시지 전송
- [ ] 판매원 → 관리자 메시지 전송
- [ ] 대리점장 → 판매원 메시지 전송
- [ ] 대리점장 → 대리점장 메시지 전송
- [ ] 대리점장 → 관리자 메시지 전송
- [ ] 메시지 조회 (받은 메시지/보낸 메시지)
- [ ] 메시지 읽음 처리
- [ ] 미읽음 개수 배지 표시
- [ ] 메시지 삭제 (본인이 보낸 메시지만)

### 관리자 패널 고급 기능
- [ ] 필터링 (날짜 범위, 발신자, 읽음 상태, 메시지 타입)
- [ ] 검색 기능
- [ ] 필터 초기화
- [ ] 읽음 상태 상세 정보
- [ ] 통계 대시보드
- [ ] 그룹 메시지 답장 (모든 수신자/선택한 수신자/발신자만)

### 권한 검증
- [ ] 판매원 → 판매원 메시지 전송 차단
- [ ] 본인에게 메시지 전송 차단
- [ ] 권한 없는 수신자 선택 차단

### UI/UX
- [ ] 메시지 타입 뱃지 표시
- [ ] 미읽음 개수 배지 표시
- [ ] 메시지 목록 정렬
- [ ] 모달 열기/닫기
- [ ] 로딩 상태 표시
- [ ] 에러 메시지 표시

---

## 🐛 문제 발생 시 확인사항

### 메시지가 표시되지 않는 경우
1. 브라우저 콘솔에서 에러 확인 (F12 → Console)
2. 네트워크 탭에서 API 호출 확인 (F12 → Network)
3. API 응답 상태 코드 확인 (200 OK 여부)
4. 데이터베이스에서 `AdminMessage` 레코드 확인
5. `isActive: true` 확인 (삭제된 메시지는 `false`)

### 미읽음 개수가 정확하지 않은 경우
1. `AdminMessageRead` 테이블 확인
2. `userId`와 `messageId` 매칭 확인
3. 브라우저 콘솔에서 API 응답 확인

### 메시지 전송이 실패하는 경우
1. 브라우저 콘솔에서 에러 확인
2. 네트워크 탭에서 API 요청/응답 확인
3. 권한 검증 로직 확인
4. `AffiliateRelation` 테이블 확인

### 필터링이 작동하지 않는 경우
1. 필터 파라미터가 API에 전달되는지 확인
2. API에서 필터링 로직 확인
3. 브라우저 콘솔에서 필터 상태 확인

---

## 📝 테스트 결과 기록

### 테스트 일시
- 시작: _______________
- 종료: _______________

### 테스트 환경
- 브라우저: _______________
- 환경: [ ] 로컬 [ ] 스테이징 [ ] 프로덕션
- URL: _______________

### 테스트 결과
- [ ] 모든 시나리오 통과
- [ ] 일부 시나리오 실패 (아래에 상세 기록)

### 발견된 문제
1. **문제 설명**: _______________
   - **재현 단계**: _______________
   - **예상 결과**: _______________
   - **실제 결과**: _______________
   - **우선순위**: [ ] 높음 [ ] 중간 [ ] 낮음

2. **문제 설명**: _______________
   - **재현 단계**: _______________
   - **예상 결과**: _______________
   - **실제 결과**: _______________
   - **우선순위**: [ ] 높음 [ ] 중간 [ ] 낮음

---

## ✅ 테스트 완료 기준

다음 항목이 모두 통과하면 테스트 완료:
- [ ] 모든 기본 기능 정상 작동
- [ ] 모든 권한 검증 정상 작동
- [ ] 관리자 패널 고급 기능 정상 작동
- [ ] UI/UX 정상 작동
- [ ] 에러 처리 정상 작동
- [ ] 성능 문제 없음

---

**작성자**: AI Assistant  
**최종 업데이트**: 2025년 1월 28일  
**버전**: 1.0

