# 여권 폼 자동화 발송 기능 테스트 가이드

## ✅ 구현 완료된 기능

### 1. 고객용 여권 폼 (`/customer/passport/[reservationId]`)
- ✅ 예약 정보 자동 로드
- ✅ 구매한 여행 정보 자동 표시
- ✅ 5단계 입력 폼 (단계별 안내)
- ✅ 여권 정보 + PNR 정보 함께 처리
- ✅ OCR 스캔 기능
- ✅ 추후 제출 옵션

### 2. 링크 생성 및 발송 기능

#### 위치 1: 수동여권등록 페이지 (예약 생성 후)
- **경로**: `/partner/[partnerId]/reservation/new`
- **버튼**: "자동여권보내기링크" (예약 생성 후 표시)
- **기능**:
  - 링크 복사
  - 문자 발송 (알리고 API)
  - 아이폰/삼성 미리보기

#### 위치 2: 구매고객관리 페이지
- **경로**: `/partner/[partnerId]/purchased-customers`
- **버튼**: 각 예약마다 "여권 보내기" 버튼
- **기능**:
  - 링크 복사
  - 문자 발송 (알리고 API)
  - 아이폰/삼성 미리보기

### 3. 제출 API (`/api/passport/submit`)
- ✅ 여권 정보 저장
- ✅ PNR 상태 업데이트 (`pnrStatus: '진행중'`)
- ✅ User 테이블에 연락처 업데이트
- ✅ Traveler 정보 upsert

## 🧪 테스트 시나리오

### 시나리오 1: 수동여권등록에서 링크 발송
1. 대리점장 대시보드 접속
2. "수동여권등록" 메뉴 클릭
3. 예약 정보 입력 및 생성
4. 예약 생성 성공 화면에서 "자동여권보내기링크" 버튼 클릭
5. 모달에서:
   - 전화번호 입력
   - 메시지 내용 확인 (자동으로 링크 포함)
   - "아이폰 미리보기" 또는 "삼성 미리보기" 클릭하여 확인
   - "링크 복사" 또는 "문자 보내기" 클릭

### 시나리오 2: 구매고객관리에서 링크 발송
1. 대리점장 대시보드 접속
2. "구매고객관리" 메뉴 클릭
3. 예약 목록에서 원하는 예약 찾기
4. "여권 보내기" 버튼 클릭
5. 모달에서:
   - 전화번호 입력 (자동으로 고객 전화번호 입력됨)
   - 메시지 내용 확인 및 수정
   - 미리보기 확인
   - 링크 복사 또는 문자 발송

### 시나리오 3: 고객이 링크를 받아서 입력
1. 고객이 받은 링크 클릭
2. 예약 정보 자동 로드 확인:
   - 크루즈명
   - 출발일
   - 선박명
   - 여행자 수
3. 5단계 입력 진행:
   - 1단계: 여행자 기본 정보
   - 2단계: 여권 정보
   - 3단계: 추가 정보
   - 4단계: 확인
   - 5단계: 제출
4. "제출하기" 버튼 클릭
5. 성공 메시지 확인

### 시나리오 4: 데이터 저장 확인
1. 관리자 패널 또는 대리점장 대시보드에서 예약 상세 확인
2. 여권 정보가 정상적으로 저장되었는지 확인
3. PNR 상태가 "진행중"으로 변경되었는지 확인
4. User 테이블의 연락처가 업데이트되었는지 확인

## 🔗 링크 형식

```
https://your-domain.com/customer/passport/{reservationId}
```

예시:
```
https://your-domain.com/customer/passport/123
```

## 📝 주의사항

1. **예약 생성 필수**: 링크를 생성하려면 먼저 예약(Reservation)이 생성되어야 합니다.
2. **reservationId 필요**: 링크에는 예약 ID가 포함되어야 합니다.
3. **동일한 API 사용**: 고객이 직접 입력하든, 대리점장이 수동으로 입력하든 동일한 API(`/api/passport/submit`)를 사용합니다.

## 🐛 문제 해결

### 문제: 링크가 404 에러 발생
- **원인**: 예약이 생성되지 않았거나 reservationId가 잘못됨
- **해결**: 예약 생성 확인 및 올바른 reservationId 사용

### 문제: 예약 정보가 로드되지 않음
- **원인**: API 엔드포인트(`/api/customer/reservation/[reservationId]`) 오류
- **해결**: 서버 로그 확인 및 API 응답 확인

### 문제: 제출이 실패함
- **원인**: 필수 정보 누락 또는 API 오류
- **해결**: 브라우저 콘솔 및 서버 로그 확인

## ✅ 체크리스트

- [ ] 서버가 정상적으로 시작됨 (라우팅 충돌 없음)
- [ ] 수동여권등록 페이지에서 링크 생성 가능
- [ ] 구매고객관리 페이지에서 링크 생성 가능
- [ ] 링크 복사 기능 작동
- [ ] 문자 발송 기능 작동
- [ ] 미리보기 기능 작동
- [ ] 고객이 링크 접근 시 예약 정보 자동 로드
- [ ] 여권 정보 입력 및 제출 성공
- [ ] 데이터가 정상적으로 저장됨
- [ ] PNR 상태가 업데이트됨

