# íŒ€ ëŒ€ì‹œë³´ë“œ ë©”ì‹œì§€í•¨ ê°œì„  ì„¤ê³„ì„œ

## ğŸ“‹ ê°œì„  ëª©í‘œ

1. âœ… íŒ€ ëŒ€ì‹œë³´ë“œ ë©”ì‹œì§€ì™€ ì¼ë°˜ ë©”ì‹œì§€ ì‹œê°ì  êµ¬ë¶„
2. âœ… ê°œë³„ ìˆ˜ì‹ ìë³„ ì½ìŒ ìƒíƒœ í‘œì‹œ
3. âœ… ê³ ê¸‰ í•„í„°ë§ ê¸°ëŠ¥ (ë‚ ì§œ ë²”ìœ„, ë°œì‹ ì, ì½ìŒ ìƒíƒœ)
4. âœ… ê·¸ë£¹ ë©”ì‹œì§€ ì „ì²´ ë‹µì¥ ê¸°ëŠ¥
5. âœ… í†µê³„ ëŒ€ì‹œë³´ë“œ (ë°œì†¡ë¥ , ì½ìŒë¥  ë“±)

---

## 1. ë©”ì‹œì§€ íƒ€ì… êµ¬ë¶„ ê°œì„ 

### 1.1 ì‚¬ìš©ì ì¸¡ (AdminMessageModal)

**ë³€ê²½ ì‚¬í•­:**
- `team-dashboard` ë©”ì‹œì§€ íƒ€ì…ì— ì „ìš© ì•„ì´ì½˜ ë° ìƒ‰ìƒ ì ìš©
- ë°°ì§€/ë¼ë²¨ë¡œ ë©”ì‹œì§€ íƒ€ì… ëª…ì‹œ

**êµ¬í˜„ ìœ„ì¹˜:** `components/AdminMessageModal.tsx`

```typescript
// ë©”ì‹œì§€ íƒ€ì…ë³„ ì•„ì´ì½˜
const getIcon = () => {
  switch (currentMessage?.messageType) {
    case 'team-dashboard':
      return <FiUsers className="text-teal-600" size={20} />; // ğŸ‘¥ íŒ€ ì•„ì´ì½˜
    case 'warning':
      return <FiAlertTriangle className="text-yellow-600" size={20} />;
    case 'promotion':
      return <FiGift className="text-green-600" size={20} />;
    case 'announcement':
      return <FiBell className="text-blue-600" size={20} />;
    default:
      return <FiInfo className="text-blue-600" size={20} />;
  }
};

// ë©”ì‹œì§€ íƒ€ì…ë³„ ë°°ê²½ìƒ‰
const getBgColor = () => {
  switch (currentMessage?.messageType) {
    case 'team-dashboard':
      return 'bg-teal-50 border-teal-200'; // í‹¸ ìƒ‰ìƒ
    case 'warning':
      return 'bg-yellow-50 border-yellow-200';
    case 'promotion':
      return 'bg-green-50 border-green-200';
    case 'announcement':
      return 'bg-blue-50 border-blue-200';
    default:
      return 'bg-blue-50 border-blue-200';
  }
};
```

**í—¤ë”ì— ë°°ì§€ ì¶”ê°€:**
```tsx
<div className="flex items-center gap-2 flex-1 min-w-0">
  {getMessageIcon()}
  {message.messageType === 'team-dashboard' && (
    <span className="text-xs bg-teal-100 text-teal-800 px-2 py-0.5 rounded">
      íŒ€ ëŒ€ì‹œë³´ë“œ
    </span>
  )}
  <h2 className="text-base font-bold text-gray-900 truncate">{message.title}</h2>
</div>
```

### 1.2 ê´€ë¦¬ì ì¸¡ (íŒ€ ëŒ€ì‹œë³´ë“œ ë©”ì‹œì§€í•¨)

**ë³€ê²½ ì‚¬í•­:**
- ë©”ì‹œì§€ ëª©ë¡ì— íƒ€ì… ë°°ì§€ í‘œì‹œ
- íŒ€ ëŒ€ì‹œë³´ë“œ ì „ìš© ìƒ‰ìƒ í…Œë§ˆ ìœ ì§€

**êµ¬í˜„ ìœ„ì¹˜:** `app/admin/team-dashboard-messages/page.tsx`

```tsx
<div className="flex items-center gap-2 mb-1">
  <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-teal-100 text-teal-800">
    <FiUsers className="w-3 h-3 mr-1" />
    íŒ€ ëŒ€ì‹œë³´ë“œ
  </span>
  <h3 className="font-semibold text-gray-900">{message.title}</h3>
</div>
```

---

## 2. ì½ìŒ ìƒíƒœ ìƒì„¸ ì •ë³´ í‘œì‹œ

### 2.1 API ê°œì„ 

**ìƒˆ ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€:** `app/api/admin/messages/[id]/readers/route.ts`

```typescript
// GET /api/admin/messages/[id]/readers
// íŠ¹ì • ë©”ì‹œì§€ì˜ ì½ìŒ ìƒíƒœ ìƒì„¸ ì •ë³´ ì¡°íšŒ

export async function GET(
  req: NextRequest,
  { params }: { params: { id: string } }
) {
  const messageId = parseInt(params.id);
  
  // ê°™ì€ ê·¸ë£¹ì˜ ëª¨ë“  ë©”ì‹œì§€ ID ì¡°íšŒ
  const message = await prisma.adminMessage.findUnique({
    where: { id: messageId },
    select: { title: true, content: true, messageType: true, adminId: true, createdAt: true }
  });
  
  // ê°™ì€ ê·¸ë£¹ì˜ ëª¨ë“  ë©”ì‹œì§€ ì°¾ê¸° (1ë¶„ ì´ë‚´, ê°™ì€ ì œëª©/ë‚´ìš©)
  const groupStartTime = new Date(message.createdAt);
  groupStartTime.setSeconds(0, 0);
  const groupEndTime = new Date(groupStartTime);
  groupEndTime.setMinutes(groupEndTime.getMinutes() + 1);
  
  const groupMessages = await prisma.adminMessage.findMany({
    where: {
      title: message.title,
      content: message.content,
      messageType: message.messageType,
      adminId: message.adminId,
      createdAt: {
        gte: groupStartTime,
        lt: groupEndTime,
      }
    },
    include: {
      User_AdminMessage_userIdToUser: {
        select: { id: true, name: true, phone: true }
      },
      UserMessageRead: {
        include: {
          User_UserMessageRead_userIdToUser: {
            select: { id: true, name: true, phone: true }
          }
        }
      }
    }
  });
  
  // ì½ìŒ/ë¯¸ì½ìŒ ìƒíƒœ ì •ë¦¬
  const readers = [];
  const nonReaders = [];
  
  groupMessages.forEach(msg => {
    const user = msg.User_AdminMessage_userIdToUser;
    const readRecord = msg.UserMessageRead.find(r => r.userId === user?.id);
    
    if (readRecord) {
      readers.push({
        userId: user.id,
        name: user.name,
        phone: user.phone,
        readAt: readRecord.readAt,
        messageId: msg.id,
      });
    } else {
      nonReaders.push({
        userId: user.id,
        name: user.name,
        phone: user.phone,
        messageId: msg.id,
      });
    }
  });
  
  return NextResponse.json({
    ok: true,
    totalSent: groupMessages.length,
    totalRead: readers.length,
    readRate: groupMessages.length > 0 ? (readers.length / groupMessages.length * 100).toFixed(1) : '0',
    readers,
    nonReaders,
  });
}
```

### 2.2 UI ê°œì„ 

**ë©”ì‹œì§€ ìƒì„¸ ëª¨ë‹¬ì— ì½ìŒ ìƒíƒœ íƒ­ ì¶”ê°€:**

```tsx
// app/admin/team-dashboard-messages/page.tsx

interface MessageDetailModalProps {
  message: TeamDashboardMessage;
  onClose: () => void;
}

const MessageDetailModal = ({ message, onClose }: MessageDetailModalProps) => {
  const [activeTab, setActiveTab] = useState<'detail' | 'readers'>('detail');
  const [readersData, setReadersData] = useState<any>(null);
  const [loadingReaders, setLoadingReaders] = useState(false);
  
  const loadReaders = async () => {
    setLoadingReaders(true);
    try {
      const response = await fetch(`/api/admin/messages/${message.id}/readers`, {
        credentials: 'include',
      });
      const data = await response.json();
      if (data.ok) {
        setReadersData(data);
      }
    } catch (error) {
      console.error('Failed to load readers:', error);
    } finally {
      setLoadingReaders(false);
    }
  };
  
  useEffect(() => {
    if (activeTab === 'readers' && !readersData) {
      loadReaders();
    }
  }, [activeTab]);
  
  return (
    <div className="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto">
      {/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}
      <div className="flex border-b mb-4">
        <button
          onClick={() => setActiveTab('detail')}
          className={`px-4 py-2 font-medium ${
            activeTab === 'detail'
              ? 'border-b-2 border-blue-600 text-blue-600'
              : 'text-gray-500 hover:text-gray-700'
          }`}
        >
          ë©”ì‹œì§€ ìƒì„¸
        </button>
        <button
          onClick={() => setActiveTab('readers')}
          className={`px-4 py-2 font-medium ${
            activeTab === 'readers'
              ? 'border-b-2 border-blue-600 text-blue-600'
              : 'text-gray-500 hover:text-gray-700'
          }`}
        >
          ì½ìŒ ìƒíƒœ ({readersData ? `${readersData.totalRead}/${readersData.totalSent}` : '...'})
        </button>
      </div>
      
      {activeTab === 'detail' && (
        // ê¸°ì¡´ ë©”ì‹œì§€ ìƒì„¸ ë‚´ìš©
      )}
      
      {activeTab === 'readers' && (
        <div className="space-y-4">
          {/* í†µê³„ ì¹´ë“œ */}
          <div className="grid grid-cols-3 gap-4">
            <div className="bg-blue-50 p-4 rounded-lg">
              <div className="text-sm text-gray-600">ì´ ë°œì†¡</div>
              <div className="text-2xl font-bold text-blue-600">
                {readersData?.totalSent || 0}
              </div>
            </div>
            <div className="bg-green-50 p-4 rounded-lg">
              <div className="text-sm text-gray-600">ì½ìŒ</div>
              <div className="text-2xl font-bold text-green-600">
                {readersData?.totalRead || 0}
              </div>
            </div>
            <div className="bg-purple-50 p-4 rounded-lg">
              <div className="text-sm text-gray-600">ì½ìŒë¥ </div>
              <div className="text-2xl font-bold text-purple-600">
                {readersData?.readRate || 0}%
              </div>
            </div>
          </div>
          
          {/* ì½ì€ ì‚¬ìš©ì ëª©ë¡ */}
          <div>
            <h3 className="font-semibold mb-2 text-green-700">
              ì½ì€ ì‚¬ìš©ì ({readersData?.readers.length || 0}ëª…)
            </h3>
            <div className="space-y-2">
              {readersData?.readers.map((reader: any) => (
                <div key={reader.userId} className="flex items-center justify-between p-2 bg-green-50 rounded">
                  <div>
                    <div className="font-medium">{reader.name || 'ì´ë¦„ ì—†ìŒ'}</div>
                    <div className="text-sm text-gray-600">{reader.phone}</div>
                  </div>
                  <div className="text-sm text-gray-500">
                    {new Date(reader.readAt).toLocaleString('ko-KR')}
                  </div>
                </div>
              ))}
            </div>
          </div>
          
          {/* ì½ì§€ ì•Šì€ ì‚¬ìš©ì ëª©ë¡ */}
          <div>
            <h3 className="font-semibold mb-2 text-red-700">
              ì½ì§€ ì•Šì€ ì‚¬ìš©ì ({readersData?.nonReaders.length || 0}ëª…)
            </h3>
            <div className="space-y-2">
              {readersData?.nonReaders.map((nonReader: any) => (
                <div key={nonReader.userId} className="flex items-center justify-between p-2 bg-red-50 rounded">
                  <div>
                    <div className="font-medium">{nonReader.name || 'ì´ë¦„ ì—†ìŒ'}</div>
                    <div className="text-sm text-gray-600">{nonReader.phone}</div>
                  </div>
                  <button
                    onClick={() => {
                      // ì¬ë°œì†¡ ê¸°ëŠ¥
                    }}
                    className="text-sm text-blue-600 hover:underline"
                  >
                    ì¬ë°œì†¡
                  </button>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}
    </div>
  );
};
```

---

## 3. ê³ ê¸‰ í•„í„°ë§ ê¸°ëŠ¥

### 3.1 í•„í„° UI ì¶”ê°€

**êµ¬í˜„ ìœ„ì¹˜:** `app/admin/team-dashboard-messages/page.tsx`

```typescript
interface FilterState {
  dateFrom: string;
  dateTo: string;
  adminId: number | null;
  readStatus: 'all' | 'read' | 'unread';
  searchQuery: string;
}

const [filters, setFilters] = useState<FilterState>({
  dateFrom: '',
  dateTo: '',
  adminId: null,
  readStatus: 'all',
  searchQuery: '',
});

const [admins, setAdmins] = useState<Array<{ id: number; name: string }>>([]);

// ê´€ë¦¬ì ëª©ë¡ ë¡œë“œ
useEffect(() => {
  fetch('/api/admin/users?role=admin')
    .then(res => res.json())
    .then(data => {
      if (data.ok) {
        setAdmins(data.users || []);
      }
    });
}, []);

// í•„í„° ì ìš©ëœ ë©”ì‹œì§€ ì¡°íšŒ
const fetchMessages = async () => {
  setLoading(true);
  try {
    const params = new URLSearchParams({
      messageType: 'team-dashboard',
      ...(filters.dateFrom && { dateFrom: filters.dateFrom }),
      ...(filters.dateTo && { dateTo: filters.dateTo }),
      ...(filters.adminId && { adminId: filters.adminId.toString() }),
      ...(filters.readStatus !== 'all' && { readStatus: filters.readStatus }),
    });
    
    const response = await fetch(`/api/admin/messages?${params.toString()}`, {
      credentials: 'include',
    });
    // ...
  } finally {
    setLoading(false);
  }
};
```

**í•„í„° UI ì»´í¬ë„ŒíŠ¸:**

```tsx
<div className="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4">
  <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
    {/* ë‚ ì§œ ë²”ìœ„ */}
    <div>
      <label className="block text-sm font-medium text-gray-700 mb-1">
        ì‹œì‘ì¼
      </label>
      <input
        type="date"
        value={filters.dateFrom}
        onChange={(e) => setFilters({ ...filters, dateFrom: e.target.value })}
        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
      />
    </div>
    <div>
      <label className="block text-sm font-medium text-gray-700 mb-1">
        ì¢…ë£Œì¼
      </label>
      <input
        type="date"
        value={filters.dateTo}
        onChange={(e) => setFilters({ ...filters, dateTo: e.target.value })}
        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
      />
    </div>
    
    {/* ë°œì‹ ì í•„í„° */}
    <div>
      <label className="block text-sm font-medium text-gray-700 mb-1">
        ë°œì‹ ì
      </label>
      <select
        value={filters.adminId || ''}
        onChange={(e) => setFilters({ ...filters, adminId: e.target.value ? parseInt(e.target.value) : null })}
        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
      >
        <option value="">ì „ì²´</option>
        {admins.map(admin => (
          <option key={admin.id} value={admin.id}>
            {admin.name}
          </option>
        ))}
      </select>
    </div>
    
    {/* ì½ìŒ ìƒíƒœ í•„í„° */}
    <div>
      <label className="block text-sm font-medium text-gray-700 mb-1">
        ì½ìŒ ìƒíƒœ
      </label>
      <select
        value={filters.readStatus}
        onChange={(e) => setFilters({ ...filters, readStatus: e.target.value as any })}
        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
      >
        <option value="all">ì „ì²´</option>
        <option value="read">ì½ìŒ</option>
        <option value="unread">ë¯¸ì½ìŒ</option>
      </select>
    </div>
  </div>
  
  {/* ê²€ìƒ‰ ë° í•„í„° ì´ˆê¸°í™” */}
  <div className="mt-4 flex gap-2">
    <div className="flex-1 relative">
      <FiSearch className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" />
      <input
        type="text"
        value={filters.searchQuery}
        onChange={(e) => setFilters({ ...filters, searchQuery: e.target.value })}
        placeholder="ì œëª©, ë‚´ìš©ìœ¼ë¡œ ê²€ìƒ‰..."
        className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"
      />
    </div>
    <button
      onClick={() => setFilters({
        dateFrom: '',
        dateTo: '',
        adminId: null,
        readStatus: 'all',
        searchQuery: '',
      })}
      className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
    >
      í•„í„° ì´ˆê¸°í™”
    </button>
  </div>
</div>
```

### 3.2 API ê°œì„ 

**`app/api/admin/messages/route.ts` ìˆ˜ì •:**

```typescript
export async function GET(req: NextRequest) {
  // ...
  const { searchParams } = new URL(req.url);
  const dateFrom = searchParams.get('dateFrom');
  const dateTo = searchParams.get('dateTo');
  const adminId = searchParams.get('adminId');
  const readStatus = searchParams.get('readStatus'); // 'read' | 'unread'
  
  const where: any = {
    messageType: 'team-dashboard',
  };
  
  // ë‚ ì§œ ë²”ìœ„ í•„í„°
  if (dateFrom || dateTo) {
    where.createdAt = {};
    if (dateFrom) {
      where.createdAt.gte = new Date(dateFrom);
    }
    if (dateTo) {
      const endDate = new Date(dateTo);
      endDate.setHours(23, 59, 59, 999);
      where.createdAt.lte = endDate;
    }
  }
  
  // ë°œì‹ ì í•„í„°
  if (adminId) {
    where.adminId = parseInt(adminId);
  }
  
  const messages = await prisma.adminMessage.findMany({
    where,
    include: {
      // ...
      UserMessageRead: {
        select: { userId: true }
      }
    },
    // ...
  });
  
  // ì½ìŒ ìƒíƒœ í•„í„° ì ìš© (í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œë„ ê°€ëŠ¥í•˜ì§€ë§Œ ì„œë²„ ì¸¡ì—ì„œ ì²˜ë¦¬)
  let filteredMessages = formattedMessages;
  if (readStatus === 'read') {
    filteredMessages = formattedMessages.filter(msg => msg.readCount > 0);
  } else if (readStatus === 'unread') {
    filteredMessages = formattedMessages.filter(msg => msg.readCount === 0);
  }
  
  // ê·¸ë£¹í™” ë¡œì§...
}
```

---

## 4. ê·¸ë£¹ ë©”ì‹œì§€ ì „ì²´ ë‹µì¥ ê¸°ëŠ¥

### 4.1 ë‹µì¥ ëª¨ë‹¬ ê°œì„ 

**êµ¬í˜„ ìœ„ì¹˜:** `app/admin/team-dashboard-messages/page.tsx`

```typescript
interface ReplyModalProps {
  message: TeamDashboardMessage;
  recipients: Array<{ id: number; name: string | null; phone: string | null }>;
  onClose: () => void;
}

const ReplyModal = ({ message, recipients, onClose }: ReplyModalProps) => {
  const [replyMode, setReplyMode] = useState<'single' | 'all' | 'select'>('all');
  const [selectedRecipients, setSelectedRecipients] = useState<Set<number>>(new Set());
  const [replyContent, setReplyContent] = useState('');
  
  const handleReply = async () => {
    let targetUserIds: number[] = [];
    
    if (replyMode === 'all') {
      // ëª¨ë“  ìˆ˜ì‹ ìì—ê²Œ ë‹µì¥
      targetUserIds = recipients.map(r => r.id);
    } else if (replyMode === 'select') {
      // ì„ íƒí•œ ìˆ˜ì‹ ìì—ê²Œë§Œ ë‹µì¥
      targetUserIds = Array.from(selectedRecipients);
    } else {
      // ì›ë˜ ë°œì‹ ìì—ê²Œë§Œ ë‹µì¥ (ê¸°ì¡´ ë¡œì§)
      targetUserIds = [message.admin.id];
    }
    
    if (targetUserIds.length === 0) {
      showWarning('ìˆ˜ì‹ ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
      return;
    }
    
    // ë‹µì¥ ë°œì†¡
    const response = await fetch('/api/admin/marketing/customers/send-team-dashboard', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({
        userIds: targetUserIds,
        title: `Re: ${message.title}`,
        content: replyContent,
      }),
    });
    // ...
  };
  
  return (
    <div className="bg-white rounded-lg p-6 max-w-2xl w-full">
      {/* ë‹µì¥ ëª¨ë“œ ì„ íƒ */}
      <div className="mb-4">
        <label className="block text-sm font-medium text-gray-700 mb-2">
          ë‹µì¥ ëŒ€ìƒ
        </label>
        <div className="space-y-2">
          <label className="flex items-center">
            <input
              type="radio"
              value="all"
              checked={replyMode === 'all'}
              onChange={() => setReplyMode('all')}
              className="mr-2"
            />
            <span>ëª¨ë“  ìˆ˜ì‹ ìì—ê²Œ ë‹µì¥ ({recipients.length}ëª…)</span>
          </label>
          <label className="flex items-center">
            <input
              type="radio"
              value="select"
              checked={replyMode === 'select'}
              onChange={() => setReplyMode('select')}
              className="mr-2"
            />
            <span>ì„ íƒí•œ ìˆ˜ì‹ ìì—ê²Œ ë‹µì¥</span>
          </label>
          <label className="flex items-center">
            <input
              type="radio"
              value="single"
              checked={replyMode === 'single'}
              onChange={() => setReplyMode('single')}
              className="mr-2"
            />
            <span>ì›ë˜ ë°œì‹ ìì—ê²Œë§Œ ë‹µì¥</span>
          </label>
        </div>
      </div>
      
      {/* ìˆ˜ì‹ ì ì„ íƒ (select ëª¨ë“œì¼ ë•Œ) */}
      {replyMode === 'select' && (
        <div className="mb-4 max-h-48 overflow-y-auto border rounded-lg p-2">
          {recipients.map(recipient => (
            <label key={recipient.id} className="flex items-center p-2 hover:bg-gray-50">
              <input
                type="checkbox"
                checked={selectedRecipients.has(recipient.id)}
                onChange={(e) => {
                  const newSet = new Set(selectedRecipients);
                  if (e.target.checked) {
                    newSet.add(recipient.id);
                  } else {
                    newSet.delete(recipient.id);
                  }
                  setSelectedRecipients(newSet);
                }}
                className="mr-2"
              />
              <span>{recipient.name || recipient.phone || 'ì•Œ ìˆ˜ ì—†ìŒ'}</span>
            </label>
          ))}
        </div>
      )}
      
      {/* ë‹µì¥ ë‚´ìš© ì…ë ¥ */}
      <div className="mb-4">
        <label className="block text-sm font-medium text-gray-700 mb-1">
          ë‹µì¥ ë‚´ìš©
        </label>
        <textarea
          value={replyContent}
          onChange={(e) => setReplyContent(e.target.value)}
          className="w-full px-3 py-2 border border-gray-300 rounded-lg"
          rows={5}
          placeholder="ë‹µì¥ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."
        />
      </div>
      
      {/* ë°œì†¡ ë²„íŠ¼ */}
      <div className="flex gap-2">
        <button
          onClick={onClose}
          className="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300"
        >
          ì·¨ì†Œ
        </button>
        <button
          onClick={handleReply}
          disabled={!replyContent.trim() || (replyMode === 'select' && selectedRecipients.size === 0)}
          className="flex-1 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50"
        >
          ë‹µì¥ ë³´ë‚´ê¸° ({replyMode === 'all' ? recipients.length : replyMode === 'select' ? selectedRecipients.size : 1}ëª…)
        </button>
      </div>
    </div>
  );
};
```

**ë©”ì‹œì§€ ìƒì„¸ ëª¨ë‹¬ì—ì„œ recipients ì •ë³´ ì „ë‹¬:**

```typescript
// API ì‘ë‹µì—ì„œ recipients ì •ë³´ ê°€ì ¸ì˜¤ê¸°
const [messageDetail, setMessageDetail] = useState<any>(null);

const loadMessageDetail = async (messageId: number) => {
  const response = await fetch(`/api/admin/messages/${messageId}/readers`);
  const data = await response.json();
  if (data.ok) {
    setMessageDetail({
      ...selectedMessage,
      recipients: [
        ...data.readers.map((r: any) => ({ id: r.userId, name: r.name, phone: r.phone })),
        ...data.nonReaders.map((r: any) => ({ id: r.userId, name: r.name, phone: r.phone })),
      ]
    });
  }
};
```

---

## 5. í†µê³„ ëŒ€ì‹œë³´ë“œ

### 5.1 í†µê³„ API ìƒì„±

**ìƒˆ ì—”ë“œí¬ì¸íŠ¸:** `app/api/admin/messages/statistics/route.ts`

```typescript
export async function GET(req: NextRequest) {
  const admin = await checkAdminAuth();
  if (!admin) {
    return NextResponse.json({ ok: false, error: 'ì¸ì¦ í•„ìš”' }, { status: 403 });
  }
  
  const { searchParams } = new URL(req.url);
  const dateFrom = searchParams.get('dateFrom');
  const dateTo = searchParams.get('dateTo');
  
  const where: any = {
    messageType: 'team-dashboard',
  };
  
  if (dateFrom || dateTo) {
    where.createdAt = {};
    if (dateFrom) where.createdAt.gte = new Date(dateFrom);
    if (dateTo) {
      const endDate = new Date(dateTo);
      endDate.setHours(23, 59, 59, 999);
      where.createdAt.lte = endDate;
    }
  }
  
  // ì „ì²´ ë©”ì‹œì§€ í†µê³„
  const allMessages = await prisma.adminMessage.findMany({
    where,
    include: {
      UserMessageRead: true,
      User_AdminMessage_adminIdToUser: {
        select: { id: true, name: true }
      }
    }
  });
  
  // ê·¸ë£¹í™”í•˜ì—¬ í†µê³„ ê³„ì‚°
  const groupedMessages = new Map();
  allMessages.forEach(msg => {
    const key = `${msg.title}|${msg.content}|${msg.adminId}|${msg.createdAt.toISOString().slice(0, 16)}`;
    if (!groupedMessages.has(key)) {
      groupedMessages.set(key, {
        title: msg.title,
        content: msg.content,
        admin: msg.User_AdminMessage_adminIdToUser,
        createdAt: msg.createdAt,
        totalSent: 0,
        totalRead: 0,
        messageIds: [],
      });
    }
    const group = groupedMessages.get(key);
    group.totalSent += 1;
    group.totalRead += msg.UserMessageRead.length;
    group.messageIds.push(msg.id);
  });
  
  const groups = Array.from(groupedMessages.values());
  
  // ì „ì²´ í†µê³„
  const totalSent = allMessages.length;
  const totalRead = allMessages.reduce((sum, msg) => sum + msg.UserMessageRead.length, 0);
  const readRate = totalSent > 0 ? (totalRead / totalSent * 100).toFixed(1) : '0';
  
  // ì¼ë³„ í†µê³„
  const dailyStats = new Map();
  allMessages.forEach(msg => {
    const date = msg.createdAt.toISOString().split('T')[0];
    if (!dailyStats.has(date)) {
      dailyStats.set(date, { sent: 0, read: 0 });
    }
    const stat = dailyStats.get(date);
    stat.sent += 1;
    stat.read += msg.UserMessageRead.length;
  });
  
  // ë°œì‹ ìë³„ í†µê³„
  const adminStats = new Map();
  allMessages.forEach(msg => {
    const adminId = msg.adminId;
    if (!adminStats.has(adminId)) {
      adminStats.set(adminId, {
        admin: msg.User_AdminMessage_adminIdToUser,
        sent: 0,
        read: 0,
      });
    }
    const stat = adminStats.get(adminId);
    stat.sent += 1;
    stat.read += msg.UserMessageRead.length;
  });
  
  return NextResponse.json({
    ok: true,
    summary: {
      totalSent,
      totalRead,
      readRate: parseFloat(readRate),
      totalGroups: groups.length,
    },
    dailyStats: Array.from(dailyStats.entries()).map(([date, stat]) => ({
      date,
      sent: stat.sent,
      read: stat.read,
      readRate: stat.sent > 0 ? (stat.read / stat.sent * 100).toFixed(1) : '0',
    })),
    adminStats: Array.from(adminStats.values()).map(stat => ({
      admin: stat.admin,
      sent: stat.sent,
      read: stat.read,
      readRate: stat.sent > 0 ? (stat.read / stat.sent * 100).toFixed(1) : '0',
    })),
    topMessages: groups
      .sort((a, b) => b.totalSent - a.totalSent)
      .slice(0, 10)
      .map(group => ({
        title: group.title,
        admin: group.admin,
        totalSent: group.totalSent,
        totalRead: group.totalRead,
        readRate: group.totalSent > 0 ? (group.totalRead / group.totalSent * 100).toFixed(1) : '0',
        createdAt: group.createdAt,
      })),
  });
}
```

### 5.2 í†µê³„ ëŒ€ì‹œë³´ë“œ UI

**êµ¬í˜„ ìœ„ì¹˜:** `app/admin/team-dashboard-messages/page.tsx`

```tsx
const [statistics, setStatistics] = useState<any>(null);
const [showStatistics, setShowStatistics] = useState(false);
const [statsDateRange, setStatsDateRange] = useState({
  from: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
  to: new Date().toISOString().split('T')[0],
});

const loadStatistics = async () => {
  try {
    const params = new URLSearchParams({
      dateFrom: statsDateRange.from,
      dateTo: statsDateRange.to,
    });
    const response = await fetch(`/api/admin/messages/statistics?${params.toString()}`, {
      credentials: 'include',
    });
    const data = await response.json();
    if (data.ok) {
      setStatistics(data);
    }
  } catch (error) {
    console.error('Failed to load statistics:', error);
  }
};

// í†µê³„ íŒ¨ë„
{showStatistics && statistics && (
  <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-4">
    <div className="flex items-center justify-between mb-4">
      <h2 className="text-xl font-bold">í†µê³„ ëŒ€ì‹œë³´ë“œ</h2>
      <div className="flex gap-2">
        <input
          type="date"
          value={statsDateRange.from}
          onChange={(e) => setStatsDateRange({ ...statsDateRange, from: e.target.value })}
          className="px-3 py-2 border rounded-lg"
        />
        <span className="self-center">~</span>
        <input
          type="date"
          value={statsDateRange.to}
          onChange={(e) => setStatsDateRange({ ...statsDateRange, to: e.target.value })}
          className="px-3 py-2 border rounded-lg"
        />
        <button
          onClick={loadStatistics}
          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
        >
          ì¡°íšŒ
        </button>
        <button
          onClick={() => setShowStatistics(false)}
          className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
        >
          ë‹«ê¸°
        </button>
      </div>
    </div>
    
    {/* ìš”ì•½ í†µê³„ */}
    <div className="grid grid-cols-4 gap-4 mb-6">
      <div className="bg-blue-50 p-4 rounded-lg">
        <div className="text-sm text-gray-600">ì´ ë°œì†¡</div>
        <div className="text-2xl font-bold text-blue-600">
          {statistics.summary.totalSent.toLocaleString()}
        </div>
      </div>
      <div className="bg-green-50 p-4 rounded-lg">
        <div className="text-sm text-gray-600">ì´ ì½ìŒ</div>
        <div className="text-2xl font-bold text-green-600">
          {statistics.summary.totalRead.toLocaleString()}
        </div>
      </div>
      <div className="bg-purple-50 p-4 rounded-lg">
        <div className="text-sm text-gray-600">í‰ê·  ì½ìŒë¥ </div>
        <div className="text-2xl font-bold text-purple-600">
          {statistics.summary.readRate}%
        </div>
      </div>
      <div className="bg-orange-50 p-4 rounded-lg">
        <div className="text-sm text-gray-600">ë©”ì‹œì§€ ê·¸ë£¹</div>
        <div className="text-2xl font-bold text-orange-600">
          {statistics.summary.totalGroups}
        </div>
      </div>
    </div>
    
    {/* ì¼ë³„ í†µê³„ ì°¨íŠ¸ */}
    <div className="mb-6">
      <h3 className="font-semibold mb-2">ì¼ë³„ ë°œì†¡/ì½ìŒ ì¶”ì´</h3>
      <div className="h-64 flex items-end gap-2">
        {statistics.dailyStats.map((stat: any) => (
          <div key={stat.date} className="flex-1 flex flex-col items-center">
            <div className="w-full flex flex-col justify-end h-full">
              <div
                className="bg-blue-500 w-full mb-1"
                style={{ height: `${(stat.sent / Math.max(...statistics.dailyStats.map((s: any) => s.sent)) * 100)}%` }}
                title={`ë°œì†¡: ${stat.sent}`}
              />
              <div
                className="bg-green-500 w-full"
                style={{ height: `${(stat.read / Math.max(...statistics.dailyStats.map((s: any) => s.read)) * 100)}%` }}
                title={`ì½ìŒ: ${stat.read}`}
              />
            </div>
            <div className="text-xs text-gray-600 mt-1">
              {new Date(stat.date).toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' })}
            </div>
          </div>
        ))}
      </div>
    </div>
    
    {/* ë°œì‹ ìë³„ í†µê³„ */}
    <div className="mb-6">
      <h3 className="font-semibold mb-2">ë°œì‹ ìë³„ í†µê³„</h3>
      <div className="space-y-2">
        {statistics.adminStats.map((stat: any) => (
          <div key={stat.admin.id} className="flex items-center justify-between p-3 bg-gray-50 rounded">
            <div className="font-medium">{stat.admin.name}</div>
            <div className="flex gap-4 text-sm">
              <span>ë°œì†¡: {stat.sent}</span>
              <span>ì½ìŒ: {stat.read}</span>
              <span className="font-semibold">ì½ìŒë¥ : {stat.readRate}%</span>
            </div>
          </div>
        ))}
      </div>
    </div>
    
    {/* ì¸ê¸° ë©”ì‹œì§€ TOP 10 */}
    <div>
      <h3 className="font-semibold mb-2">ì¸ê¸° ë©”ì‹œì§€ TOP 10</h3>
      <div className="space-y-2">
        {statistics.topMessages.map((msg: any, index: number) => (
          <div key={index} className="flex items-start justify-between p-3 bg-gray-50 rounded">
            <div className="flex-1">
              <div className="font-medium">{msg.title}</div>
              <div className="text-sm text-gray-600">{msg.admin.name}</div>
            </div>
            <div className="flex gap-4 text-sm">
              <span>ë°œì†¡: {msg.totalSent}</span>
              <span>ì½ìŒ: {msg.totalRead}</span>
              <span className="font-semibold">ì½ìŒë¥ : {msg.readRate}%</span>
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>
)}
```

**í†µê³„ ë²„íŠ¼ ì¶”ê°€:**

```tsx
<div className="flex items-center justify-between">
  <div>
    <h1 className="text-2xl font-bold">íŒ€ ëŒ€ì‹œë³´ë“œ ë©”ì‹œì§€í•¨</h1>
    <p className="text-teal-100 mt-1">íŒ€ ëŒ€ì‹œë³´ë“œì— ì—°ê²°ëœ ë©”ì‹œì§€ë“¤ì„ í™•ì¸í•˜ê³  ë‹µì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
  </div>
  <button
    onClick={() => {
      setShowStatistics(!showStatistics);
      if (!showStatistics && !statistics) {
        loadStatistics();
      }
    }}
    className="px-4 py-2 bg-white text-teal-600 rounded-lg hover:bg-teal-50 font-medium"
  >
    {showStatistics ? 'í†µê³„ ìˆ¨ê¸°ê¸°' : 'í†µê³„ ë³´ê¸°'}
  </button>
</div>
```

---

## 6. êµ¬í˜„ ìˆœì„œ ë° ìš°ì„ ìˆœìœ„

### Phase 1: í•µì‹¬ ê¸°ëŠ¥ (1-2ì¼)
1. âœ… ë©”ì‹œì§€ íƒ€ì… êµ¬ë¶„ (AdminMessageModal)
2. âœ… ì½ìŒ ìƒíƒœ ìƒì„¸ ì •ë³´ API ë° UI
3. âœ… ê¸°ë³¸ í•„í„°ë§ (ë‚ ì§œ ë²”ìœ„, ë°œì‹ ì)

### Phase 2: ê³ ê¸‰ ê¸°ëŠ¥ (2-3ì¼)
4. âœ… ê·¸ë£¹ ë©”ì‹œì§€ ì „ì²´ ë‹µì¥
5. âœ… ì½ìŒ ìƒíƒœ í•„í„°
6. âœ… í†µê³„ ëŒ€ì‹œë³´ë“œ ê¸°ë³¸

### Phase 3: ìµœì í™” (1ì¼)
7. âœ… í†µê³„ ì°¨íŠ¸ ê°œì„ 
8. âœ… ì„±ëŠ¥ ìµœì í™”
9. âœ… UI/UX ê°œì„ 

---

## 7. ë°ì´í„°ë² ì´ìŠ¤ ë³€ê²½ì‚¬í•­

**í•„ìš”í•œ ë³€ê²½ì‚¬í•­ ì—†ìŒ** - ê¸°ì¡´ ìŠ¤í‚¤ë§ˆë¡œ ëª¨ë“  ê¸°ëŠ¥ êµ¬í˜„ ê°€ëŠ¥

ê¸°ì¡´ í…Œì´ë¸”:
- `AdminMessage`: ë©”ì‹œì§€ ì •ë³´
- `UserMessageRead`: ì½ìŒ ìƒíƒœ
- `User`: ì‚¬ìš©ì ì •ë³´

---

## 8. í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] íŒ€ ëŒ€ì‹œë³´ë“œ ë©”ì‹œì§€ê°€ ì‚¬ìš©ì ì•±ì—ì„œ í‹¸ ìƒ‰ìƒìœ¼ë¡œ í‘œì‹œë˜ëŠ”ê°€?
- [ ] ì½ìŒ ìƒíƒœ ìƒì„¸ ì •ë³´ê°€ ì •í™•íˆ í‘œì‹œë˜ëŠ”ê°€?
- [ ] í•„í„°ë§ì´ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•˜ëŠ”ê°€?
- [ ] ê·¸ë£¹ ë©”ì‹œì§€ ì „ì²´ ë‹µì¥ì´ ì •ìƒ ì‘ë™í•˜ëŠ”ê°€?
- [ ] í†µê³„ ë°ì´í„°ê°€ ì •í™•íˆ ê³„ì‚°ë˜ëŠ”ê°€?
- [ ] ì„±ëŠ¥ì´ ì–‘í˜¸í•œê°€? (1000ê°œ ì´ìƒ ë©”ì‹œì§€)

---

## 9. ì˜ˆìƒ íš¨ê³¼

1. **ì‚¬ìš©ì ê²½í—˜ ê°œì„ **: ë©”ì‹œì§€ íƒ€ì… êµ¬ë¶„ìœ¼ë¡œ ì¤‘ìš”ë„ ì¸ì§€ í–¥ìƒ
2. **ê´€ë¦¬ íš¨ìœ¨ì„± í–¥ìƒ**: í•„í„°ë§ ë° í†µê³„ë¡œ ë©”ì‹œì§€ ê´€ë¦¬ ì‹œê°„ 50% ë‹¨ì¶•
3. **ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ê°œì„ **: ì „ì²´ ë‹µì¥ ê¸°ëŠ¥ìœ¼ë¡œ ì‘ë‹µë¥  í–¥ìƒ
4. **ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì •**: í†µê³„ë¡œ íš¨ê³¼ì ì¸ ë©”ì‹œì§€ ì „ëµ ìˆ˜ë¦½ ê°€ëŠ¥

