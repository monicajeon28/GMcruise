# 정액제 판매원 시스템 테스트 가이드

## 📋 목차
1. [관리자 패널 접근](#1-관리자-패널-접근)
2. [테스트 계정 생성](#2-테스트-계정-생성)
3. [무료 체험 기능 테스트](#3-무료-체험-기능-테스트)
4. [정액제 구독 기능 테스트](#4-정액제-구독-기능-테스트)
5. [삭제 기능 테스트](#5-삭제-기능-테스트)
6. [대리점장 패널 테스트](#6-대리점장-패널-테스트)

---

## 1. 관리자 패널 접근

### 접근 경로
```
/admin/subscription
```

### 확인 사항
- ✅ "정액제 판매원 관리" 페이지가 표시됨
- ✅ 통계 카드 (활성, 만료, 대기, 체험 중) 표시
- ✅ "전체 DB 백업" 버튼 표시
- ✅ "새 정액제 판매원 등록" 버튼 표시
- ✅ "테스트 계정 생성" 버튼 표시

---

## 2. 테스트 계정 생성

### 단계
1. 관리자 패널 → "테스트 계정 생성 (gest1, gest2, ...)" 버튼 클릭
2. 생성할 계정 수 입력 (예: 1)
3. 확인

### 생성되는 계정 정보
- **아이디**: gest1, gest2, gest3... (자동 증가)
- **비밀번호**: zxc1 (모든 테스트 계정 동일)
- **상태**: 무료 체험 중 (7일)
- **기능**: 30% 기능만 사용 가능

### 확인 사항
- ✅ 알림창에 계정 정보 표시
- ✅ 목록에 새 계정 추가됨
- ✅ 상태가 "체험 중"으로 표시됨

---

## 3. 무료 체험 기능 테스트

### 3-1. 테스트 계정으로 로그인

#### 접근 경로
```
로그인 페이지 → gest1 / zxc1
```

#### 확인 사항
- ✅ 로그인 성공
- ✅ 대시보드 상단에 "🎁 무료 체험 중 (30% 기능) (X일 남음)" 배지 표시
- ✅ "튜토리얼 보기" 버튼 표시

### 3-2. 튜토리얼 확인

#### 단계
1. "튜토리얼 보기" 버튼 클릭
2. 튜토리얼 모달 확인

#### 확인 사항
- ✅ 무료 체험 튜토리얼 모달 표시
- ✅ 사용 가능한 기능 목록 표시:
  - 링크 생성
  - 판매 확정
  - 기본 대시보드 조회
  - 리드 조회
- ✅ 남은 일수 표시

### 3-3. 사용 가능한 기능 확인 (빨간 테두리)

#### 확인할 기능 버튼
1. **링크 관리** 버튼
   - ✅ 빨간 테두리 표시 (`ring-4 ring-red-500`)
   - ✅ 클릭 시 정상 작동

2. **고객 관리** 버튼
   - ✅ 빨간 테두리 표시
   - ✅ 클릭 시 정상 작동

### 3-4. 사용 불가능한 기능 확인

#### 확인할 기능 버튼
1. **팀 관리** 버튼 (대리점장 전용)
   - ✅ 빨간 테두리 없음
   - ✅ 클릭 시 메시지: "대리점장님 기능입니다. 정액제는 쓸 수 없어요 ㅠㅠ 담당 점장님과 상의 해 주세요"

2. **계약서 보내기** 버튼 (대리점장 전용)
   - ✅ 빨간 테두리 없음
   - ✅ 클릭 시 메시지: "대리점장님 기능입니다. 정액제는 쓸 수 없어요 ㅠㅠ 담당 점장님과 상의 해 주세요"

3. **기본 통계** 버튼 (정액제 70% 기능)
   - ✅ 빨간 테두리 없음
   - ✅ 클릭 시 메시지: "지금은 무료 사용 중이십니다. 다른 기능은 사용할 수 없어요 ㅠㅠ"

---

## 4. 정액제 구독 기능 테스트

### 4-1. 무료 체험 종료 후 정액제 전환

#### 방법 1: 관리자 패널에서 수동 전환
1. 관리자 패널 → 정액제 판매원 관리
2. 해당 계정의 "무료 1개월 연장" 버튼 클릭 (또는 계약서 상태를 'completed'로 변경)

#### 방법 2: 계약서 완료 처리
1. 관리자 패널 → 어필리에이트 → 계약서
2. 해당 계약서 찾기
3. 상태를 'completed'로 변경

### 4-2. 정액제 구독 중 확인

#### 확인 사항
- ✅ 대시보드 상단에 "✅ 정식 구독 중 (70% 기능) (X일 남음)" 배지 표시
- ✅ 사용 가능한 기능 증가:
  - 링크 생성 ✅
  - 판매 확정 ✅
  - 기본 대시보드 조회 ✅
  - 리드 조회 ✅
  - **기본 통계** ✅ (새로 추가)
  - **고객 관리** ✅ (새로 추가)
  - **판매 관리** ✅ (새로 추가)

---

## 5. 삭제 기능 테스트

### 5-1. 무료 체험 중 삭제 (데이터 5% 미만)

#### 전제 조건
- 무료 체험 중인 계정
- 데이터가 2개 미만 (고객 + 판매 + 링크 합계)

#### 단계
1. 관리자 패널 → 정액제 판매원 관리
2. 무료 체험 중인 계정 찾기
3. 삭제 버튼 (🗑️) 클릭
4. 확인 메시지 확인:
   ```
   무료 체험 중인 계정입니다.
   
   데이터 사용량: X개 (5% 미만)
   - 고객: X건
   - 판매: X건
   - 링크: X건
   
   삭제하시겠습니까?
   ```
5. 확인 클릭

#### 확인 사항
- ✅ 삭제 성공 메시지 표시
- ✅ 목록에서 계정 제거됨

### 5-2. 무료 체험 중 삭제 불가 (데이터 5% 이상)

#### 전제 조건
- 무료 체험 중인 계정
- 데이터가 2개 이상

#### 단계
1. 관리자 패널 → 정액제 판매원 관리
2. 무료 체험 중인 계정 찾기
3. 삭제 버튼 클릭

#### 확인 사항
- ✅ 에러 메시지 표시:
   ```
   데이터가 X개로 5% 이상(2개 이상)이므로 삭제할 수 없습니다.
   
   - 고객: X건
   - 판매: X건
   - 링크: X건
   ```
- ✅ 계정이 삭제되지 않음

### 5-3. 정식 구독 중 삭제 (DB 없음)

#### 전제 조건
- 정식 구독 중인 계정
- DB 없음 (고객 데이터 0건, 판매 데이터 0건)

#### 단계
1. 관리자 패널 → 정액제 판매원 관리
2. 정식 구독 중인 계정 찾기
3. 삭제 버튼 클릭
4. 확인 메시지 확인
5. 확인 클릭

#### 확인 사항
- ✅ 삭제 성공 메시지 표시
- ✅ 목록에서 계정 제거됨

### 5-4. 정식 구독 중 삭제 불가 (DB 있음)

#### 전제 조건
- 정식 구독 중인 계정
- DB 있음 (고객 데이터 또는 판매 데이터 존재)

#### 단계
1. 관리자 패널 → 정액제 판매원 관리
2. 정식 구독 중인 계정 찾기
3. 삭제 버튼 클릭

#### 확인 사항
- ✅ 에러 메시지 표시:
   ```
   DB가 있어서 삭제할 수 없습니다.
   
   고객 데이터: X건
   판매 데이터: X건
   
   먼저 DB를 백업한 후 삭제하세요.
   ```
- ✅ 계정이 삭제되지 않음

---

## 6. 대리점장 패널 테스트

### 6-1. 대리점장으로 로그인

#### 접근 경로
```
로그인 페이지 → 대리점장 계정
```

### 6-2. 정액제 판매원 관리

#### 접근 경로
```
/partner/[partnerId]/team
```

#### 확인 사항
- ✅ "정액제 판매원 관리" 섹션 표시
- ✅ "새 정액제 판매원 생성" 버튼 표시
- ✅ "팀 전체 DB 백업" 버튼 표시
- ✅ 자신의 팀 판매원 목록 표시

### 6-3. 정액제 판매원 생성

#### 단계
1. "새 정액제 판매원 생성" 버튼 클릭
2. 이름, 연락처 입력
3. 생성하기 클릭

#### 확인 사항
- ✅ 생성 성공 메시지 표시
- ✅ 목록에 새 계정 추가됨

### 6-4. 무료 체험 시작

#### 단계
1. 대기 상태인 정액제 판매원 찾기
2. "무료 체험 시작" 버튼 (🕐) 클릭
3. 확인

#### 확인 사항
- ✅ 성공 메시지 표시
- ✅ 상태가 "체험 중"으로 변경됨

### 6-5. 링크 사용자 변경

#### 단계
1. 정액제 판매원 목록에서 "이름/연락처 수정" 버튼 (✏️) 클릭
2. 이름과 연락처 수정
3. 변경하기 클릭

#### 확인 사항
- ✅ 변경 성공 메시지 표시
- ✅ 목록에 변경된 정보 반영됨

---

## 7. 무료 체험 삭제 기준 명확화

### 데이터 기준
무료 체험 중 삭제 가능 여부는 다음 데이터의 합계로 판단합니다:
- **고객 데이터 (AffiliateLead)**: 리드 수
- **판매 데이터 (AffiliateSale)**: 판매 건수
- **링크 데이터 (AffiliateLink)**: 생성된 링크 수

### 삭제 기준
- **5% 미만 (2개 미만)**: 삭제 가능
- **5% 이상 (2개 이상)**: 삭제 불가

### 예시
- 고객 0개 + 판매 0개 + 링크 0개 = **0개** → 삭제 가능 ✅
- 고객 1개 + 판매 0개 + 링크 0개 = **1개** → 삭제 가능 ✅
- 고객 1개 + 판매 1개 + 링크 0개 = **2개** → 삭제 불가 ❌
- 고객 5개 + 판매 3개 + 링크 2개 = **10개** → 삭제 불가 ❌

---

## 8. 자동 삭제 및 백업

### 자동 삭제
- 무료 체험 종료 후 재구매하지 않은 계정은 자동으로 삭제됩니다
- 삭제 전에 자동으로 백업이 수행됩니다
- 관리자 패널에서 수동 실행 가능: `/api/admin/subscription/auto-delete-expired-trials`

### 자동 백업
- 데이터 입력 시마다 자동으로 백업됩니다
- 백업 데이터는 관리자 패널과 대리점장 패널에서 확인 가능합니다
- 백업 API: `/api/admin/subscription/auto-backup`

---

## 9. 주요 기능 체크리스트

### ✅ 구현 완료된 기능

- [x] 가격: 10만원 (1개월)
- [x] 무료 체험: 7일 (30% 기능)
- [x] 정액제 구독: 1개월 (70% 기능)
- [x] 튜토리얼 모달
- [x] 남은 시간 표시 (일수)
- [x] 사용 가능한 기능 빨간 테두리 표시
- [x] 기능 제한 메시지 (대리점장/판매원/무료체험 구분)
- [x] 테스트 계정 생성 (gest1, gest2, ...)
- [x] 무료 체험 중 삭제 (데이터 5% 미만)
- [x] 정식 구독 중 삭제 (DB 없을 때만)
- [x] DB 백업 기능
- [x] 링크 사용자 변경
- [x] 무료 1개월 연장

---

## 8. 테스트 시나리오

### 시나리오 1: 신규 사용자 무료 체험
1. 테스트 계정 생성 (gest1)
2. gest1으로 로그인
3. 튜토리얼 확인
4. 사용 가능한 기능 테스트 (링크 생성, 고객 관리)
5. 사용 불가능한 기능 테스트 (팀 관리, 계약서 보내기)
6. 데이터 생성 (고객 1명, 링크 1개)
7. 삭제 시도 → 실패 (데이터 2개 이상)
8. 데이터 삭제 후 다시 삭제 시도 → 성공

### 시나리오 2: 정액제 구독 전환
1. 무료 체험 중인 계정
2. 관리자 패널에서 계약서 완료 처리
3. 계정으로 다시 로그인
4. 정식 구독 배지 확인
5. 추가 기능 사용 가능 확인 (기본 통계, 고객 관리, 판매 관리)

### 시나리오 3: 대리점장 관리
1. 대리점장으로 로그인
2. 정액제 판매원 생성
3. 무료 체험 시작
4. 링크 사용자 변경
5. 팀 전체 DB 백업

---

## 9. 주의사항

1. **데이터 5% 기준**: 최소 기준 데이터 35개의 5% = 약 2개
   - 고객 + 판매 + 링크 합계가 2개 미만이면 삭제 가능
   - 2개 이상이면 삭제 불가

2. **정식 구독 중 삭제**: DB가 있으면 절대 삭제 불가
   - 먼저 DB 백업 필수
   - 백업 후에도 삭제는 권장하지 않음

3. **테스트 계정**: gest1, gest2, gest3... 순서로 자동 생성
   - 비밀번호는 모두 zxc1
   - 자동으로 7일 무료 체험 시작

---

## 10. 문제 해결

### 문제: 삭제 버튼이 작동하지 않음
- **해결**: 브라우저 콘솔에서 에러 확인
- **확인**: API 엔드포인트가 정상 작동하는지 확인

### 문제: 빨간 테두리가 표시되지 않음
- **해결**: 구독 정보가 정상적으로 로드되는지 확인
- **확인**: `/api/partner/subscription/check` API 응답 확인

### 문제: 튜토리얼이 표시되지 않음
- **해결**: localStorage에서 'subscription-tutorial-shown' 키 삭제
- **확인**: 브라우저 개발자 도구 → Application → Local Storage

---

## 완료! 🎉

모든 기능이 정상적으로 작동하는지 위의 체크리스트를 따라 테스트해보세요.


