# 정액제 셀프 서비스 모델 구현 계획

## 📋 개요

기존의 관리자 개별 계약서 발송 방식에서 **셀프 서비스 자동화 방식**으로 전환합니다.

## 🎯 새로운 운영 방식

### 1. 공용 무료 체험 계정 (1개월)

**특징:**
- 고정으로 1개 계정만 운영
- 아이디/비밀번호 없이 **휴대폰 번호로만 로그인**
- 누구나 자기 핸드폰 번호로 로그인하면 1개월 무료 체험 자동 시작
- 무료 체험 기간: 30일 (1개월)

**구현:**
- 특별한 공용 계정 ID: `trial_subscription` (또는 고정 값)
- 휴대폰 번호만으로 인증
- 각 휴대폰 번호별로 무료 체험 시작일 추적

### 2. 정액제 구독 프로세스

**플로우:**
1. 사용자가 무료 체험 중 "정액제 구독하기" 버튼 클릭
2. **이름, 연락처 입력 폼** 표시
3. 결제 진행 (PayApp)
4. 결제 완료 후:
   - 계약서 자동 생성
   - 서명 페이지로 리다이렉트
   - 서명 완료 후:
     - 개인 아이디 자동 생성 (예: `gest1`, `gest2`, ...)
     - 비밀번호 자동 생성 (또는 사용자 설정)
     - 계정 활성화 및 정식 구독 시작

## 🔄 사용자 여정 (User Journey)

```
1. 사용자 접속
   ↓
2. 휴대폰 번호 입력 (공용 무료 체험 로그인)
   ↓
3. 1개월 무료 체험 시작 (30일)
   ↓
4. 무료 체험 중 기능 사용 (30% 기능)
   ↓
5. "정액제 구독하기" 버튼 클릭
   ↓
6. 이름, 연락처 입력
   ↓
7. 결제 진행 (10만원)
   ↓
8. 결제 완료
   ↓
9. 계약서 자동 생성 및 표시
   ↓
10. 서명 페이지로 이동
    ↓
11. 서명 완료
    ↓
12. 개인 아이디/비밀번호 자동 생성
    ↓
13. 정식 구독 시작 (50% 기능)
```

## 💻 구현 세부 사항

### 1. 공용 무료 체험 로그인

**파일:** `app/partner/PartnerLogin.tsx`

```typescript
// 새로운 모드: 'trial' 추가
// 휴대폰 번호만 입력하면 자동으로 무료 체험 시작
```

**API:** `app/api/auth/login/route.ts`

```typescript
// mode === 'trial' 인 경우:
// 1. 휴대폰 번호로 기존 계정 확인
// 2. 없으면 공용 무료 체험 계정으로 자동 생성
// 3. AffiliateContract 자동 생성 (isTrial: true, 30일)
```

### 2. 결제 후 자동 계약서 생성

**파일:** `app/api/payapp/feedback/route.ts`

```typescript
// 결제 완료 시:
// 1. 이름, 연락처 정보 확인
// 2. AffiliateContract 생성 (SUBSCRIPTION_AGENT)
// 3. 계약서 서명 페이지로 리다이렉트
```

### 3. 서명 완료 후 아이디/비밀번호 생성

**파일:** `app/api/affiliate/contracts/[contractId]/complete/route.ts`

```typescript
// 서명 완료 시:
// 1. 다음 gest 아이디 생성 (gest1, gest2, ...)
// 2. 비밀번호 생성 (랜덤 또는 사용자 설정)
// 3. User 계정 생성
// 4. AffiliateProfile 생성
// 5. 정식 구독 시작
```

## 📝 데이터베이스 변경 사항

### AffiliateContract 메타데이터

```typescript
{
  contractType: 'SUBSCRIPTION_AGENT',
  isTrial: boolean,
  trialEndDate: string,
  // 결제 정보
  payment: {
    mul_no: string,
    price: number,
    pay_date: string,
  },
  // 사용자 정보 (결제 시 입력)
  userInfo: {
    name: string,
    phone: string,
  },
  // 계정 생성 정보
  accountInfo: {
    mallUserId: string, // gest1, gest2, ...
    password: string,    // 생성된 비밀번호
    createdAt: string,
  }
}
```

## 🎨 UI/UX 변경 사항

### 1. 파트너 로그인 페이지

**추가 옵션:**
- "무료 체험 시작하기" 버튼
- 휴대폰 번호만 입력하는 간단한 폼

### 2. 결제 전 정보 입력 모달

**새로운 컴포넌트:**
```typescript
<SubscriptionSignupModal>
  - 이름 입력
  - 연락처 입력 (휴대폰 번호)
  - 결제 진행 버튼
</SubscriptionSignupModal>
```

### 3. 결제 후 서명 페이지

**자동 리다이렉트:**
```
/affiliate/contract?type=SUBSCRIPTION_AGENT&contractId={contractId}&payment=success
```

### 4. 서명 완료 후 안내 페이지

**표시 내용:**
- 생성된 아이디: `gest1`
- 생성된 비밀번호: `xxxxx`
- 로그인 안내
- 대시보드로 이동 버튼

## 🔐 보안 고려사항

1. **휴대폰 번호 인증**
   - SMS 인증 추가 고려 (선택사항)
   - 중복 가입 방지

2. **비밀번호 생성**
   - 랜덤 비밀번호 생성 후 이메일/SMS로 전송
   - 또는 사용자가 직접 설정

3. **공용 계정 관리**
   - 무료 체험 계정은 읽기 전용으로 제한
   - 데이터 격리

## ✅ 장점

1. **관리 효율성**
   - 관리자가 개별 계약서를 보낼 필요 없음
   - 자동화된 프로세스

2. **확장성**
   - 무제한 사용자 확보 가능
   - 셀프 서비스로 운영 비용 절감

3. **사용자 경험**
   - 간편한 가입 프로세스
   - 즉시 사용 가능

4. **자동화**
   - 계약서 생성 자동화
   - 아이디/비밀번호 자동 생성
   - 정산 자동화

## ⚠️ 주의사항

1. **무료 체험 기간**
   - 1개월 (30일)로 고정
   - 중복 가입 방지 로직 필요

2. **결제 후 프로세스**
   - 계약서 서명 필수
   - 서명 완료 전까지는 계정 미생성

3. **아이디 생성 규칙**
   - `gest1`, `gest2`, ... 순차 생성
   - 중복 방지

## 🚀 구현 우선순위

1. **Phase 1: 공용 무료 체험 로그인**
   - 휴대폰 번호 기반 로그인
   - 무료 체험 자동 시작

2. **Phase 2: 결제 전 정보 입력**
   - 이름, 연락처 입력 모달
   - 결제 프로세스 연동

3. **Phase 3: 자동 계약서 생성**
   - 결제 완료 후 계약서 자동 생성
   - 서명 페이지 리다이렉트

4. **Phase 4: 아이디/비밀번호 자동 생성**
   - 서명 완료 후 자동 생성
   - 안내 페이지 표시

## 📊 예상 효과

- **관리 시간 절감**: 90% 이상
- **가입 프로세스 단축**: 5분 → 2분
- **확장성**: 무제한 사용자 확보 가능
- **자동화율**: 95% 이상

