# 계약서 PDF 전송 기능 수동 테스트 가이드

## 배포 전 필수 테스트 체크리스트

### 사전 준비
1. 로컬 서버 실행: `npm run dev`
2. 관리자 계정 로그인
3. 대리점장 계정 로그인
4. 테스트용 계약서 준비 (서명 완료된 계약서)

---

## 테스트 시나리오 1: 관리자 패널 - PDF 전송

### 테스트 단계
1. 관리자로 로그인
2. `/admin/affiliate/contracts` 페이지 접속
3. 계약서 목록에서 서명 완료된 계약서 선택
4. "PDF로 보내기" 버튼 클릭
5. 확인 다이얼로그에서 "확인" 클릭

### 예상 결과
- ✅ 로딩 표시 (전송 중...)
- ✅ 성공 메시지: "PDF가 성공적으로 전송되었습니다."
- ✅ 계약자 이메일로 PDF 수신 확인
- ✅ 본사 이메일(CC)로 PDF 수신 확인

### 에러 케이스 테스트
1. **이메일 없는 계약서**
   - 이메일 필드가 비어있는 계약서 선택
   - 예상: "계약서에 이메일 주소가 없습니다" 에러

2. **존재하지 않는 계약서**
   - 잘못된 계약서 ID로 직접 API 호출
   - 예상: 404 에러

3. **네트워크 에러 시뮬레이션**
   - 네트워크 연결 끊기
   - 예상: 타임아웃 또는 네트워크 에러 메시지

---

## 테스트 시나리오 2: 대리점장 대시보드 - PDF 전송

### 테스트 단계
1. 대리점장으로 로그인
2. `/partner/[partnerId]/dashboard` 페이지 접속
3. 계약서 목록에서 자신이 초대한 계약서 선택
4. "PDF로 보내기" 버튼 클릭
5. 확인 다이얼로그에서 "확인" 클릭

### 예상 결과
- ✅ 로딩 표시 (전송 중...)
- ✅ 성공 메시지: "PDF가 성공적으로 전송되었습니다."
- ✅ 계약자 이메일로 PDF 수신 확인
- ✅ 본사 이메일(CC)로 PDF 수신 확인

### 에러 케이스 테스트
1. **권한 없는 계약서**
   - 다른 대리점장이 초대한 계약서 선택
   - 예상: "이 계약서에 대한 권한이 없습니다" 에러 (403)

2. **판매원 계정으로 시도**
   - 판매원 계정으로 로그인 후 PDF 전송 시도
   - 예상: "대리점장만 PDF를 전송할 수 있습니다" 에러 (403)

3. **이메일 없는 계약서**
   - 이메일 필드가 비어있는 계약서 선택
   - 예상: "계약서에 이메일 주소가 없습니다" 에러

---

## 테스트 시나리오 3: 대리점장 계약서 페이지 - PDF 전송

### 테스트 단계
1. 대리점장으로 로그인
2. `/partner/[partnerId]/contract` 페이지 접속
3. 계약서 목록에서 계약서 선택
4. "PDF로 보내기" 버튼 클릭
5. 확인 다이얼로그에서 "확인" 클릭

### 예상 결과
- ✅ 로딩 표시 (전송 중...)
- ✅ 성공 메시지: "PDF가 성공적으로 전송되었습니다."
- ✅ 계약자 이메일로 PDF 수신 확인

---

## 브라우저 개발자 도구 확인 사항

### Network 탭
1. **요청 확인**
   - URL: `/api/admin/affiliate/contracts/{contractId}/send-pdf` 또는 `/api/partner/contracts/{contractId}/send-pdf`
   - Method: `POST`
   - Status: `200` (성공 시)

2. **요청 헤더 확인**
   - `Content-Type: application/json`
   - `credentials: include` (쿠키 포함)

3. **응답 확인**
   - Status Code: 200, 400, 401, 403, 404, 500 등
   - Response Body: JSON 형식
   - `Content-Type: application/json` 헤더

### Console 탭
- 에러 메시지 확인
- 로그 메시지 확인
- JSON 파싱 에러 확인

---

## 405 에러 확인 방법

### 확인 사항
1. **Network 탭에서 요청 확인**
   - Status Code가 405인지 확인
   - Response Body에 "Method Not Allowed" 메시지 확인

2. **요청 Method 확인**
   - POST가 아닌 다른 메서드로 요청되는지 확인
   - OPTIONS 요청은 정상 (CORS preflight)

3. **라우트 파일 확인**
   - `app/api/admin/affiliate/contracts/[contractId]/send-pdf/route.ts` 존재
   - `app/api/partner/contracts/[contractId]/send-pdf/route.ts` 존재
   - POST 함수가 export되어 있는지 확인

---

## 테스트 체크리스트

### 기본 기능
- [ ] 관리자 패널에서 PDF 전송 성공
- [ ] 대리점장 대시보드에서 PDF 전송 성공
- [ ] 대리점장 계약서 페이지에서 PDF 전송 성공
- [ ] 이메일로 PDF 수신 확인

### 에러 처리
- [ ] 이메일 없는 계약서 - 적절한 에러 메시지
- [ ] 존재하지 않는 계약서 - 404 에러
- [ ] 권한 없는 계약서 - 403 에러
- [ ] 비로그인 사용자 - 401 에러
- [ ] 네트워크 에러 - 적절한 에러 메시지
- [ ] 타임아웃 - 적절한 에러 메시지

### 405 에러 방지
- [ ] POST 메서드로 요청되는지 확인
- [ ] 405 에러가 발생하지 않는지 확인
- [ ] 모든 응답이 JSON 형식인지 확인

### 사용자 경험
- [ ] 로딩 표시가 적절히 나타나는지
- [ ] 성공/실패 메시지가 명확한지
- [ ] 에러 발생 시 사용자가 다음 행동을 취할 수 있는지

---

## 문제 발생 시 확인 사항

1. **405 에러 발생 시**
   - 라우트 파일이 올바른 위치에 있는지 확인
   - POST 함수가 export되어 있는지 확인
   - Next.js 15 params 처리가 올바른지 확인 (`await params`)

2. **빈 응답 에러 발생 시**
   - 서버 로그 확인
   - PDF 생성 실패 여부 확인
   - 이메일 전송 실패 여부 확인

3. **타임아웃 발생 시**
   - PDF 생성 시간 확인
   - 네트워크 상태 확인
   - 타임아웃 시간 조정 필요 여부 확인

---

## 테스트 완료 후

모든 테스트가 통과하면:
1. ✅ 테스트 결과 문서화
2. ✅ 발견된 문제 수정
3. ✅ 배포 진행

