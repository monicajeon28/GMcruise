# 프리미엄 플랜 서버 리소스 사용량 분석

> 작성일: 2025-01-28  
> 플랜: 프리미엄 (관리계정 10개, 고객수 9,999명, 페이지 200개, 퍼널 40개)

---

## 📊 플랜 규모

- **관리계정**: 최대 10개 (기존 25개 대비 40%)
- **고객 수**: 최대 9,999명 (기존 99,000명 대비 10%)
- **랜딩 페이지**: 최대 200개 (기존 3,000개 대비 6.7%)
- **퍼널**: 최대 40개 (기존 300개 대비 13.3%)

---

## 💾 데이터베이스 리소스 사용량 (프리미엄 플랜)

### 1. 저장 공간 예상치

#### 관리계정 (MarketingAccount)
- **레코드 수**: 10개
- **평균 레코드 크기**: ~500 bytes
- **총 용량**: ~5 KB
- **인덱스**: ~2 KB
- **총계**: ~7 KB

#### 고객 (MarketingCustomer)
- **레코드 수**: 9,999개
- **평균 레코드 크기**: ~1 KB (JSON 필드 포함)
- **총 용량**: ~10 MB
- **인덱스**: ~2 MB (다중 인덱스)
- **총계**: ~12 MB

#### 랜딩 페이지 (LandingPage)
- **레코드 수**: 200개
- **평균 레코드 크기**: ~50 KB (HTML 콘텐츠 포함)
- **총 용량**: ~10 MB
- **인덱스**: ~0.5 MB
- **총계**: ~10.5 MB

#### 퍼널 (MarketingFunnel)
- **레코드 수**: 40개
- **평균 레코드 크기**: ~10 KB (JSON stages 포함)
- **총 용량**: ~400 KB
- **인덱스**: ~100 KB
- **총계**: ~500 KB

#### 리드 (MarketingLead)
- **레코드 수**: 예상 50,000개 (고객당 평균 5개 리드)
- **평균 레코드 크기**: ~800 bytes
- **총 용량**: ~40 MB
- **인덱스**: ~5 MB
- **총계**: ~45 MB

#### 리드 상호작용 (LeadInteraction)
- **레코드 수**: 예상 200,000개 (리드당 평균 4개 상호작용)
- **평균 레코드 크기**: ~500 bytes
- **총 용량**: ~100 MB
- **인덱스**: ~10 MB
- **총계**: ~110 MB

#### 리드 스코어링 (LeadScore)
- **레코드 수**: 예상 50,000개
- **평균 레코드 크기**: ~600 bytes
- **총 용량**: ~30 MB
- **인덱스**: ~4 MB
- **총계**: ~34 MB

#### 퍼널 전환 (FunnelConversion)
- **레코드 수**: 예상 10,000개
- **평균 레코드 크기**: ~400 bytes
- **총 용량**: ~4 MB
- **인덱스**: ~1 MB
- **총계**: ~5 MB

#### 바이럴 루프 (ViralLoop)
- **레코드 수**: 예상 5,000개
- **평균 레코드 크기**: ~500 bytes
- **총 용량**: ~2.5 MB
- **인덱스**: ~0.5 MB
- **총계**: ~3 MB

### 📦 총 데이터베이스 용량 예상치 (프리미엄 플랜)

| 항목 | 용량 |
|------|------|
| 관리계정 | ~7 KB |
| 고객 | ~12 MB |
| 랜딩 페이지 | ~10.5 MB |
| 퍼널 | ~500 KB |
| 리드 | ~45 MB |
| 리드 상호작용 | ~110 MB |
| 리드 스코어링 | ~34 MB |
| 퍼널 전환 | ~5 MB |
| 바이럴 루프 | ~3 MB |
| **총계** | **~220 MB** |

> **참고**: 실제 사용량은 데이터 증가와 함께 계속 증가합니다. 약 3-5년 운영 시 **500 MB - 1 GB**까지 증가할 수 있습니다.

---

## 🖥️ 서버 리소스 사용량 (프리미엄 플랜)

### 1. 메모리 (RAM) 사용량

#### 기본 애플리케이션
- Next.js 서버: ~200-300 MB
- Prisma Client: ~50-100 MB
- Node.js 런타임: ~100-200 MB
- **기본 총계**: ~350-600 MB

#### 데이터베이스 연결 풀
- PostgreSQL 연결 풀 (최대 10개): ~20-40 MB
- **총계**: ~20-40 MB

#### 캐싱 (Redis 권장)
- 세션 캐시: ~20-50 MB
- 쿼리 결과 캐시: ~50-100 MB
- **총계**: ~70-150 MB

#### **총 메모리 사용량**: ~440-790 MB (약 0.5-0.8 GB)

> **권장 사양**: 최소 **1 GB RAM**, 권장 **2 GB RAM**

### 2. CPU 사용량

#### 일반적인 사용
- **평균 CPU 사용률**: 5-15%
- **피크 시간대**: 15-30%
- **배치 작업 (리드 스코어링 등)**: 30-50%

#### 최적화된 환경
- **평균 CPU 사용률**: 3-10%
- **피크 시간대**: 10-25%

> **권장 사양**: 최소 **1 vCPU**, 권장 **2 vCPU**

### 3. 디스크 I/O

#### 데이터베이스 읽기/쓰기
- **평균 읽기**: 50-200 IOPS
- **평균 쓰기**: 20-100 IOPS
- **피크 읽기**: 200-500 IOPS
- **피크 쓰기**: 100-200 IOPS

> **권장**: SSD 사용 필수, 최소 500 IOPS

---

## ⚡ 성능 최적화 가이드 (프리미엄 플랜)

### 1. 데이터베이스 최적화

#### 인덱스 최적화
```sql
-- 자주 조회되는 필드에 인덱스 추가
CREATE INDEX idx_marketing_customer_account_status 
ON MarketingCustomer(accountId, status);

CREATE INDEX idx_marketing_lead_account_created 
ON MarketingLead(accountId, createdAt);

CREATE INDEX idx_funnel_conversion_funnel_converted 
ON FunnelConversion(funnelId, convertedAt);
```

#### 파티셔닝 (선택사항)
- 프리미엄 플랜 규모에서는 파티셔닝이 필수는 아님
- 1년 이상 된 리드 상호작용 데이터만 아카이빙

#### 아카이빙
- 1년 이상 된 리드 상호작용 데이터는 별도 아카이브 테이블로 이동
- 6개월 이상 된 전환 데이터는 통계 테이블로 집계 후 원본 삭제

### 2. 캐싱 전략

#### Redis 캐싱
```typescript
// 자주 조회되는 통계 데이터 캐싱
- 대시보드 통계: 5분 TTL
- 고객 목록 (페이지네이션): 1분 TTL
- 퍼널 설정: 10분 TTL
```

#### 애플리케이션 레벨 캐싱
- Prisma 쿼리 결과 캐싱
- 정적 페이지 콘텐츠 캐싱

### 3. 배치 작업 최적화

#### 리드 스코어링
- **실행 주기**: 매일 새벽 2시
- **배치 크기**: 500개씩 처리
- **병렬 처리**: 3개 워커 동시 실행

#### 데이터 정리
- **실행 주기**: 매주 일요일 새벽
- **삭제 대상**: 2년 이상 된 리드 상호작용 데이터

### 4. 쿼리 최적화

#### 페이지네이션 필수
```typescript
// ✅ 좋은 예
const customers = await prisma.marketingCustomer.findMany({
  take: 50,
  skip: (page - 1) * 50,
  orderBy: { createdAt: 'desc' },
});
```

#### 필요한 필드만 선택
```typescript
// ✅ 필요한 필드만 선택
const customers = await prisma.marketingCustomer.findMany({
  select: {
    id: true,
    name: true,
    email: true,
    status: true,
  },
});
```

---

## 🚀 서버 사양 권장사항 (프리미엄 플랜)

### 최소 사양 (소규모 운영)
- **CPU**: 1 vCPU
- **RAM**: 1 GB
- **디스크**: 10 GB SSD
- **네트워크**: 100 Mbps
- **예상 비용**: 월 $10-20 (AWS t3.micro/t3.small 등)

### 권장 사양 (안정적 운영)
- **CPU**: 2 vCPU
- **RAM**: 2 GB
- **디스크**: 20 GB SSD
- **네트워크**: 500 Mbps
- **예상 비용**: 월 $30-50 (AWS t3.small 등)

### 최적 사양 (여유 있는 운영)
- **CPU**: 2-4 vCPU
- **RAM**: 4 GB
- **디스크**: 50 GB SSD
- **네트워크**: 1 Gbps
- **예상 비용**: 월 $50-80 (AWS t3.medium 등)

### 데이터베이스 서버 (별도 권장)
- **CPU**: 2 vCPU
- **RAM**: 4 GB
- **디스크**: 50 GB SSD (고 IOPS)
- **예상 비용**: 월 $50-80 (AWS db.t3.small 등)

---

## 📈 확장성 고려사항 (프리미엄 플랜)

### 수평 확장 (Scale Out)
- **애플리케이션 서버**: 로드 밸런서로 여러 인스턴스 운영 가능
- **데이터베이스**: 읽기 전용 복제본 (Read Replica) 활용 (선택사항)

### 수직 확장 (Scale Up)
- **CPU/RAM 증가**: 트래픽 증가에 따라 단계적으로 확장
- **디스크 용량**: 월별 모니터링 후 필요시 확장

### 데이터베이스 분리
- **읽기/쓰기 분리**: Master-Slave 구조 (선택사항)
- **샤딩**: 불필요 (10개 계정은 단일 DB로 충분)

---

## ⚠️ 주의사항 (프리미엄 플랜)

### 1. 데이터베이스 연결 풀
- **최대 연결 수**: 10-20개 권장
- **연결 타임아웃**: 30초
- **Idle 타임아웃**: 10분

### 2. 메모리 누수 방지
- 정기적인 메모리 모니터링
- 장기 실행 배치 작업은 별도 프로세스로 분리

### 3. 백업 전략
- **일일 백업**: 자동 백업 (매일 새벽)
- **보관 기간**: 최소 30일
- **재해 복구**: 다른 리전에 백업 저장 (선택사항)

---

## 💰 예상 운영 비용 (월간, 프리미엄 플랜)

### 클라우드 서비스 (AWS 기준)
- **애플리케이션 서버**: $20-50
- **데이터베이스 서버**: $50-80
- **스토리지**: $5-10
- **네트워크**: $5-15
- **캐싱 (ElastiCache)**: $15-30
- **총계**: **$95-185/월**

### 자체 서버 (온프레미스)
- **서버 하드웨어**: 초기 투자 $1,000-2,000
- **전기/인터넷**: $30-50/월
- **유지보수**: $50-100/월
- **총계 (1년 기준)**: **$960-1,700/년** (월 $80-140)

---

## ✅ 결론 (프리미엄 플랜)

### 서버 리소스 사용량 요약
- **데이터베이스 용량**: ~220 MB (초기), 500 MB - 1 GB (장기)
- **메모리 사용량**: ~0.5-0.8 GB (기본), 1-2 GB (권장)
- **CPU 사용량**: 평균 5-15%, 피크 15-30%
- **디스크 I/O**: 평균 50-200 IOPS

### 권장 사양
- **최소**: 1 vCPU, 1 GB RAM, 10 GB SSD
- **권장**: 2 vCPU, 2 GB RAM, 20 GB SSD
- **최적**: 2-4 vCPU, 4 GB RAM, 50 GB SSD

### 비용
- **클라우드**: 월 $95-185
- **온프레미스**: 월 $80-140 (초기 투자 제외)

### 최적화 여부 판단

#### ✅ **용량이 적절합니다!**

프리미엄 플랜 규모는:
1. **데이터베이스 용량**: ~220 MB는 매우 적은 편입니다
   - 일반적인 웹 애플리케이션도 수백 MB는 사용합니다
   - 1 GB 미만이면 관리가 매우 쉬움

2. **메모리 사용량**: ~0.5-0.8 GB도 적은 편입니다
   - 최소 1 GB RAM으로도 충분히 운영 가능
   - 권장 2 GB RAM이면 여유 있음

3. **CPU 사용량**: 5-15%는 매우 낮은 수준입니다
   - 1 vCPU로도 충분히 운영 가능
   - 2 vCPU면 여유 있음

4. **비용**: 월 $95-185는 합리적입니다
   - 리드젠 프리미엄 플랜 월 200,000원 대비 매우 저렴
   - 서버 비용은 플랜 요금의 5-10% 수준

### 추가 최적화 여지

프리미엄 플랜 규모에서는 **과도한 최적화가 필요하지 않습니다**:
- 파티셔닝: 불필요
- 샤딩: 불필요
- 복잡한 캐싱 전략: 기본적인 캐싱만으로 충분
- 읽기 전용 복제본: 선택사항

**결론**: 프리미엄 플랜 규모는 **용량이 적절하고, 최적화도 충분히 가능한 수준**입니다. 추가 최적화 없이도 안정적으로 운영할 수 있으며, 필요시 간단한 최적화만으로도 성능을 더 향상시킬 수 있습니다.







