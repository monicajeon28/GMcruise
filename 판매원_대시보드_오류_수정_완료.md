# β… νλ§¤μ› λ€μ‹λ³΄λ“ μ¤λ¥ μμ • μ™„λ£

## μμ •λ μ¤λ¥

### 1. β… λ€μ‹λ³΄λ“ ν†µκ³„ API: μ›”λ³„ ν•„ν„°λ§ μ…λ ¥ κ²€μ¦ κ°•ν™”
**νμΌ**: `app/api/partner/dashboard/stats/route.ts`

**μμ • λ‚΄μ©**:
- μ›” νλΌλ―Έν„° ν•μ‹ κ²€μ¦ μ¶”κ°€ (YYYY-MM ν•μ‹ κ°•μ )
- μ—°λ„/μ›” κ°’ μ ν¨μ„± κ²€μ¦ (2020-2100 λ²”μ„, 1-12 μ›”)
- λ‚ μ§ κ³„μ‚° κ²°κ³Ό μ ν¨μ„± κ²€μ¦
- μƒμ„Έν• μ—λ¬ λ©”μ‹μ§€ μ¶”κ°€

**μμ • μ „**:
```typescript
const [year, monthNum] = month.split('-').map(Number);
```

**μμ • ν›„**:
```typescript
const parts = month.split('-');
if (parts.length !== 2) {
  return NextResponse.json(
    { ok: false, message: 'μ›” ν•μ‹μ΄ μ¬λ°”λ¥΄μ§€ μ•μµλ‹λ‹¤. YYYY-MM ν•μ‹μ„ μ‚¬μ©ν•΄μ£Όμ„Έμ”.' },
    { status: 400 }
  );
}
const [year, monthNum] = parts.map(Number);
if (isNaN(year) || isNaN(monthNum) || monthNum < 1 || monthNum > 12 || year < 2020 || year > 2100) {
  return NextResponse.json(
    { ok: false, message: 'μ ν¨ν•μ§€ μ•μ€ μ›” κ°’μ…λ‹λ‹¤.' },
    { status: 400 }
  );
}
```

---

### 2. β… μ›”λ³„ νλ§¤ ν†µκ³„: groupBy null μ²λ¦¬ μ¶”κ°€
**νμΌ**: `app/api/partner/dashboard/stats/route.ts`

**μμ • λ‚΄μ©**:
- `saleDate`κ°€ nullμΈ κ²½μ° ν•„ν„°λ§ μ¶”κ°€
- groupBy κ²°κ³Όμ—μ„ null κ°’ μ¶”κ°€ ν•„ν„°λ§

**μμ • μ „**:
```typescript
saleDate: {
  gte: sixMonthsAgo,
},
```

**μμ • ν›„**:
```typescript
saleDate: {
  gte: sixMonthsAgo,
  not: null, // null κ°’ ν•„ν„°λ§ μ¶”κ°€
},
```

κ·Έλ¦¬κ³  κ²°κ³Ό μ²λ¦¬:
```typescript
monthlySales: monthlySales
  .filter((s) => s.saleDate !== null) // null κ°’ μ¶”κ°€ ν•„ν„°λ§
  .map((s) => ({
    date: s.saleDate,
    count: s._count,
    totalAmount: s._sum.saleAmount || 0,
  })),
```

---

## π“ μμ • ν¨κ³Ό

### λ³΄μ•/μ•μ •μ„± ν–¥μƒ
- β… μλ»λ μ…λ ¥ κ°’μΌλ΅ μΈν• μ„λ²„ μ¤λ¥ λ°©μ§€
- β… null κ°’μΌλ΅ μΈν• groupBy μ¤λ¥ λ°©μ§€
- β… μ‚¬μ©μ μΉν™”μ  μ—λ¬ λ©”μ‹μ§€ μ κ³µ

### μμƒ κ²°κ³Ό
- μλ»λ μ›” νλΌλ―Έν„° μ…λ ¥ μ‹ λ…ν™•ν• μ—λ¬ λ©”μ‹μ§€ λ°ν™
- `saleDate`κ°€ nullμΈ νλ§¤ λ°μ΄ν„°κ°€ μμ–΄λ„ μ¤λ¥ μ—†μ΄ λ™μ‘
- λ€μ‹λ³΄λ“ μ•μ •μ„± ν–¥μƒ

---

## π” μ¶”κ°€ ν™•μΈ ν•„μ” μ‚¬ν•­

### μ¤‘κ°„ μ°μ„ μμ„ (λ‹¤μ λ‹¨κ³„)
1. μƒλ‹΄ κΈ°λ΅ νΈλμ­μ… λ¶„λ¦¬ (κΈ΄ νΈλμ­μ… μµμ ν™”)
2. μ „ν™”λ²νΈ μ •κ·ν™” μ ν‹Έλ¦¬ν‹° ν†µμΌ
3. μ—λ¬ λ©”μ‹μ§€ ν‘μ¤€ν™”

---

## β… ν…μ¤νΈ κ¶μ¥μ‚¬ν•­

### μμ •λ κΈ°λ¥ ν…μ¤νΈ
1. **μ›” νλΌλ―Έν„° κ²€μ¦**:
   - μ •μƒ: `?month=2025-01`
   - μ¤λ¥: `?month=2025-1` (ν•μ‹ μ¤λ¥)
   - μ¤λ¥: `?month=invalid` (ν•μ‹ μ¤λ¥)
   - μ¤λ¥: `?month=2025-13` (μ›” λ²”μ„ μ¤λ¥)
   - μ¤λ¥: `?month=2019-01` (μ—°λ„ λ²”μ„ μ¤λ¥)

2. **groupBy null μ²λ¦¬**:
   - `saleDate`κ°€ nullμΈ νλ§¤ λ°μ΄ν„°κ°€ μμ–΄λ„ μ¤λ¥ μ—†μ΄ λ™μ‘ν•λ”μ§€ ν™•μΈ
   - μ›”λ³„ ν†µκ³„κ°€ μ •μƒμ μΌλ΅ ν‘μ‹λλ”μ§€ ν™•μΈ

---

## π“ μ™„λ£ μƒνƒ

- β… Critical μ¤λ¥ μμ • μ™„λ£
- β… μ…λ ¥ κ²€μ¦ κ°•ν™”
- β… null μ²λ¦¬ μ¶”κ°€
- β… μ—λ¬ λ©”μ‹μ§€ κ°μ„ 

**λ‹¤μ μ‘μ—…**: μ¤‘κ°„ μ°μ„ μμ„ κ°μ„ μ‚¬ν•­ μ μ©


