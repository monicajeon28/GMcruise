# ì„±ëŠ¥ ë¬¸ì œ ë¶„ì„ ë° í•´ê²°ë°©ì•ˆ

## ğŸ” ë¬¸ì œ ë¶„ì„

### 1. ê³ ê°ê´€ë¦¬ í˜ì´ì§€ (`/admin/customers`) ì„±ëŠ¥ ë¬¸ì œ

#### ì›ì¸:
1. **ìºì‹œ ë¹„í™œì„±í™”**: `cache: 'no-store'`ë¡œ ë§¤ë²ˆ ì„œë²„ì—ì„œ ë°ì´í„° ì¡°íšŒ
2. **ë³µì¡í•œ DB ì¿¼ë¦¬**: 
   - ì—¬ëŸ¬ í…Œì´ë¸” ì¡°ì¸ (User, UserTrip, AffiliateProfile, Reservation ë“±)
   - ë³µì¡í•œ í•„í„°ë§ ë¡œì§ (customerGroup, status, certificateType ë“±)
   - ì¤‘ì²©ëœ ì¿¼ë¦¬ (ì—°ë™ëœ í¬ë£¨ì¦ˆëª° ê³ ê° ì¡°íšŒ)
3. **ìˆœì°¨ì  API í˜¸ì¶œ**: ê³ ê° ëª©ë¡ê³¼ ê·¸ë£¹ ì¹´ìš´íŠ¸ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì¡°íšŒ
4. **ë¶ˆí•„ìš”í•œ ë°ì´í„° ì¡°íšŒ**: ëª¨ë“  ê´€ë ¨ ë°ì´í„°ë¥¼ í•œ ë²ˆì— ê°€ì ¸ì˜´

#### í˜„ì¬ ì½”ë“œ ìœ„ì¹˜:
- `app/admin/customers/page.tsx` (176-180ì¤„)
- `app/api/admin/customers/route.ts` (ì „ì²´)

### 2. ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ (`/admin/dashboard`) ì„±ëŠ¥ ë¬¸ì œ

#### ì›ì¸:
1. **ìˆœì°¨ì  API í˜¸ì¶œ**: 5ê°œì˜ APIë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í˜¸ì¶œ
   - `/api/admin/dashboard`
   - `/api/admin/affiliate/monitoring`
   - `/api/admin/users/recent`
   - `/api/admin/trips/recent`
   - `/api/admin/affiliate/leads`
2. **ê° APIì˜ ë³µì¡í•œ ì¿¼ë¦¬**: ëŒ€ì‹œë³´ë“œ API í•˜ë‚˜ë§Œìœ¼ë¡œë„ ì—¬ëŸ¬ í†µê³„ë¥¼ ì¡°íšŒ
3. **ë¶ˆí•„ìš”í•œ ë°ì´í„° ì¡°íšŒ**: ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë°ì´í„°ê¹Œì§€ ì¡°íšŒ

#### í˜„ì¬ ì½”ë“œ ìœ„ì¹˜:
- `app/admin/dashboard/page.tsx` (171-285ì¤„)

### 3. ë¼ìš°íŒ… ì„±ëŠ¥ ë¬¸ì œ

#### ì›ì¸:
1. **Next.js prefetch ë¹„í™œì„±í™”**: Link ì»´í¬ë„ŒíŠ¸ì— prefetch ì„¤ì • ì—†ìŒ
2. **í˜ì´ì§€ ì „í™˜ ì‹œ ì „ì²´ ë¦¬ë Œë”ë§**: í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë¼ìš°íŒ…ì´ì§€ë§Œ ë°ì´í„° ë¡œë”©ì´ ëŠë¦¼
3. **ë¡œë”© ìƒíƒœ ë¶€ì¡±**: ì‚¬ìš©ìê°€ ì§„í–‰ ìƒí™©ì„ ì•Œê¸° ì–´ë ¤ì›€

## ğŸš€ í•´ê²°ë°©ì•ˆ

### 1. ê³ ê°ê´€ë¦¬ í˜ì´ì§€ ìµœì í™”

#### A. API í˜¸ì¶œ ë³‘ë ¬ ì²˜ë¦¬
```typescript
// í˜„ì¬: ìˆœì°¨ì  í˜¸ì¶œ
const customersResponse = await fetch('/api/admin/customers?...');
const data = await customersResponse.json();

// ê°œì„ : ë³‘ë ¬ í˜¸ì¶œ (ê·¸ë£¹ ì¹´ìš´íŠ¸ëŠ” ë³„ë„ APIë¡œ ë¶„ë¦¬)
const [customersResponse, groupCountsResponse] = await Promise.all([
  fetch('/api/admin/customers?...'),
  fetch('/api/admin/customers/group-counts?...')
]);
```

#### B. ìºì‹± ì „ëµ ë„ì…
```typescript
// í˜„ì¬: cache: 'no-store'
const response = await fetch(`/api/admin/customers?...`, {
  cache: 'no-store',
});

// ê°œì„ : ì§§ì€ ìºì‹œ ì‹œê°„ ì„¤ì • (30ì´ˆ)
const response = await fetch(`/api/admin/customers?...`, {
  next: { revalidate: 30 }, // 30ì´ˆ ìºì‹œ
});
```

#### C. DB ì¿¼ë¦¬ ìµœì í™”
- í•„ìš”í•œ í•„ë“œë§Œ ì„ íƒ (select ìµœì í™”)
- ì¸ë±ìŠ¤ í™•ì¸ ë° ì¶”ê°€
- ë¶ˆí•„ìš”í•œ ì¡°ì¸ ì œê±°
- í˜ì´ì§€ë„¤ì´ì…˜ ê¸°ë³¸ê°’ ì¦ê°€ (20 â†’ 50)

### 2. ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ ìµœì í™”

#### A. API í˜¸ì¶œ ë³‘ë ¬ ì²˜ë¦¬
```typescript
// í˜„ì¬: ìˆœì°¨ì  í˜¸ì¶œ
const dashboardResponse = await fetch('/api/admin/dashboard');
const dashboardResult = await dashboardResponse.json();
const monitoringResponse = await fetch('/api/admin/affiliate/monitoring');
// ...

// ê°œì„ : ëª¨ë“  APIë¥¼ ë³‘ë ¬ë¡œ í˜¸ì¶œ
const [
  dashboardResponse,
  monitoringResponse,
  customersResponse,
  tripsResponse,
  inquiriesResponse
] = await Promise.all([
  fetch('/api/admin/dashboard'),
  fetch('/api/admin/affiliate/monitoring'),
  fetch('/api/admin/users/recent'),
  fetch('/api/admin/trips/recent'),
  fetch('/api/admin/affiliate/leads?limit=20')
]);
```

#### B. ëŒ€ì‹œë³´ë“œ API í†µí•©
- ì—¬ëŸ¬ APIë¥¼ í•˜ë‚˜ë¡œ í†µí•©í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ìˆ˜ ê°ì†Œ
- ë˜ëŠ” í•„ìš”í•œ ë°ì´í„°ë§Œ ì„ íƒì ìœ¼ë¡œ ë¡œë“œ

### 3. ë¼ìš°íŒ… ìµœì í™”

#### A. Prefetch í™œì„±í™”
```typescript
// Link ì»´í¬ë„ŒíŠ¸ì— prefetch ì¶”ê°€
<Link href="/admin/customers" prefetch={true}>
  ê³ ê° ê´€ë¦¬
</Link>
```

#### B. ë¡œë”© ìƒíƒœ ê°œì„ 
- Suspense ê²½ê³„ ì¶”ê°€
- ìŠ¤ì¼ˆë ˆí†¤ UI í‘œì‹œ
- ì§„í–‰ë¥  í‘œì‹œ

### 4. ì¶”ê°€ ìµœì í™”

#### A. React Query ë˜ëŠ” SWR ë„ì…
- ìë™ ìºì‹±
- ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹ 
- ë‚™ê´€ì  ì—…ë°ì´íŠ¸

#### B. ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ í™•ì¸
```sql
-- í•„ìš”í•œ ì¸ë±ìŠ¤ í™•ì¸
CREATE INDEX IF NOT EXISTS idx_user_customerStatus ON User(customerStatus);
CREATE INDEX IF NOT EXISTS idx_user_customerSource ON User(customerSource);
CREATE INDEX IF NOT EXISTS idx_user_createdAt ON User(createdAt);
CREATE INDEX IF NOT EXISTS idx_user_role ON User(role);
```

#### C. í˜ì´ì§€ë„¤ì´ì…˜ ê¸°ë³¸ê°’ ì¦ê°€
- í˜„ì¬: 20ê°œ
- ê°œì„ : 50ê°œ (ì´ë¯¸ ì ìš©ë¨)

## ğŸ“Š ì˜ˆìƒ ì„±ëŠ¥ ê°œì„ 

### í˜„ì¬ ì„±ëŠ¥ (ì˜ˆìƒ):
- ê³ ê°ê´€ë¦¬ í˜ì´ì§€ ë¡œë”©: 2-5ì´ˆ
- ëŒ€ì‹œë³´ë“œ ë¡œë”©: 3-6ì´ˆ
- í˜ì´ì§€ ì „í™˜: 1-2ì´ˆ

### ê°œì„  í›„ ì˜ˆìƒ ì„±ëŠ¥:
- ê³ ê°ê´€ë¦¬ í˜ì´ì§€ ë¡œë”©: 0.5-1.5ì´ˆ (60-70% ê°œì„ )
- ëŒ€ì‹œë³´ë“œ ë¡œë”©: 1-2ì´ˆ (70-80% ê°œì„ )
- í˜ì´ì§€ ì „í™˜: 0.3-0.5ì´ˆ (70-80% ê°œì„ )

## ğŸ¯ ìš°ì„ ìˆœìœ„

1. âœ… **ì™„ë£Œ**: ëŒ€ì‹œë³´ë“œ API ë³‘ë ¬ ì²˜ë¦¬
2. âœ… **ì™„ë£Œ**: ê³ ê°ê´€ë¦¬ í˜ì´ì§€ ìºì‹± ì „ëµ (30ì´ˆ revalidate)
3. âœ… **ì™„ë£Œ**: ë¼ìš°íŒ… prefetch í™œì„±í™”
4. **ëŒ€ê¸°**: DB ì¿¼ë¦¬ ìµœì í™” (ì¸ë±ìŠ¤ í™•ì¸ í•„ìš”)
5. **ëŒ€ê¸°**: React Query ë„ì… (ì¥ê¸°ì )

## âœ… ì ìš©ëœ ìµœì í™”

### 1. ëŒ€ì‹œë³´ë“œ API ë³‘ë ¬ ì²˜ë¦¬
- **íŒŒì¼**: `app/admin/dashboard/page.tsx`
- **ë³€ê²½ì‚¬í•­**: 5ê°œì˜ APIë¥¼ `Promise.all`ë¡œ ë³‘ë ¬ í˜¸ì¶œ
- **ì˜ˆìƒ ê°œì„ **: 3-6ì´ˆ â†’ 1-2ì´ˆ (70-80% ê°œì„ )

### 2. ê³ ê°ê´€ë¦¬ í˜ì´ì§€ ìºì‹±
- **íŒŒì¼**: `app/admin/customers/page.tsx`
- **ë³€ê²½ì‚¬í•­**: `cache: 'no-store'` â†’ `next: { revalidate: 30 }`
- **ì˜ˆìƒ ê°œì„ **: 2-5ì´ˆ â†’ 0.5-1.5ì´ˆ (60-70% ê°œì„ , ë°˜ë³µ ìš”ì²­ ì‹œ)

### 3. ë¼ìš°íŒ… prefetch í™œì„±í™”
- **íŒŒì¼**: `app/admin/layout.tsx`
- **ë³€ê²½ì‚¬í•­**: ëª¨ë“  Link ì»´í¬ë„ŒíŠ¸ì— `prefetch={true}` ì¶”ê°€
- **ì˜ˆìƒ ê°œì„ **: í˜ì´ì§€ ì „í™˜ ì‹œ ë¯¸ë¦¬ ë¡œë“œë˜ì–´ ë” ë¹ ë¥¸ ì „í™˜

### 4. ì½”ë“œ ì •ë¦¬
- ì¤‘ë³µëœ `loadCustomers` í•¨ìˆ˜ ì œê±°
- ë¶ˆí•„ìš”í•œ ì½”ë“œ ì •ë¦¬

