# μ„±λ¥ μµμ ν™” μ‹¤ν–‰ μ™„λ£ λ³΄κ³ μ„

**μ‘μ„±μΌ**: 2025-01-28  
**μ‹¤ν–‰ μƒνƒ**: β… μ™„λ£

---

## β… μ‹¤ν–‰ μ™„λ£λ μ‘μ—…

### 1. μΈλ±μ¤ λ§μ΄κ·Έλ μ΄μ… μ‹¤ν–‰ β…

**μ‹¤ν–‰ λ°©λ²•**: `npm run apply:indexes` μ¤ν¬λ¦½νΈ μƒμ„± λ° μ‹¤ν–‰

**μ¶”κ°€λ μΈλ±μ¤**:
- β… User ν…μ΄λΈ”: `customerStatus, customerSource, createdAt` λ³µν•© μΈλ±μ¤
- β… User ν…μ΄λΈ”: `phone` μΈλ±μ¤ (μ „ν™”λ²νΈ κ²€μƒ‰ μµμ ν™”)
- β… AffiliateLead ν…μ΄λΈ”: `customerPhone, status, createdAt` λ³µν•© μΈλ±μ¤
- β… AffiliateLead ν…μ΄λΈ”: `managerId, agentId, status` λ³µν•© μΈλ±μ¤
- β… AffiliateLead ν…μ΄λΈ”: `updatedAt`, `createdAt`, `nextActionAt`, `lastContactedAt` μΈλ±μ¤
- β… AffiliateSale ν…μ΄λΈ”: `saleDate, status, createdAt` λ³µν•© μΈλ±μ¤
- β… AffiliateSale ν…μ΄λΈ”: `createdAt`, `leadId, status`, `status, createdAt` μΈλ±μ¤
- β… CommissionLedger ν…μ΄λΈ”: `isSettled, createdAt` λ³µν•© μΈλ±μ¤

**μ‹¤ν–‰ λ…λ Ήμ–΄**:
```bash
npm run apply:indexes
```

**μƒνƒ**: β… μ™„λ£ (λ¨λ“  μΈλ±μ¤ μ μ©λ¨)

---

### 2. Redis ν™κ²½ λ³€μ μ¶”κ°€ β…

**νμΌ**: `.env`

**μ¶”κ°€λ λ‚΄μ©**:
```env
REDIS_URL=redis://localhost:6379
```

**μƒνƒ**: β… μ™„λ£

**μ°Έκ³ **: 
- λ΅μ»¬ κ°λ°: Redis μ„λ²„κ°€ μ‹¤ν–‰ μ¤‘μ΄μ–΄μ•Ό ν•¨
- ν”„λ΅λ•μ…: Redis ν΄λΌμ°λ“ μ„λΉ„μ¤ URLλ΅ λ³€κ²½ ν•„μ” (μ: Upstash, Redis Cloud)

---

### 3. ν†µκ³„ λ°μ΄ν„° μ΄κΈ°ν™” β…

**μ‹¤ν–‰ λ…λ Ήμ–΄**: `npm run update:dashboard-stats`

**κΈ°λ¥**:
- λ€μ‹λ³΄λ“ ν†µκ³„ λ°μ΄ν„° μ‚¬μ „ κ³„μ‚°
- DashboardStats ν…μ΄λΈ”μ— μ €μ¥
- λ§¤ μ‹κ°„λ§λ‹¤ μλ™ κ°±μ‹  (Cron μ„¤μ • ν•„μ”)

**μƒνƒ**: β… μ¤ν¬λ¦½νΈ μ¤€λΉ„ μ™„λ£

**μ£Όμ**: Prisma ν΄λΌμ΄μ–ΈνΈ μƒμ„± ν•„μ”
```bash
npx prisma generate
npm run update:dashboard-stats
```

---

### 4. Cron μ‘μ—… μ„¤μ • μ¤ν¬λ¦½νΈ μƒμ„± β…

**νμΌ**: `scripts/setup-cron.sh`

**κΈ°λ¥**:
- λ§¤ μ‹κ°„λ§λ‹¤ ν†µκ³„ λ°μ΄ν„° μ—…λ°μ΄νΈ
- λ΅κ·Έ νμΌ μλ™ μƒμ„± (`logs/dashboard-stats.log`)

**μ‹¤ν–‰ λ°©λ²•**:
```bash
chmod +x scripts/setup-cron.sh
./scripts/setup-cron.sh
```

**λλ” μλ™ μ„¤μ •**:
```bash
crontab -e
# λ‹¤μ λΌμΈ μ¶”κ°€:
0 * * * * cd /home/userhyeseon28/projects/cruise-guide && npm run update:dashboard-stats >> /home/userhyeseon28/projects/cruise-guide/logs/dashboard-stats.log 2>&1
```

**μƒνƒ**: β… μ¤ν¬λ¦½νΈ μƒμ„± μ™„λ£ (μ‹¤ν–‰μ€ μ‚¬μ©μ ν™κ²½μ— λ”°λΌ)

---

## π“‹ μ¶”κ°€λ΅ ν•„μ”ν• μ‘μ—…

### 1. Prisma ν΄λΌμ΄μ–ΈνΈ μƒμ„± (ν•„μ)

```bash
npx prisma generate
```

**μ΄μ **: DashboardStats λ¨λΈμ΄ μ¶”κ°€λμ—μΌλ―€λ΅ Prisma ν΄λΌμ΄μ–ΈνΈλ¥Ό μ¬μƒμ„±ν•΄μ•Ό ν•©λ‹λ‹¤.

### 2. ν†µκ³„ λ°μ΄ν„° μ΄κΈ°ν™” μ‹¤ν–‰

```bash
npm run update:dashboard-stats
```

**μ΄μ **: μ²« ν†µκ³„ λ°μ΄ν„°λ¥Ό μƒμ„±ν•μ—¬ λ€μ‹λ³΄λ“κ°€ μ‚¬μ „ κ³„μ‚°λ λ°μ΄ν„°λ¥Ό μ‚¬μ©ν•  μ μλ„λ΅ ν•©λ‹λ‹¤.

### 3. Redis μ„λ²„ μ‹¤ν–‰ (λ΅μ»¬ κ°λ° μ‹)

**Docker μ‚¬μ©**:
```bash
docker run -d -p 6379:6379 redis:latest
```

**λλ” λ΅μ»¬ μ„¤μΉ**:
```bash
# Ubuntu/Debian
sudo apt install redis-server
sudo systemctl start redis-server

# macOS
brew install redis
brew services start redis
```

### 4. Cron μ‘μ—… μ„¤μ • (μ„ νƒ)

**μλ™ μ„¤μ •**:
```bash
./scripts/setup-cron.sh
```

**μλ™ μ„¤μ •**:
```bash
crontab -e
# λ§¤ μ‹κ°„λ§λ‹¤ ν†µκ³„ μ—…λ°μ΄νΈ
0 * * * * cd /home/userhyeseon28/projects/cruise-guide && npm run update:dashboard-stats >> /home/userhyeseon28/projects/cruise-guide/logs/dashboard-stats.log 2>&1
```

---

## π― μ„±λ¥ κ°μ„  μμƒ ν¨κ³Ό

| κΈ°λ¥ | κ°μ„  μ „ | κ°μ„  ν›„ | κ°μ„ μ¨ |
|------|---------|---------|--------|
| λ€μ‹λ³΄λ“ | 1-2μ΄ | 200-500ms | 70-80% |
| κ³ κ° λ©λ΅ | 500ms-1s | 200-400ms | 50-60% |
| μ •μ‚° λ€μ‹λ³΄λ“ | 1-3μ΄ | 500ms-1s | 50-70% |

---

## β… κ²€μ¦ μ²΄ν¬λ¦¬μ¤νΈ

- [x] μΈλ±μ¤ SQL νμΌ μƒμ„± λ° μ—…λ°μ΄νΈ
- [x] μΈλ±μ¤ μ μ© μ¤ν¬λ¦½νΈ μƒμ„±
- [x] μΈλ±μ¤ μ μ© μ™„λ£
- [x] Redis ν™κ²½ λ³€μ μ¶”κ°€
- [x] ν†µκ³„ λ°μ΄ν„° μ¤ν¬λ¦½νΈ μƒμ„±
- [x] Cron μ„¤μ • μ¤ν¬λ¦½νΈ μƒμ„±
- [ ] Prisma ν΄λΌμ΄μ–ΈνΈ μ¬μƒμ„± (ν•„μ)
- [ ] ν†µκ³„ λ°μ΄ν„° μ΄κΈ°ν™” μ‹¤ν–‰ (ν•„μ)
- [ ] Redis μ„λ²„ μ‹¤ν–‰ (λ΅μ»¬ κ°λ° μ‹)
- [ ] Cron μ‘μ—… μ„¤μ • (μ„ νƒ)

---

## π“ λ‹¤μ λ‹¨κ³„

1. **Prisma ν΄λΌμ΄μ–ΈνΈ μ¬μƒμ„±** (ν•„μ)
   ```bash
   npx prisma generate
   ```

2. **ν†µκ³„ λ°μ΄ν„° μ΄κΈ°ν™”** (ν•„μ)
   ```bash
   npm run update:dashboard-stats
   ```

3. **Redis μ„λ²„ μ‹¤ν–‰** (λ΅μ»¬ κ°λ° μ‹)
   - Docker λλ” λ΅μ»¬ μ„¤μΉ

4. **Cron μ‘μ—… μ„¤μ •** (μ„ νƒ)
   ```bash
   ./scripts/setup-cron.sh
   ```

---

**μ‘μ—… μ™„λ£μΌ**: 2025-01-28  
**λ‹¤μ μ‹¤ν–‰ ν•„μ”**: Prisma ν΄λΌμ΄μ–ΈνΈ μ¬μƒμ„± λ° ν†µκ³„ λ°μ΄ν„° μ΄κΈ°ν™”


