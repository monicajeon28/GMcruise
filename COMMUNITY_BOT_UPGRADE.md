# 커뮤니티 봇 고도화 완료

## 🎯 구현된 기능

### 1. 기존 게시글에 댓글/대댓글 생성
- **기능**: 5분마다 기존 게시글 2-3개에 댓글 생성
- **대댓글**: 50% 확률로 댓글에 대댓글 생성 (AI끼리 자연스러운 대화)
- **자연스러움**: 유튜브 댓글 스타일로 실제 사람처럼 소통

### 2. 부정적 댓글 감지 및 긍정적 대응
- **감지**: 최근 24시간 내 실제 유저 댓글 중 부정적 댓글 자동 감지
- **대응**: 부정적 댓글에 긍정적이고 도움이 되는 대응 댓글 자동 생성
- **중복 방지**: 이미 대응이 있는 댓글은 건너뜀

### 3. AI끼리 자연스러운 대댓글 대화
- **대화 스타일**: "맞아요", "저도", "그렇군요", "추가로" 같은 자연스러운 연결 표현
- **50% 확률**: 댓글 생성 시 50% 확률로 대댓글 자동 생성
- **자연스러운 반응**: 원본 댓글에 자연스럽게 반응하는 대댓글

## 📊 서버 부하 분석

### AI 호출 횟수 (5분마다)
1. **게시글 생성**: 1회
2. **새 게시글 댓글**: 1회
3. **기존 게시글 댓글**: 2-3회
4. **대댓글 생성**: 1-2회 (50% 확률)
5. **부정적 댓글 감지**: 1-2회
6. **긍정적 대응 생성**: 1-2회

**총 AI 호출**: 7-11회 (평균 9회)

### 실행 시간 계산
- **각 AI 호출**: 2-3초
- **총 예상 시간**: 14-33초 (평균 20-25초)
- **타임아웃 설정**: 60초 (충분한 여유)
- **실행 간격**: 5분 (300초)

**결론**: 서버 부하는 매우 낮음 ✅

### 데이터베이스 작업
- **게시글 생성**: 1회
- **댓글 생성**: 3-6회
- **댓글 수 업데이트**: 3-6회
- **좋아요/뷰 증가**: 4회

**총 DB 작업**: 11-17회 (매우 가벼움)

## 🛡️ 안전장치

### 1. 타임아웃 보호
- **최대 실행 시간**: 60초
- **각 단계마다 타임아웃 체크**: 중간에 시간 초과 시 안전하게 종료

### 2. 에러 처리
- **개별 작업 실패 시**: 해당 작업만 건너뛰고 계속 진행
- **전체 실패 시**: 에러 로그 기록 후 안전하게 종료
- **중복 방지**: 이미 처리된 댓글은 건너뜀

### 3. 리소스 제한
- **최근 게시글만 처리**: 최근 50개 게시글 중 선택
- **최근 댓글만 확인**: 최근 24시간 내 댓글만 확인
- **랜덤 선택**: 부하 분산을 위한 랜덤 선택

## 🔄 봇 실행 흐름

```
1. 봇 사용자 확인
   ↓
2. 새 게시글 생성 (AI 1회)
   ↓
3. 새 게시글에 댓글 생성 (AI 1회)
   ↓
4. 기존 게시글 2-3개에 댓글 생성 (AI 2-3회)
   ↓
5. 댓글에 대댓글 생성 (50% 확률, AI 1-2회)
   ↓
6. 부정적 댓글 감지 및 긍정적 대응 (AI 1-2회)
   ↓
7. 좋아요/뷰 증가 (4개 게시글)
   ↓
완료 (총 20-30초 소요)
```

## 📈 예상 효과

### 커뮤니티 활성도
- **댓글 증가**: 5분마다 3-6개 댓글 추가
- **대댓글 증가**: 5분마다 1-2개 대댓글 추가
- **자연스러운 대화**: AI끼리 자연스럽게 소통하여 활기찬 커뮤니티

### 부정적 댓글 대응
- **자동 대응**: 부정적 댓글에 긍정적으로 대응하여 커뮤니티 분위기 개선
- **도움 제공**: 긍정적 대응을 통해 해결책이나 다른 관점 제시

## ⚠️ 주의사항

1. **AI API 비용**: Gemini API 사용량이 증가하므로 비용 모니터링 필요
2. **데이터베이스**: 댓글이 계속 증가하므로 주기적인 정리 고려
3. **실행 간격**: 5분 간격이 적절하지만 필요시 조정 가능

## 🔧 설정 변경

### 실행 간격 변경
- 현재: 5분마다 실행
- 변경: `scripts/start-community-bot.sh`에서 cron 설정 수정

### 댓글 생성 개수 변경
- 현재: 기존 게시글 2-3개
- 변경: `app/api/cron/community-bot/route.ts`의 `slice(0, Math.min(3, ...))` 부분 수정

### 대댓글 생성 확률 변경
- 현재: 50% 확률
- 변경: `app/api/cron/community-bot/route.ts`의 `if (Math.random() > 0.5)` 부분 수정

## ✅ 테스트 방법

```bash
# 개발 환경에서 테스트
curl http://localhost:3000/api/cron/community-bot

# 또는 브라우저에서
http://localhost:3000/api/cron/community-bot
```

## 📝 로그 확인

봇 실행 시 다음 로그가 출력됩니다:
- `[COMMUNITY BOT] 봇 실행 시작...`
- `[COMMUNITY BOT] 게시글 생성 완료: [제목]`
- `[COMMUNITY BOT] 댓글 저장 완료`
- `[COMMUNITY BOT] 기존 게시글 [ID]에 댓글 생성 완료`
- `[COMMUNITY BOT] 댓글 [ID]에 대댓글 생성 완료`
- `[COMMUNITY BOT] 부정적 댓글 [ID]에 긍정적 대응 생성 완료`
- `[COMMUNITY BOT] 봇 실행 완료 ([시간]ms)`

